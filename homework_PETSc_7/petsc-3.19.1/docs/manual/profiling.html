
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Profiling &#8212; PETSc 3.19.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/katex-math.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script src="../_static/katex.min.js"></script>
    <script src="../_static/auto-render.min.js"></script>
    <script src="../_static/katex_autorenderer.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'manual/profiling';</script>
    <link rel="shortcut icon" href="../_static/petsc_favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Hints for Performance Tuning" href="performance.html" />
    <link rel="prev" title="Using MATLAB with PETSc" href="matlab.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
    <img src="../_static/PETSc-TAO_RGB.svg" class="logo__image only-light" alt="Logo image">
    <img src="../_static/PETSc-TAO_RGB_white.svg" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../overview/index.html">
                        Overview
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../install/index.html">
                        Install
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../tutorials/index.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="index.html">
                        User-Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../manualpages/index.html">
                        C/Fortran API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../petsc4py/petsc4py.html">
                        Python API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../faq/index.html">
                        FAQ
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../community/index.html">
                        Community
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../developers/index.html">
                        Developers
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../miscellaneous/index.html">
                        Misc.
                      </a>
                    </li>
                
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://gitlab.com/petsc/petsc" title="GitLab" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fab fa-gitlab"></i></span>
            <label class="sr-only">GitLab</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../overview/index.html">
                        Overview
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../install/index.html">
                        Install
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../tutorials/index.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="index.html">
                        User-Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../manualpages/index.html">
                        C/Fortran API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../petsc4py/petsc4py.html">
                        Python API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../faq/index.html">
                        FAQ
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../community/index.html">
                        Community
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../developers/index.html">
                        Developers
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../miscellaneous/index.html">
                        Misc.
                      </a>
                    </li>
                
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://gitlab.com/petsc/petsc" title="GitLab" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fab fa-gitlab"></i></span>
            <label class="sr-only">GitLab</label></a>
        </li>
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Section navigation">
  <p class="bd-links__title" role="heading" aria-level="1">
    Section Navigation
  </p>
  <div class="bd-toc-item navbar-nav">
    <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../overview/nutshell.html">PETSc in a nutshell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/features.html">Supported Systems</a></li>

<li class="toctree-l1"><a class="reference internal" href="../overview/gpu_roadmap.html">GPU Support Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/vector_table.html">Summary of Vector Types Available In PETSc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/matrix_table.html">Summary of Matrix Types Available In PETSc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/linear_solve_table.html">Summary of Sparse Linear Solvers Available In PETSc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/nonlinear_solve_table.html">Summary of Nonlinear Solvers Available In PETSc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/integrator_table.html">Summary of Time Integrators Available In PETSc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/tao_solve_table.html">Summary of Tao Solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/discrete_table.html">Summary of Discretization Management Systems</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">User-Guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="introduction.html">Introduction to PETSc</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="about_this_manual.html">About This Manual</a></li>
<li class="toctree-l3"><a class="reference internal" href="getting_started.html">Getting Started</a></li>






</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="programming.html">The Solvers in PETSc/TAO</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="vec.html">Vectors and Parallel Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="mat.html">Matrices</a></li>
<li class="toctree-l3"><a class="reference internal" href="ksp.html">KSP: Linear System Solvers</a></li>
<li class="toctree-l3"><a class="reference internal" href="snes.html">SNES: Nonlinear Solvers</a></li>
<li class="toctree-l3"><a class="reference internal" href="ts.html">TS: Scalable ODE and DAE Solvers</a></li>

<li class="toctree-l3"><a class="reference internal" href="tao.html">TAO: Optimization Solvers</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="dm.html">DM: Interfacing Between Solvers and Models/Discretizations</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="dmbase.html">DM Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="dmplex.html">DMPlex: Unstructured Grids</a></li>
<li class="toctree-l3"><a class="reference internal" href="dmstag.html">DMSTAG: Staggered, Structured Grid</a></li>
<li class="toctree-l3"><a class="reference internal" href="dmnetwork.html">Networks</a></li>
<li class="toctree-l3"><a class="reference internal" href="dt.html">PetscDT: Discretization Technology in PETSc</a></li>
<li class="toctree-l3"><a class="reference internal" href="fe.html">PetscFE: Finite Element Infrastructure in PETSc</a></li>
</ul>
</li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="additional.html">Additional Information</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="fortran.html">PETSc for Fortran Users</a></li>
<li class="toctree-l3"><a class="reference internal" href="matlab.html">Using MATLAB with PETSc</a></li>
<li class="toctree-l3 current active"><a class="current reference internal" href="#">Profiling</a></li>
<li class="toctree-l3"><a class="reference internal" href="performance.html">Hints for Performance Tuning</a></li>
<li class="toctree-l3"><a class="reference internal" href="blas-lapack.html">The Use of BLAS and LAPACK in PETSc and external libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="other.html">Other PETSc Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced.html">Advanced Features of Matrices and Solvers</a></li>
<li class="toctree-l3"><a class="reference internal" href="tests.html">Running PETSc Tests</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../manualpages/index.html">C/Fortran API</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../manualpages/Vector.html">Vectors and Index Sets</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/Vec/index.html">Vector Operations (Vec)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/IS/index.html">Index sets (IS)</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../manualpages/Matrix.html">Matrices and Matrix Operations</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/Mat/index.html">Matrix Operations (Mat)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/MatOrderings/index.html">Matrix colorings (MatColoring), orderings (MatOrdering), partitionings (MatPartitioning), and coarsening (MatCoarsen)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/MatFD/index.html">Finite difference computation of Jacobians (MatFD)</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../manualpages/DataLayout.html">Data Layout and Communication</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/PetscSF/index.html">Star Forest Communication (PetscSF)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/PetscSection/index.html">Section Data Layout (PetscSection)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/AO/index.html">Application Orderings (AO)</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../manualpages/DataManagement.html">Data Management between Vec and Mat, and Distributed Mesh Data Structures</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/DM/index.html">Data Management (DM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/DMDA/index.html">Structured Grids (DMDA)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/DMStag/index.html">Staggered, Structured Grids (DMSTAG)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/DMPlex/index.html">Unstructured Grids and Cell Complexes (DMPLEX)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/DMNetwork/index.html">Graphs and Networks (DMNETWORK)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/DMForest/index.html">A Forest of Trees and Structured Adaptive Refinement (DMFOREST)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/DMPatch/index.html">Sequences of parallel mesh patches (DMPATCH)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/DMSwarm/index.html">Particle Discretizations (DMSWARM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/DMMOAB/index.html">MOAB Mesh Representation (DMMOAB)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/DMLabel/index.html">Selecting Parts of Meshes (DMLabel)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/DMPRODUCT/index.html">Tensor products of meshes (DMRODUCT)</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../manualpages/Discretization.html">Discretization and Function Spaces</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/DT/index.html">Discretization Technology and Quadrature (DT)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/SPACE/index.html">Function Spaces (PetscSpace)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/DUALSPACE/index.html">Dual Spaces (PetscDualSpace)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/FE/index.html">Finite Elements (PetscFE)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/FV/index.html">Finite Volumes (PetscFV)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/PF/index.html">Defining your own mathematical functions (PF)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/LANDAU/index.html">Landau Collision Operator</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../manualpages/LinearSolvers.html">Linear Solvers and Preconditioners</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/KSP/index.html">Linear Solvers and Krylov Methods (KSP)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/PC/index.html">Preconditioners (PC)</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../manualpages/NonlinearSolvers.html">Nonlinear Solvers</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/SNES/index.html">Nonlinear Solvers (SNES)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/SNESFAS/index.html">Full Approximation Scheme (FAS) nonlinear multigrid</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../manualpages/Timestepping.html">Forward and Adjoint Timestepping</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/TS/index.html">Time Stepping ODE and DAE Solvers (TS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/Sensitivity/index.html">Sensitivity Analysis for ODE and DAE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/Characteristic/index.html">Semi-Lagrangian Solves using the Method of Characteristics</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../manualpages/Optimization.html">Optimization</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/Tao/index.html">Optimization Solvers (Tao)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/TaoLineSearch/index.html">Optimization Line Search (TaoLineSearch)</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../manualpages/Visualization.html">Graphics and Visualization</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/Draw/index.html">Graphics (Draw)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/Viewer/index.html">Viewing Objects (Viewer)</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../manualpages/System.html">System Routines, Profiling, Data Structures</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/Sys/index.html">PETSc Options, IO, and System Utilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/PetscH/index.html">Hash Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manualpages/Profiling/index.html">Profiling and Logging</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changes/index.html">Changes for each release</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manualpages/singleindex.html">Single Index of all PETSc Manual Pages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../changes/index.html">Changes for each release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../manualpages/singleindex.html">Single Index of all PETSc Manual Pages</a></li>
</ul>

  </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <section id="profiling">
<span id="ch-profiling"></span><h1>Profiling<a class="headerlink" href="#profiling" title="Permalink to this heading">#</a></h1>
<p>PETSc includes a consistent, lightweight scheme for profiling
application programs. The PETSc routines automatically log
performance data if certain options are specified at runtime. The user
can also log information about application codes for a complete picture
of performance. In addition, as described in
<a class="reference internal" href="#sec-ploginfo"><span class="std std-ref">Interpreting -log_view Output: The Basics</span></a>, PETSc provides a mechanism for
printing informative messages about computations.
<a class="reference internal" href="#sec-profbasic"><span class="std std-ref">Basic Profiling Information</span></a> introduces the various profiling
options in PETSc, while the remainder of the chapter focuses on details
such as monitoring application codes and tips for accurate profiling.</p>
<section id="basic-profiling-information">
<span id="sec-profbasic"></span><h2>Basic Profiling Information<a class="headerlink" href="#basic-profiling-information" title="Permalink to this heading">#</a></h2>
<p>If an application code and the PETSc libraries have been configured with
<code class="docutils literal notranslate"><span class="pre">--with-log=1</span></code>, the default, then various kinds of profiling of code
between calls to <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInitialize.html">PetscInitialize</a>()</span></code> and <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFinalize.html">PetscFinalize</a>()</span></code> can be
activated at runtime. The profiling options include the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-log_view</span>&#160; <span class="pre">[:filename]</span></code> - Prints an ASCII version of performance data at
program’s conclusion. These statistics are comprehensive and concise
and require little overhead; thus, <code class="docutils literal notranslate"><span class="pre">-log_view</span></code> is intended as the
primary means of monitoring the performance of PETSc codes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-info</span> <span class="pre">[infofile]</span></code> - Prints verbose information about code to
stdout or an optional file. This option provides details about
algorithms, data structures, etc. Since the overhead of printing such
output slows a code, this option should not be used when evaluating a
program’s performance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-log_trace</span> <span class="pre">[logfile]</span></code> - Traces the beginning and ending of all
PETSc events. This option, which can be used in conjunction with
<code class="docutils literal notranslate"><span class="pre">-info</span></code>, is useful to see where a program is hanging without
running in the debugger.</p></li>
</ul>
<p>As discussed in <a class="reference internal" href="#sec-mpelogs"><span class="std std-ref">Using -log_mpe with Jumpshot</span></a>, additional profiling
can be done with MPE.</p>
<section id="interpreting-log-view-output-the-basics">
<span id="sec-ploginfo"></span><h3>Interpreting <code class="docutils literal notranslate"><span class="pre">-log_view</span></code> Output: The Basics<a class="headerlink" href="#interpreting-log-view-output-the-basics" title="Permalink to this heading">#</a></h3>
<p>As shown in <a class="reference internal" href="getting_started.html#listing-exprof"><span class="std std-ref">listing</span></a> in <a class="reference internal" href="getting_started.html#sec-profiling-programs"><span class="std std-ref">Profiling Programs</span></a>, the
option <code class="docutils literal notranslate"><span class="pre">-log_view</span></code> <code class="docutils literal notranslate"><span class="pre">[:filename]</span></code> activates printing of profile data to standard
output or an ASCII file at the conclusion of a program. See <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogView.html">PetscLogView</a>()</span></code> for all the possible
output options.</p>
<p>We print performance data for each routine, organized by PETSc
libraries, followed by any user-defined events (discussed in
<a class="reference internal" href="#sec-profileuser"><span class="std std-ref">Profiling Application Codes</span></a>). For each routine, the output data
include the maximum time and floating point operation (flop) rate over
all processes. Information about parallel performance is also included,
as discussed in the following section.</p>
<p>For the purpose of PETSc floating point operation counting, we define
one <em>flop</em> as one operation of any of the following types:
multiplication, division, addition, or subtraction. For example, one
<code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/VecAXPY.html">VecAXPY</a>()</span></code> operation, which computes <span class="math">\(y = \alpha x + y\)</span> for
vectors of length <span class="math">\(N\)</span>, requires <span class="math">\(2N\)</span> flop (consisting of
<span class="math">\(N\)</span> additions and <span class="math">\(N\)</span> multiplications). Bear in mind that
flop rates present only a limited view of performance, since memory
loads and stores are the real performance barrier.</p>
<p>For simplicity, the remainder of this discussion focuses on interpreting
profile data for the <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSP.html">KSP</a></span></code> library, which provides the linear solvers
at the heart of the PETSc package. Recall the hierarchical organization
of the PETSc library, as shown in
<a class="reference internal" href="getting_started.html#fig-library"><span class="std std-ref">Numerical Libraries in PETSc</span></a>. Each <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSP.html">KSP</a></span></code> solver is composed
of a <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/PC/PC.html">PC</a></span></code> (preconditioner) and a <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSP.html">KSP</a></span></code> (Krylov subspace) part, which
are in turn built on top of the <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/Mat.html">Mat</a></span></code> (matrix) and <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/Vec.html">Vec</a></span></code> (vector)
modules. Thus, operations in the <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSP.html">KSP</a></span></code> module are composed of
lower-level operations in these packages. Note also that the nonlinear
solvers library, <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/SNES/SNES.html">SNES</a></span></code>, is built on top of the <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSP.html">KSP</a></span></code> module, and
the timestepping library, <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/TS/TS.html">TS</a></span></code>, is in turn built on top of <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/SNES/SNES.html">SNES</a></span></code>.</p>
<p>We briefly discuss interpretation of the sample output in
<a class="reference internal" href="getting_started.html#listing-exprof"><span class="std std-ref">listing</span></a>, which was generated by solving a
linear system on one process using restarted GMRES and ILU
preconditioning. The linear solvers in <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSP.html">KSP</a></span></code> consist of two basic
phases, <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPSetUp.html">KSPSetUp</a>()</span></code> and <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPSolve.html">KSPSolve</a>()</span></code>, each of which consists of a
variety of actions, depending on the particular solution technique. For
the case of using the <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/PC/PCILU.html">PCILU</a></span></code> preconditioner and <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPGMRES.html">KSPGMRES</a></span></code> Krylov
subspace method, the breakdown of PETSc routines is listed below. As
indicated by the levels of indentation, the operations in <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPSetUp.html">KSPSetUp</a>()</span></code>
include all of the operations within <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/PC/PCSetUp.html">PCSetUp</a>()</span></code>, which in turn
include <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/MatILUFactor.html">MatILUFactor</a>()</span></code>, and so on.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPSetUp.html">KSPSetUp</a></span></code> - Set up linear solver</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/PC/PCSetUp.html">PCSetUp</a></span></code> - Set up preconditioner</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/MatILUFactor.html">MatILUFactor</a></span></code> - Factor preconditioning matrix</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/MatILUFactorSymbolic.html">MatILUFactorSymbolic</a></span></code> - Symbolic factorization phase</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/MatLUFactorNumeric.html">MatLUFactorNumeric</a></span></code> - Numeric factorization phase</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPSolve.html">KSPSolve</a></span></code> - Solve linear system</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/PC/PCApply.html">PCApply</a></span></code> - Apply preconditioner</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/MatSolve.html">MatSolve</a></span></code> - Forward/backward triangular solves</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">KSPGMRESOrthog</span></code> - Orthogonalization in GMRES</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/VecDot.html">VecDot</a></span></code> or <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/VecMDot.html">VecMDot</a></span></code> - Inner products</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/VecAXPY.html">VecAXPY</a></span></code> or <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/VecMAXPY.html">VecMAXPY</a></span></code> - vector updates</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/MatMult.html">MatMult</a></span></code> - Matrix-vector product</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/MatMultAdd.html">MatMultAdd</a></span></code> - Matrix-vector product + vector addition</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/VecScale.html">VecScale</a></span></code>, <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/VecNorm.html">VecNorm</a></span></code>, <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/VecAXPY.html">VecAXPY</a></span></code>, <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/VecCopy.html">VecCopy</a></span></code>, …</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>The summaries printed via <code class="docutils literal notranslate"><span class="pre">-log_view</span></code> reflect this routine hierarchy.
For example, the performance summaries for a particular high-level
routine such as <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPSolve.html">KSPSolve</a>()</span></code> include all of the operations accumulated
in the lower-level components that make up the routine.</p>
<p>The output produced with <code class="docutils literal notranslate"><span class="pre">-log_view</span></code> is flat, meaning that the hierarchy
of PETSc operations is not completely clear. For a
particular problem, the user should generally have an idea of the basic
operations that are required for its implementation (e.g., which
operations are performed when using GMRES and ILU, as described above),
so that interpreting the <code class="docutils literal notranslate"><span class="pre">-log_view</span></code> data should be relatively
straightforward.
If this is problematic then it is also possible to examine
the profiling information in a nested format. For more information see
<a class="reference internal" href="#sec-nestedevents"><span class="std std-ref">Profiling Nested Events</span></a>.</p>
</section>
<section id="interpreting-log-view-output-parallel-performance">
<span id="sec-parperformance"></span><h3>Interpreting <code class="docutils literal notranslate"><span class="pre">-log_view</span></code> Output: Parallel Performance<a class="headerlink" href="#interpreting-log-view-output-parallel-performance" title="Permalink to this heading">#</a></h3>
<p>We next discuss performance summaries for parallel programs, as shown
within <a class="reference internal" href="#listing-exparprof"><span class="std std-ref">listing</span></a> and  <a class="reference internal" href="#listing-exparprof2"><span class="std std-ref">listing</span></a>,
which presents the
output generated by the <code class="docutils literal notranslate"><span class="pre">-log_view</span></code> option. The program that generated
this data is
<a class="reference external" href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/src/ksp/ksp/tutorials/ex10.c.html">KSP Tutorial ex10</a>.
The code loads a matrix and right-hand-side vector from a binary file
and then solves the resulting linear system; the program then repeats
this process for a second linear system. This particular case was run on
four processors of an Intel x86_64 Linux cluster, using restarted GMRES
and the block Jacobi preconditioner, where each block was solved with
ILU. The two input files <code class="docutils literal notranslate"><span class="pre">medium</span></code> and <code class="docutils literal notranslate"><span class="pre">arco6</span></code> can be downloaded from
<a class="reference external" href="http://ftp.mcs.anl.gov/pub/petsc/Datafiles/matrices/">this FTP link</a>.</p>
<p>The first <a class="reference internal" href="#listing-exparprof"><span class="std std-ref">listing</span></a> presents an overall
performance summary, including times, floating-point operations,
computational rates, and message-passing activity (such as the number
and size of messages sent and collective operations). Summaries for
various user-defined stages of monitoring (as discussed in
<a class="reference internal" href="#sec-profstages"><span class="std std-ref">Profiling Multiple Sections of Code</span></a>) are also given. Information about the
various phases of computation then follow (as shown separately here in
the second <a class="reference internal" href="#listing-exparprof2"><span class="std std-ref">listing</span></a>). Finally, a summary of
object creation and destruction is presented.</p>
<div class="highlight-none notranslate" id="listing-exparprof"><div class="highlight"><pre><span></span>mpiexec -n 4 ./ex10 -f0 medium -f1 arco6 -ksp_gmres_classicalgramschmidt -log_view -mat_type baij \
            -matload_block_size 3 -pc_type bjacobi -options_left

Number of iterations = 19
Residual norm 1.088292e-05
Number of iterations = 59
Residual norm 3.871022e-02
---------------------------------------------- PETSc Performance Summary: ----------------------------------------------

./ex10 on a intel-bdw-opt named beboplogin4 with 4 processors, by jczhang Mon Apr 23 13:36:54 2018
Using Petsc Development GIT revision: v3.9-163-gbe3efd42  GIT Date: 2018-04-16 10:45:40 -0500

                         Max       Max/Min        Avg      Total
Time (sec):           1.849e-01      1.00002   1.849e-01
Objects:              1.060e+02      1.00000   1.060e+02
Flops:                2.361e+08      1.00684   2.353e+08  9.413e+08
Flops/sec:            1.277e+09      1.00685   1.273e+09  5.091e+09
MPI Msg Count:        2.360e+02      1.34857   2.061e+02  8.245e+02
MPI Msg Len (bytes):  1.256e+07      2.24620   4.071e+04  3.357e+07
MPI Reductions:       2.160e+02      1.00000

Summary of Stages:   ----- Time ------  ----- Flop -----  --- Messages ---  -- Message Lengths --  -- Reductions --
                        Avg     %Total     Avg     %Total   counts   %Total     Avg         %Total   counts   %Total
 0:      Main Stage: 5.9897e-04   0.3%  0.0000e+00   0.0%  0.000e+00   0.0%  0.000e+00        0.0%  2.000e+00   0.9%
 1:   Load System 0: 2.9113e-03   1.6%  0.0000e+00   0.0%  3.550e+01   4.3%  5.984e+02        0.1%  2.200e+01  10.2%
 2:      <a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPSetUp.html">KSPSetUp</a> 0: 7.7349e-04   0.4%  9.9360e+03   0.0%  0.000e+00   0.0%  0.000e+00        0.0%  2.000e+00   0.9%
 3:      <a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPSolve.html">KSPSolve</a> 0: 1.7690e-03   1.0%  2.9673e+05   0.0%  1.520e+02  18.4%  1.800e+02        0.1%  3.900e+01  18.1%
 4:   Load System 1: 1.0056e-01  54.4%  0.0000e+00   0.0%  3.700e+01   4.5%  5.657e+05       62.4%  2.200e+01  10.2%
 5:      <a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPSetUp.html">KSPSetUp</a> 1: 5.6883e-03   3.1%  2.1205e+07   2.3%  0.000e+00   0.0%  0.000e+00        0.0%  2.000e+00   0.9%
 6:      <a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPSolve.html">KSPSolve</a> 1: 7.2578e-02  39.3%  9.1979e+08  97.7%  6.000e+02  72.8%  2.098e+04       37.5%  1.200e+02  55.6%

------------------------------------------------------------------------------------------------------------------------

.... [Summary of various phases, see part II below] ...

------------------------------------------------------------------------------------------------------------------------

Object Type          Creations   Destructions    (Reports information only for process 0.)
...
--- Event Stage 3: <a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPSolve.html">KSPSolve</a> 0

              Matrix     0              4
              Vector    20             30
           Index Set     0              3
         <a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/Vec.html">Vec</a> Scatter     0              1
       Krylov Solver     0              2
      Preconditioner     0              2
</pre></div>
</div>
<p>We next focus on the summaries for the various phases of the
computation, as given in the table within
the following <a class="reference internal" href="#listing-exparprof2"><span class="std std-ref">listing</span></a>. The summary for each
phase presents the maximum times and flop rates over all processes, as
well as the ratio of maximum to minimum times and flop rates for all
processes. A ratio of approximately 1 indicates that computations within
a given phase are well balanced among the processes; as the ratio
increases, the balance becomes increasingly poor. Also, the total
computational rate (in units of MFlop/sec) is given for each phase in
the final column of the phase summary table.</p>
<div class="math">
\[{\rm Total\: Mflop/sec} \:=\: 10^{-6} * ({\rm sum\; of\; flop\; over\; all\; processors})/({\rm max\; time\; over\; all\; processors})

\]</div>
<p><em>Note</em>: Total computational rates <span class="math">\(&lt;\)</span> 1 MFlop are listed as 0 in
this column of the phase summary table. Additional statistics for each
phase include the total number of messages sent, the average message
length, and the number of global reductions.</p>
<div class="highlight-none notranslate" id="listing-exparprof2"><div class="highlight"><pre><span></span>mpiexec -n 4 ./ex10 -f0 medium -f1 arco6 -ksp_gmres_classicalgramschmidt -log_view -mat_type baij \
            -matload_block_size 3 -pc_type bjacobi -options_left

---------------------------------------------- PETSc Performance Summary: ----------------------------------------------
.... [Overall summary, see part I] ...

Phase summary info:
   Count: number of times phase was executed
   Time and Flop/sec: Max - maximum over all processors
                       Ratio - ratio of maximum to minimum over all processors
   Mess: number of messages sent
   AvgLen: average message length
   Reduct: number of global reductions
   Global: entire computation
   Stage: optional user-defined stages of a computation. Set stages with <a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogStagePush.html">PetscLogStagePush</a>() and <a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogStagePop.html">PetscLogStagePop</a>().
      %T - percent time in this phase         %F - percent flop in this phase
      %M - percent messages in this phase     %L - percent message lengths in this phase
      %R - percent reductions in this phase
   Total Mflop/s: 10^6 * (sum of flop over all processors)/(max time over all processors)
------------------------------------------------------------------------------------------------------------------------
Phase              Count      Time (sec)       Flop/sec                          --- Global ---  --- Stage ----  Total
                            Max    Ratio      Max    Ratio  Mess AvgLen  Reduct  %T %F %M %L %R  %T %F %M %L %R Mflop/s
------------------------------------------------------------------------------------------------------------------------
...

--- Event Stage 5: <a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPSetUp.html">KSPSetUp</a> 1

MatLUFactorNum         1 1.0 3.6440e-03 1.1 5.30e+06 1.0 0.0e+00 0.0e+00 0.0e+00  2  2  0  0  0  62100  0  0  0  5819
MatILUFactorSym        1 1.0 1.7111e-03 1.4 0.00e+00 0.0 0.0e+00 0.0e+00 0.0e+00  1  0  0  0  0  26  0  0  0  0     0
<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/MatGetRowIJ.html">MatGetRowIJ</a>            1 1.0 1.1921e-06 1.2 0.00e+00 0.0 0.0e+00 0.0e+00 0.0e+00  0  0  0  0  0   0  0  0  0  0     0
<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/MatOrderings/MatGetOrdering.html">MatGetOrdering</a>         1 1.0 3.0041e-05 1.1 0.00e+00 0.0 0.0e+00 0.0e+00 0.0e+00  0  0  0  0  0   1  0  0  0  0     0
<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPSetUp.html">KSPSetUp</a>               2 1.0 6.6495e-04 1.5 0.00e+00 0.0 0.0e+00 0.0e+00 2.0e+00  0  0  0  0  1   9  0  0  0100     0
<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/PC/PCSetUp.html">PCSetUp</a>                2 1.0 5.4271e-03 1.2 5.30e+06 1.0 0.0e+00 0.0e+00 0.0e+00  3  2  0  0  0  90100  0  0  0  3907
<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/PC/PCSetUpOnBlocks.html">PCSetUpOnBlocks</a>        1 1.0 5.3999e-03 1.2 5.30e+06 1.0 0.0e+00 0.0e+00 0.0e+00  3  2  0  0  0  90100  0  0  0  3927

--- Event Stage 6: <a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPSolve.html">KSPSolve</a> 1

<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/MatMult.html">MatMult</a>               60 1.0 2.4068e-02 1.1 6.54e+07 1.0 6.0e+02 2.1e+04 0.0e+00 12 27 73 37  0  32 28100100  0 10731
<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/MatSolve.html">MatSolve</a>              61 1.0 1.9177e-02 1.0 5.99e+07 1.0 0.0e+00 0.0e+00 0.0e+00 10 25  0  0  0  26 26  0  0  0 12491
<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/VecMDot.html">VecMDot</a>               59 1.0 1.4741e-02 1.3 4.86e+07 1.0 0.0e+00 0.0e+00 5.9e+01  7 21  0  0 27  18 21  0  0 49 13189
<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/VecNorm.html">VecNorm</a>               61 1.0 3.0417e-03 1.4 3.29e+06 1.0 0.0e+00 0.0e+00 6.1e+01  1  1  0  0 28   4  1  0  0 51  4332
<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/VecScale.html">VecScale</a>              61 1.0 9.9802e-04 1.0 1.65e+06 1.0 0.0e+00 0.0e+00 0.0e+00  1  1  0  0  0   1  1  0  0  0  6602
<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/VecCopy.html">VecCopy</a>                2 1.0 5.9128e-05 1.4 0.00e+00 0.0 0.0e+00 0.0e+00 0.0e+00  0  0  0  0  0   0  0  0  0  0     0
<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/VecSet.html">VecSet</a>                64 1.0 8.0323e-04 1.0 0.00e+00 0.0 0.0e+00 0.0e+00 0.0e+00  0  0  0  0  0   1  0  0  0  0     0
<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/VecAXPY.html">VecAXPY</a>                3 1.0 7.4387e-05 1.1 1.62e+05 1.0 0.0e+00 0.0e+00 0.0e+00  0  0  0  0  0   0  0  0  0  0  8712
<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/VecMAXPY.html">VecMAXPY</a>              61 1.0 8.8558e-03 1.1 5.18e+07 1.0 0.0e+00 0.0e+00 0.0e+00  5 22  0  0  0  12 23  0  0  0 23393
<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/PetscSF/VecScatterBegin.html">VecScatterBegin</a>       60 1.0 9.6416e-04 1.8 0.00e+00 0.0 6.0e+02 2.1e+04 0.0e+00  0  0 73 37  0   1  0100100  0     0
<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/PetscSF/VecScatterEnd.html">VecScatterEnd</a>         60 1.0 6.1543e-03 1.2 0.00e+00 0.0 0.0e+00 0.0e+00 0.0e+00  3  0  0  0  0   8  0  0  0  0     0
<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/VecNormalize.html">VecNormalize</a>          61 1.0 4.2675e-03 1.3 4.94e+06 1.0 0.0e+00 0.0e+00 6.1e+01  2  2  0  0 28   5  2  0  0 51  4632
KSPGMRESOrthog        59 1.0 2.2627e-02 1.1 9.72e+07 1.0 0.0e+00 0.0e+00 5.9e+01 11 41  0  0 27  29 42  0  0 49 17185
<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPSolve.html">KSPSolve</a>               1 1.0 7.2577e-02 1.0 2.31e+08 1.0 6.0e+02 2.1e+04 1.2e+02 39 98 73 37 56  99100100100100 12673
<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/PC/PCSetUpOnBlocks.html">PCSetUpOnBlocks</a>        1 1.0 9.5367e-07 0.0 0.00e+00 0.0 0.0e+00 0.0e+00 0.0e+00  0  0  0  0  0   0  0  0  0  0     0
<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/PC/PCApply.html">PCApply</a>               61 1.0 2.0427e-02 1.0 5.99e+07 1.0 0.0e+00 0.0e+00 0.0e+00 11 25  0  0  0  28 26  0  0  0 11726
------------------------------------------------------------------------------------------------------------------------
.... [Conclusion of overall summary, see part I] ...
</pre></div>
</div>
<p>As discussed in the preceding section, the performance summaries for
higher-level PETSc routines include the statistics for the lower levels
of which they are made up. For example, the communication within
matrix-vector products <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/MatMult.html">MatMult</a>()</span></code> consists of vector scatter
operations, as given by the routines <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/PetscSF/VecScatterBegin.html">VecScatterBegin</a>()</span></code> and
<code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/PetscSF/VecScatterEnd.html">VecScatterEnd</a>()</span></code>.</p>
<p>The final data presented are the percentages of the various statistics
(time (<code class="docutils literal notranslate"><span class="pre">%T</span></code>), flop/sec (<code class="docutils literal notranslate"><span class="pre">%F</span></code>), messages(<code class="docutils literal notranslate"><span class="pre">%M</span></code>), average message
length (<code class="docutils literal notranslate"><span class="pre">%L</span></code>), and reductions (<code class="docutils literal notranslate"><span class="pre">%R</span></code>)) for each event relative to the
total computation and to any user-defined stages (discussed in
<a class="reference internal" href="#sec-profstages"><span class="std std-ref">Profiling Multiple Sections of Code</span></a>). These statistics can aid in
optimizing performance, since they indicate the sections of code that
could benefit from various kinds of tuning.
<a class="reference internal" href="performance.html#ch-performance"><span class="std std-ref">Hints for Performance Tuning</span></a> gives suggestions about achieving good
performance with PETSc codes.</p>
<p>The additional option <cite>-log_view_memory</cite> causes the display of additional columns of information about how much
memory was allocated and freed during each logged event. This is useful
to understand what phases of a computation require the most memory.</p>
</section>
<section id="using-log-mpe-with-jumpshot">
<span id="sec-mpelogs"></span><h3>Using <code class="docutils literal notranslate"><span class="pre">-log_mpe</span></code> with Jumpshot<a class="headerlink" href="#using-log-mpe-with-jumpshot" title="Permalink to this heading">#</a></h3>
<p>It is also possible to use the <em>Jumpshot</em> package
<span id="id1">[<a class="reference internal" href="#id1076" title="Virginia Herrarte and Ewing Lusk. Studying parallel program behavior with Upshot. Technical Report ANL-91/15, Argonne National Laboratory, August 1991.">HL91</a>]</span> to visualize PETSc events. This package comes
with the MPE software, which is part of the MPICH
<span id="id2">[<a class="reference internal" href="#id1067" title="William Gropp and et. al. MPICH Web page. http://www.mpich.org. URL: http://www.mpich.org.">Getal</a>]</span> implementation of MPI. The option</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-log_mpe [logfile]
</pre></div>
</div>
<p>creates a logfile of events appropriate for viewing with <em>Jumpshot</em>. The
user can either use the default logging file or specify a name via
<code class="docutils literal notranslate"><span class="pre">logfile</span></code>. Events can be deactivated as described in
<a class="reference internal" href="#sec-deactivate"><span class="std std-ref">Restricting Event Logging</span></a>.</p>
<p>The user can also log MPI events. To do this, simply consider the PETSc
application as any MPI application, and follow the MPI implementation’s
instructions for logging MPI calls. For example, when using MPICH, this
merely required adding <code class="docutils literal notranslate"><span class="pre">-llmpich</span></code> to the library list <em>before</em>
<code class="docutils literal notranslate"><span class="pre">-lmpich</span></code>.</p>
</section>
<section id="profiling-nested-events">
<span id="sec-nestedevents"></span><h3>Profiling Nested Events<a class="headerlink" href="#profiling-nested-events" title="Permalink to this heading">#</a></h3>
<p>It is possible to output the PETSc logging information in a nested format
where the hierarchy of events is explicit. This output can be generated
either as an XML file or as a text file in a format suitable for viewing as
a flame graph.</p>
<p>One can generate the XML output by passing the option <code class="docutils literal notranslate"><span class="pre">-log_view</span> <span class="pre">:[logfilename]:ascii_xml</span></code>.
It can be viewed by copying <code class="docutils literal notranslate"><span class="pre">${PETSC_DIR}/share/petsc/xml/performance_xml2html.xsl</span></code>
into the current directory, then opening the logfile in your browser.</p>
<p>The flame graph output can be generated with the option <code class="docutils literal notranslate"><span class="pre">-log_view</span> <span class="pre">:[logfile]:ascii_flamegraph</span></code>.
It can then be visualised with either <a class="reference external" href="https://github.com/brendangregg/FlameGraph">FlameGraph</a>
or <a class="reference external" href="https://www.speedscope.app">speedscope</a>.</p>
<p>Note that user-defined stages (see <a class="reference internal" href="#sec-profstages"><span class="std std-ref">Profiling Multiple Sections of Code</span></a>) will be ignored when
using this nested format.</p>
</section>
</section>
<section id="profiling-application-codes">
<span id="sec-profileuser"></span><h2>Profiling Application Codes<a class="headerlink" href="#profiling-application-codes" title="Permalink to this heading">#</a></h2>
<p>PETSc automatically logs object creation, times, and floating-point
counts for the library routines. Users can easily supplement this
information by profiling their application codes as well. The basic
steps involved in logging a user-defined portion of code, called an
<em>event</em>, are shown in the code fragment below:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscLogEvent.html">PetscLogEvent</a></span><span class="w">  </span><span class="n">USER_EVENT</span><span class="p">;</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscClassId.html">PetscClassId</a></span><span class="w">   </span><span class="n">classid</span><span class="p">;</span>
<span class="n">PetscLogDouble</span><span class="w"> </span><span class="n">user_event_flops</span><span class="p">;</span>

<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscClassIdRegister.html">PetscClassIdRegister</a></span><span class="p">(</span><span class="s">&quot;class name&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">classid</span><span class="p">);</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a></span><span class="p">(</span><span class="s">&quot;User event name&quot;</span><span class="p">,</span><span class="n">classid</span><span class="p">,</span><span class="o">&amp;</span><span class="n">USER_EVENT</span><span class="p">);</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventBegin.html">PetscLogEventBegin</a></span><span class="p">(</span><span class="n">USER_EVENT</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="cm">/* code segment to monitor */</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogFlops.html">PetscLogFlops</a></span><span class="p">(</span><span class="n">user_event_flops</span><span class="p">);</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventEnd.html">PetscLogEventEnd</a></span><span class="p">(</span><span class="n">USER_EVENT</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<p>One must register the event by calling <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>()</span></code>,
which assigns a unique integer to identify the event for profiling
purposes:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a></span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">string</span><span class="p">[],</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscClassId.html">PetscClassId</a></span><span class="w"> </span><span class="n">classid</span><span class="p">,</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscLogEvent.html">PetscLogEvent</a></span><span class="w"> </span><span class="o">*</span><span class="n">e</span><span class="p">);</span>
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">string</span></code> is a user-defined event name, and <code class="docutils literal notranslate"><span class="pre">color</span></code> is an
optional user-defined event color (for use with <em>Jumpshot</em> logging; see
<a class="reference internal" href="#sec-mpelogs"><span class="std std-ref">Using -log_mpe with Jumpshot</span></a>); one should see the manual page for
details. The argument returned in <code class="docutils literal notranslate"><span class="pre">e</span></code> should then be passed to the
<code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventBegin.html">PetscLogEventBegin</a>()</span></code> and <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventEnd.html">PetscLogEventEnd</a>()</span></code> routines.</p>
<p>Events are logged by using the pair</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventBegin.html">PetscLogEventBegin</a></span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">event</span><span class="p">,</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscObject.html">PetscObject</a></span><span class="w"> </span><span class="n">o1</span><span class="p">,</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscObject.html">PetscObject</a></span><span class="w"> </span><span class="n">o2</span><span class="p">,</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscObject.html">PetscObject</a></span><span class="w"> </span><span class="n">o3</span><span class="p">,</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscObject.html">PetscObject</a></span><span class="w"> </span><span class="n">o4</span><span class="p">);</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventEnd.html">PetscLogEventEnd</a></span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">event</span><span class="p">,</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscObject.html">PetscObject</a></span><span class="w"> </span><span class="n">o1</span><span class="p">,</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscObject.html">PetscObject</a></span><span class="w"> </span><span class="n">o2</span><span class="p">,</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscObject.html">PetscObject</a></span><span class="w"> </span><span class="n">o3</span><span class="p">,</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscObject.html">PetscObject</a></span><span class="w"> </span><span class="n">o4</span><span class="p">);</span>
</pre></div>
</div>
<p>The four objects are the PETSc objects that are most closely associated
with the event. For instance, in a matrix-vector product they would be
the matrix and the two vectors. These objects can be omitted by
specifying 0 for <code class="docutils literal notranslate"><span class="pre">o1</span></code> - <code class="docutils literal notranslate"><span class="pre">o4</span></code>. The code between these two routine
calls will be automatically timed and logged as part of the specified
event.</p>
<p>The user can log the number of floating-point operations for this
segment of code by calling</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogFlops.html">PetscLogFlops</a></span><span class="p">(</span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">flop</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">segment</span><span class="p">);</span>
</pre></div>
</div>
<p>between the calls to <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventBegin.html">PetscLogEventBegin</a>()</span></code> and
<code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventEnd.html">PetscLogEventEnd</a>()</span></code>. This value will automatically be added to the
global flop counter for the entire program.</p>
</section>
<section id="profiling-multiple-sections-of-code">
<span id="sec-profstages"></span><h2>Profiling Multiple Sections of Code<a class="headerlink" href="#profiling-multiple-sections-of-code" title="Permalink to this heading">#</a></h2>
<p>By default, the profiling produces a single set of statistics for all
code between the <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInitialize.html">PetscInitialize</a>()</span></code> and <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFinalize.html">PetscFinalize</a>()</span></code> calls
within a program. One can independently monitor several “stages” of code
by switching among the various stages with the commands</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogStagePush.html">PetscLogStagePush</a></span><span class="p">(</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscLogStage.html">PetscLogStage</a></span><span class="w"> </span><span class="n">stage</span><span class="p">);</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogStagePop.html">PetscLogStagePop</a></span><span class="p">();</span>
</pre></div>
</div>
<p>see the manual pages for details.
The command</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogStageRegister.html">PetscLogStageRegister</a></span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscLogStage.html">PetscLogStage</a></span><span class="w"> </span><span class="o">*</span><span class="n">stage</span><span class="p">)</span>
</pre></div>
</div>
<p>allows one to associate a name with a stage; these names are printed
whenever summaries are generated with <code class="docutils literal notranslate"><span class="pre">-log_view</span></code>. The following code fragment uses three profiling
stages within an program.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInitialize.html">PetscInitialize</a></span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">argc</span><span class="p">,</span><span class="kt">char</span><span class="w"> </span><span class="o">***</span><span class="n">args</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="cm">/* stage 0 of code here */</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogStageRegister.html">PetscLogStageRegister</a></span><span class="p">(</span><span class="s">&quot;Stage 0 of Code&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">stagenum0</span><span class="p">);</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">ntimes</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogStageRegister.html">PetscLogStageRegister</a></span><span class="p">(</span><span class="s">&quot;Stage 1 of Code&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">stagenum1</span><span class="p">);</span>
<span class="w">    </span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogStagePush.html">PetscLogStagePush</a></span><span class="p">(</span><span class="n">stagenum1</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/* stage 1 of code here */</span>
<span class="w">    </span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogStagePop.html">PetscLogStagePop</a></span><span class="p">();</span>
<span class="w">    </span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogStageRegister.html">PetscLogStageRegister</a></span><span class="p">(</span><span class="s">&quot;Stage 2 of Code&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">stagenum2</span><span class="p">);</span>
<span class="w">    </span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogStagePush.html">PetscLogStagePush</a></span><span class="p">(</span><span class="n">stagenum2</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/* stage 2 of code here */</span>
<span class="w">    </span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogStagePop.html">PetscLogStagePop</a></span><span class="p">();</span>
<span class="p">}</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFinalize.html">PetscFinalize</a></span><span class="p">();</span>
</pre></div>
</div>
<p>The listings above
show output generated by
<code class="docutils literal notranslate"><span class="pre">-log_view</span></code> for a program that employs several profiling stages. In
particular, this program is subdivided into six stages: loading a matrix and right-hand-side vector from a binary file,
setting up the preconditioner, and solving the linear system; this
sequence is then repeated for a second linear system. For simplicity,
the second listing contains output only for
stages 5 and 6 (linear solve of the second system), which comprise the
part of this computation of most interest to us in terms of performance
monitoring. This code organization (solving a small linear system
followed by a larger system) enables generation of more accurate
profiling statistics for the second system by overcoming the often
considerable overhead of paging, as discussed in
<a class="reference internal" href="#sec-profaccuracy"><span class="std std-ref">Accurate Profiling and Paging Overheads</span></a>.</p>
</section>
<section id="restricting-event-logging">
<span id="sec-deactivate"></span><h2>Restricting Event Logging<a class="headerlink" href="#restricting-event-logging" title="Permalink to this heading">#</a></h2>
<p>By default, all PETSc operations are logged. To enable or disable the
PETSc logging of individual events, one uses the commands</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventActivate.html">PetscLogEventActivate</a></span><span class="p">(</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscLogEvent.html">PetscLogEvent</a></span><span class="w"> </span><span class="n">event</span><span class="p">);</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventDeactivate.html">PetscLogEventDeactivate</a></span><span class="p">(</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscLogEvent.html">PetscLogEvent</a></span><span class="w"> </span><span class="n">event</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">event</span></code> may be either a predefined PETSc event (as listed in the
file <code class="docutils literal notranslate"><span class="pre">$PETSC_DIR/include/petsclog.h</span></code>) or one obtained with
<code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>()</span></code> (as described in
<a class="reference internal" href="#sec-profileuser"><span class="std std-ref">Profiling Application Codes</span></a>).</p>
<p>PETSc also provides routines that deactivate (or activate) logging for
entire components of the library. Currently, the components that support
such logging (de)activation are <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/Mat.html">Mat</a></span></code> (matrices), <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/Vec.html">Vec</a></span></code> (vectors),
<code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSP.html">KSP</a></span></code> (linear solvers, including <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSP.html">KSP</a></span></code> and <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/PC/PC.html">PC</a></span></code>), and <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/SNES/SNES.html">SNES</a></span></code>
(nonlinear solvers):</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventDeactivateClass.html">PetscLogEventDeactivateClass</a></span><span class="p">(</span><span class="n">MAT_CLASSID</span><span class="p">);</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventDeactivateClass.html">PetscLogEventDeactivateClass</a></span><span class="p">(</span><span class="n">KSP_CLASSID</span><span class="p">);</span><span class="w"> </span><span class="cm">/* includes <a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/PC/PC.html">PC</a> and <a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSP.html">KSP</a> */</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventDeactivateClass.html">PetscLogEventDeactivateClass</a></span><span class="p">(</span><span class="n">VEC_CLASSID</span><span class="p">);</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventDeactivateClass.html">PetscLogEventDeactivateClass</a></span><span class="p">(</span><span class="n">SNES_CLASSID</span><span class="p">);</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventActivateClass.html">PetscLogEventActivateClass</a></span><span class="p">(</span><span class="n">MAT_CLASSID</span><span class="p">);</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventActivateClass.html">PetscLogEventActivateClass</a></span><span class="p">(</span><span class="n">KSP_CLASSID</span><span class="p">);</span><span class="w">   </span><span class="cm">/* includes <a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/PC/PC.html">PC</a> and <a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSP.html">KSP</a> */</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventActivateClass.html">PetscLogEventActivateClass</a></span><span class="p">(</span><span class="n">VEC_CLASSID</span><span class="p">);</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogEventActivateClass.html">PetscLogEventActivateClass</a></span><span class="p">(</span><span class="n">SNES_CLASSID</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="interpreting-log-info-output-informative-messages">
<span id="sec-petscloginfo"></span><h2>Interpreting <code class="docutils literal notranslate"><span class="pre">-log_info</span></code> Output: Informative Messages<a class="headerlink" href="#interpreting-log-info-output-informative-messages" title="Permalink to this heading">#</a></h2>
<p>Users can activate the printing of verbose information about algorithms,
data structures, etc. to the screen by using the option <code class="docutils literal notranslate"><span class="pre">-info</span></code> or by
calling <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscInfoAllow.html">PetscInfoAllow</a>(<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscBool.html">PETSC_TRUE</a>)</span></code>. Such logging, which is used
throughout the PETSc libraries, can aid the user in understanding
algorithms and tuning program performance. For example, as discussed in
<a class="reference internal" href="mat.html#sec-matsparse"><span class="std std-ref">Sparse Matrices</span></a>, <code class="docutils literal notranslate"><span class="pre">-info</span></code> activates the printing of
information about memory allocation during matrix assembly.</p>
<p>Application programmers can employ this logging as well, by using the
routine</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscInfo.html">PetscInfo</a></span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">message</span><span class="p">,...)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">obj</span></code> is the PETSc object associated most closely with the
logging statement, <code class="docutils literal notranslate"><span class="pre">message</span></code>. For example, in the line search Newton
methods, we use a statement such as</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscInfo.html">PetscInfo</a></span><span class="p">(</span><span class="n">snes</span><span class="p">,</span><span class="s">&quot;Cubic step, lambda %g</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">lambda</span><span class="p">);</span>
</pre></div>
</div>
<p>One can selectively turn off informative messages about any of the basic
PETSc objects (e.g., <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/Mat.html">Mat</a></span></code>, <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/SNES/SNES.html">SNES</a></span></code>) with the command</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscInfoDeactivateClass.html">PetscInfoDeactivateClass</a></span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">object_classid</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">object_classid</span></code> is one of <code class="docutils literal notranslate"><span class="pre">MAT_CLASSID</span></code>, <code class="docutils literal notranslate"><span class="pre">SNES_CLASSID</span></code>,
etc. Messages can be reactivated with the command</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscInfoActivateClass.html">PetscInfoActivateClass</a></span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">object_classid</span><span class="p">)</span>
</pre></div>
</div>
<p>Such deactivation can be useful when one wishes to view information
about higher-level PETSc libraries (e.g., <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/TS/TS.html">TS</a></span></code> and <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/SNES/SNES.html">SNES</a></span></code>) without
seeing all lower level data as well (e.g., <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/Mat.html">Mat</a></span></code>). One can deactivate
events at runtime for matrix and linear solver libraries via
<code class="docutils literal notranslate"><span class="pre">-info</span> <span class="pre">[no_mat,</span> <span class="pre">no_ksp]</span></code>.</p>
</section>
<section id="time">
<h2>Time<a class="headerlink" href="#time" title="Permalink to this heading">#</a></h2>
<p>PETSc application programmers can access the wall clock time directly
with the command</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PetscLogDouble</span><span class="w"> </span><span class="n">time</span><span class="p">;</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscCall.html">PetscCall</a></span><span class="p">(</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscTime.html">PetscTime</a></span><span class="p">(</span><span class="o">&amp;</span><span class="n">time</span><span class="p">));</span>
</pre></div>
</div>
<p>which returns the current time in seconds since the epoch, and is
commonly implemented with <code class="docutils literal notranslate"><span class="pre"><a href="http://www.mpich.org/static/docs/latest/www3/MPI_Wtime.html#MPI_Wtime">MPI_Wtime</a></span></code>. A floating point number is
returned in order to express fractions of a second. In addition, as
discussed in <a class="reference internal" href="#sec-profileuser"><span class="std std-ref">Profiling Application Codes</span></a>, PETSc can automatically
profile user-defined segments of code.</p>
</section>
<section id="saving-output-to-a-file">
<h2>Saving Output to a File<a class="headerlink" href="#saving-output-to-a-file" title="Permalink to this heading">#</a></h2>
<p>All output from PETSc programs (including informative messages,
profiling information, and convergence data) can be saved to a file by
using the command line option <code class="docutils literal notranslate"><span class="pre">-history</span> <span class="pre">[filename]</span></code>. If no file name
is specified, the output is stored in the file
<code class="docutils literal notranslate"><span class="pre">${HOME}/.petschistory</span></code>. Note that this option only saves output
printed with the <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscPrintf.html">PetscPrintf</a>()</span></code> and <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFPrintf.html">PetscFPrintf</a>()</span></code> commands, not
the standard <code class="docutils literal notranslate"><span class="pre">printf()</span></code> and <code class="docutils literal notranslate"><span class="pre">fprintf()</span></code> statements.</p>
</section>
<section id="accurate-profiling-and-paging-overheads">
<span id="sec-profaccuracy"></span><h2>Accurate Profiling and Paging Overheads<a class="headerlink" href="#accurate-profiling-and-paging-overheads" title="Permalink to this heading">#</a></h2>
<p>One factor that often plays a significant role in profiling a code is
paging by the operating system. Generally, when running a program, only
a few pages required to start it are loaded into memory rather than the
entire executable. When the execution proceeds to code segments that are
not in memory, a pagefault occurs, prompting the required pages to be
loaded from the disk (a very slow process). This activity distorts the
results significantly. (The paging effects are noticeable in the log
files generated by <code class="docutils literal notranslate"><span class="pre">-log_mpe</span></code>, which is described in
<a class="reference internal" href="#sec-mpelogs"><span class="std std-ref">Using -log_mpe with Jumpshot</span></a>.)</p>
<p>To eliminate the effects of paging when profiling the performance of a
program, we have found an effective procedure is to run the <em>exact same
code</em> on a small dummy problem before running it on the actual problem
of interest. We thus ensure that all code required by a solver is loaded
into memory during solution of the small problem. When the code proceeds
to the actual (larger) problem of interest, all required pages have
already been loaded into main memory, so that the performance numbers
are not distorted.</p>
<p>When this procedure is used in conjunction with the user-defined stages
of profiling described in <a class="reference internal" href="#sec-profstages"><span class="std std-ref">Profiling Multiple Sections of Code</span></a>, we can
focus easily on the problem of interest. For example, we used this
technique in the program
<a class="reference external" href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/src/ksp/ksp/tutorials/ex10.c.html">KSP Tutorial ex10</a>
to generate the timings within
<a class="reference internal" href="#listing-exparprof"><span class="std std-ref">listing</span></a> and <a class="reference internal" href="#listing-exparprof2"><span class="std std-ref">listing</span></a>.
In this case, the profiled code
of interest (solving the linear system for the larger problem) occurs
within event stages 5 and 6. <a class="reference internal" href="#sec-parperformance"><span class="std std-ref">Interpreting -log_view Output: Parallel Performance</span></a>
provides details about interpreting such profiling data.</p>
<p>In particular, the macros</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscPreLoadBegin.html">PetscPreLoadBegin</a></span><span class="p">(</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscBool.html">PetscBool</a></span><span class="w"> </span><span class="n">flag</span><span class="p">,</span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">stagename</span><span class="p">)</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscPreLoadStage.html">PetscPreLoadStage</a></span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">stagename</span><span class="p">)</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscPreLoadEnd.html">PetscPreLoadEnd</a></span><span class="p">()</span>
</pre></div>
</div>
<p>can be used to easily convert a regular PETSc program to one that uses
preloading. The command line options <code class="docutils literal notranslate"><span class="pre">-preload</span></code> <code class="docutils literal notranslate"><span class="pre">true</span></code> and
<code class="docutils literal notranslate"><span class="pre">-preload</span></code> <code class="docutils literal notranslate"><span class="pre">false</span></code> may be used to turn on and off preloading at run
time for PETSc programs that use these macros.</p>
</section>
<section id="nvidia-nsight-systems-profiling">
<h2>NVIDIA Nsight Systems profiling<a class="headerlink" href="#nvidia-nsight-systems-profiling" title="Permalink to this heading">#</a></h2>
<p>When a CUDA executable is preceeded by
<code class="docutils literal notranslate"><span class="pre">nsys</span> <span class="pre">profile</span> <span class="pre">-f</span> <span class="pre">true</span> <span class="pre">-o</span> <span class="pre">filename</span></code>, the default event profiling will add annotations to the
Nsight Systems data that can help the navigation of <code class="docutils literal notranslate"><span class="pre">file-name</span></code>  with the Nsight Systems GUI
(<a class="reference external" href="https://developer.nvidia.com/nsight-systems">https://developer.nvidia.com/nsight-systems</a>). The Nsight Systems GUI
lets you see a timeline of code performance information like kernels,
mallocs, CPU-GPU communication, and high-level data like register
usage in a kernel, among other things in a popup window when the mouse
hovers over the section. The PETSc events are automatically also
displayed in Nsight if the option -log_view is also used.</p>
<p>For and MPI parallel job, only one process can call <code class="docutils literal notranslate"><span class="pre">nsys</span></code>.
For example one can in a bash script use something like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OMPI_COMM_WORLD_RANK</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>nsys<span class="w"> </span>profile<span class="w"> </span>-f<span class="w"> </span><span class="nb">true</span><span class="w"> </span>-o<span class="w"> </span>output<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
<span class="k">else</span>
<span class="w">    </span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
<span class="k">fi</span>
</pre></div>
</div>
</section>
<section id="using-tau">
<span id="sec-using-tau"></span><h2>Using TAU<a class="headerlink" href="#using-tau" title="Permalink to this heading">#</a></h2>
<p>TAU profiles can be generated without the need for instrumentation through the
use of the perfstubs package. PETSc by default is configured with <code class="docutils literal notranslate"><span class="pre">--with-tau-perfstubs</span></code>.
To generate profiles with TAU, first setup TAU:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget<span class="w"> </span>http://tau.uoregon.edu/tau.tgz
./configure<span class="w"> </span>-cc<span class="o">=</span>mpicc<span class="w"> </span>-c++<span class="o">=</span>mpicxx<span class="w"> </span>-mpi<span class="w"> </span>-bfd<span class="o">=</span>download<span class="w"> </span>-unwind<span class="o">=</span>download<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>install
<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>&lt;tau<span class="w"> </span>dir&gt;/x86_64/bin:<span class="nv">$PATH</span>
</pre></div>
</div>
<p>For more information on configuring TAU, see <a class="reference external" href="http://tau.uoregon.edu">http://tau.uoregon.edu</a>.
Next, run your program with TAU. For instance, to profile <cite>ex56</cite>,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="nv">$PETSC_DIR</span>/src/snes/tutorials
make<span class="w"> </span>ex56
mpirun<span class="w"> </span>-n<span class="w"> </span><span class="m">4</span><span class="w"> </span>tau_exec<span class="w"> </span>-T<span class="w"> </span>mpi<span class="w"> </span>./ex56<span class="w"> </span>&lt;args&gt;
</pre></div>
</div>
<p>This should produce four <code class="docutils literal notranslate"><span class="pre">profile.*</span></code> files with profile data that can be
viewed with <code class="docutils literal notranslate"><span class="pre">paraprof/pprof</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Reading<span class="w"> </span>Profile<span class="w"> </span>files<span class="w"> </span><span class="k">in</span><span class="w"> </span>profile.*

NODE<span class="w"> </span><span class="m">0</span><span class="p">;</span>CONTEXT<span class="w"> </span><span class="m">0</span><span class="p">;</span>THREAD<span class="w"> </span><span class="m">0</span>:
---------------------------------------------------------------------------------------
%Time<span class="w">    </span>Exclusive<span class="w">    </span>Inclusive<span class="w">       </span><span class="c1">#Call      #Subrs  Inclusive Name</span>
<span class="w">              </span>msec<span class="w">   </span>total<span class="w"> </span>msec<span class="w">                          </span>usec/call
---------------------------------------------------------------------------------------
<span class="m">100</span>.0<span class="w">           </span><span class="m">26</span><span class="w">        </span><span class="m">1</span>,838<span class="w">           </span><span class="m">1</span><span class="w">       </span><span class="m">41322</span><span class="w">    </span><span class="m">1838424</span><span class="w"> </span>.TAU<span class="w"> </span>application
<span class="w"> </span><span class="m">73</span>.2<span class="w">            </span><span class="m">1</span><span class="w">        </span><span class="m">1</span>,345<span class="w">           </span><span class="m">2</span><span class="w">         </span><span class="m">168</span><span class="w">     </span><span class="m">672950</span><span class="w"> </span><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/SNES/SNESSolve.html">SNESSolve</a>
<span class="w"> </span><span class="m">62</span>.2<span class="w">            </span><span class="m">3</span><span class="w">        </span><span class="m">1</span>,142<span class="w">           </span><span class="m">2</span><span class="w">        </span><span class="m">1282</span><span class="w">     </span><span class="m">571442</span><span class="w"> </span>SNESJacobianEval
<span class="w"> </span><span class="m">62</span>.0<span class="w">        </span><span class="m">1</span>,136<span class="w">        </span><span class="m">1</span>,138<span class="w">           </span><span class="m">2</span><span class="w">          </span><span class="m">76</span><span class="w">     </span><span class="m">569494</span><span class="w"> </span>DMPlexJacobianFE
<span class="w"> </span><span class="m">60</span>.1<span class="w">        </span><span class="m">0</span>.046<span class="w">        </span><span class="m">1</span>,105<span class="w">           </span><span class="m">1</span><span class="w">          </span><span class="m">32</span><span class="w">    </span><span class="m">1105001</span><span class="w"> </span>Solve<span class="w"> </span><span class="m">1</span>
<span class="w"> </span><span class="m">15</span>.2<span class="w">           </span><span class="m">87</span><span class="w">          </span><span class="m">279</span><span class="w">           </span><span class="m">5</span><span class="w">       </span><span class="m">11102</span><span class="w">      </span><span class="m">55943</span><span class="w"> </span>Mesh<span class="w"> </span>Setup
<span class="w"> </span><span class="m">13</span>.2<span class="w">        </span><span class="m">0</span>.315<span class="w">          </span><span class="m">241</span><span class="w">           </span><span class="m">1</span><span class="w">          </span><span class="m">32</span><span class="w">     </span><span class="m">241765</span><span class="w"> </span>Solve<span class="w"> </span><span class="m">0</span>
<span class="w">  </span><span class="m">7</span>.8<span class="w">           </span><span class="m">80</span><span class="w">          </span><span class="m">144</span><span class="w">       </span><span class="m">38785</span><span class="w">       </span><span class="m">38785</span><span class="w">          </span><span class="m">4</span><span class="w"> </span><a href="http://www.mpich.org/static/docs/latest/www3/MPI_Allreduce.html#MPI_Allreduce">MPI_Allreduce</a><span class="o">()</span>
<span class="w">  </span><span class="m">7</span>.0<span class="w">           </span><span class="m">69</span><span class="w">          </span><span class="m">128</span><span class="w">           </span><span class="m">6</span><span class="w">       </span><span class="m">43386</span><span class="w">      </span><span class="m">21491</span><span class="w"> </span>DualSpaceSetUp
<span class="w">  </span><span class="m">6</span>.2<span class="w">            </span><span class="m">1</span><span class="w">          </span><span class="m">114</span><span class="w">           </span><span class="m">4</span><span class="w">          </span><span class="m">54</span><span class="w">      </span><span class="m">28536</span><span class="w"> </span><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/PC/PCSetUp.html">PCSetUp</a>
<span class="w">  </span><span class="m">6</span>.0<span class="w">           </span><span class="m">12</span><span class="w">          </span><span class="m">110</span><span class="w">           </span><span class="m">2</span><span class="w">         </span><span class="m">892</span><span class="w">      </span><span class="m">55407</span><span class="w"> </span>PCSetUp_GAMG+
<span class="w">  </span><span class="m">3</span>.9<span class="w">           </span><span class="m">70</span><span class="w">           </span><span class="m">70</span><span class="w">           </span><span class="m">1</span><span class="w">           </span><span class="m">0</span><span class="w">      </span><span class="m">70888</span><span class="w"> </span><a href="http://www.mpich.org/static/docs/latest/www3/MPI_Init_thread.html#MPI_Init_thread">MPI_Init_thread</a><span class="o">()</span>
<span class="w">  </span><span class="m">3</span>.7<span class="w">           </span><span class="m">68</span><span class="w">           </span><span class="m">68</span><span class="w">       </span><span class="m">41747</span><span class="w">           </span><span class="m">0</span><span class="w">          </span><span class="m">2</span><span class="w"> </span>MPI<span class="w"> </span>Collective<span class="w"> </span>Sync
<span class="w">  </span><span class="m">3</span>.6<span class="w">            </span><span class="m">8</span><span class="w">           </span><span class="m">66</span><span class="w">           </span><span class="m">4</span><span class="w">        </span><span class="m">3536</span><span class="w">      </span><span class="m">16548</span><span class="w"> </span>SNESFunctionEval
<span class="w">  </span><span class="m">2</span>.6<span class="w">           </span><span class="m">45</span><span class="w">           </span><span class="m">48</span><span class="w">         </span><span class="m">171</span><span class="w">         </span><span class="m">171</span><span class="w">        </span><span class="m">281</span><span class="w"> </span><a href="http://www.mpich.org/static/docs/latest/www3/MPI_Bcast.html#MPI_Bcast">MPI_Bcast</a><span class="o">()</span>
<span class="w">  </span><span class="m">1</span>.9<span class="w">           </span><span class="m">34</span><span class="w">           </span><span class="m">34</span><span class="w">        </span><span class="m">7836</span><span class="w">           </span><span class="m">0</span><span class="w">          </span><span class="m">4</span><span class="w"> </span><a href="http://www.mpich.org/static/docs/latest/www3/MPI_Barrier.html#MPI_Barrier">MPI_Barrier</a><span class="o">()</span>
<span class="w">  </span><span class="m">1</span>.8<span class="w">        </span><span class="m">0</span>.567<span class="w">           </span><span class="m">33</span><span class="w">           </span><span class="m">2</span><span class="w">          </span><span class="m">68</span><span class="w">      </span><span class="m">16912</span><span class="w">  </span>GAMG<span class="w"> </span>Coarsen
</pre></div>
</div>
<hr><div class="docutils container" id="id3">
<dl class="citation">
<dt class="label" id="id1067"><span class="brackets"><a class="fn-backref" href="#id2">Getal</a></span></dt>
<dd><p>William Gropp and et. al. MPICH Web page. <a class="reference external" href="http://www.mpich.org">http://www.mpich.org</a>. URL: <a class="reference external" href="http://www.mpich.org">http://www.mpich.org</a>.</p>
</dd>
<dt class="label" id="id1076"><span class="brackets"><a class="fn-backref" href="#id1">HL91</a></span></dt>
<dd><p>Virginia Herrarte and Ewing Lusk. Studying parallel program behavior with Upshot. Technical Report ANL-91/15, Argonne National Laboratory, August 1991.</p>
</dd>
</dl>
</div>
</section>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="matlab.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Using MATLAB with PETSc</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="performance.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Hints for Performance Tuning</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#basic-profiling-information">
   Basic Profiling Information
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interpreting-log-view-output-the-basics">
     Interpreting
     <code class="docutils literal notranslate">
      <span class="pre">
       -log_view
      </span>
     </code>
     Output: The Basics
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interpreting-log-view-output-parallel-performance">
     Interpreting
     <code class="docutils literal notranslate">
      <span class="pre">
       -log_view
      </span>
     </code>
     Output: Parallel Performance
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-log-mpe-with-jumpshot">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       -log_mpe
      </span>
     </code>
     with Jumpshot
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#profiling-nested-events">
     Profiling Nested Events
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#profiling-application-codes">
   Profiling Application Codes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#profiling-multiple-sections-of-code">
   Profiling Multiple Sections of Code
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#restricting-event-logging">
   Restricting Event Logging
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#interpreting-log-info-output-informative-messages">
   Interpreting
   <code class="docutils literal notranslate">
    <span class="pre">
     -log_info
    </span>
   </code>
   Output: Informative Messages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#time">
   Time
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#saving-output-to-a-file">
   Saving Output to a File
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#accurate-profiling-and-paging-overheads">
   Accurate Profiling and Paging Overheads
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#nvidia-nsight-systems-profiling">
   NVIDIA Nsight Systems profiling
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-tau">
   Using TAU
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  

<div class="tocsection editthispage">
    <a href="https://gitlab.com/petsc/petsc/edit/release/doc/manual/profiling.rst">
        <i class="fa-solid fa-pencil"></i> Edit this page
    </a>
</div>

</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../_sources/manual/profiling.rst.txt">
        <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 1991-2023, UChicago Argonne, LLC and the PETSc Development Team.<br>

</p>

  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br>
</p>

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
Last updated on 2023-04-30T09:17:39-0500 (v3.19.1).<br>
</p>
  </div>
  
</div>
  </footer>
  </body>
</html>