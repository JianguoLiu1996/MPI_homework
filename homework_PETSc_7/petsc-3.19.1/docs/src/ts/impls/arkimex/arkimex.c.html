<center><a href="https://gitlab.com/petsc/petsc/-/blob/a093114c2e7b4ba1f47e6ac8a72c57724150f16d/src/ts/impls/arkimex/arkimex.c">Actual source code: arkimex.c</a></center><br>

<html>
<head>
<title></title>
<meta name="generator" content="c2html 0.9.4">
<meta name="date" content="2023-04-30T14:19:14+00:00">
</head>

<body bgcolor="#FFFFFF">
<pre width="80">
<a name="line1">  1: </a><font color="#B22222">/*</font>
<a name="line2">  2: </a><font color="#B22222">  Code for timestepping with additive Runge-Kutta IMEX method</font>

<a name="line4">  4: </a><font color="#B22222">  Notes:</font>
<a name="line5">  5: </a><font color="#B22222">  The general system is written as</font>

<a name="line7">  7: </a><font color="#B22222">  F(t,U,Udot) = G(t,U)</font>

<a name="line9">  9: </a><font color="#B22222">  where F represents the stiff part of the physics and G represents the non-stiff part.</font>

<a name="line11"> 11: </a><font color="#B22222">*/</font>
<a name="line12"> 12: </a>#include <A href="../../../../include/petsc/private/tsimpl.h.html">&lt;petsc/private/tsimpl.h&gt;</A>
<a name="line13"> 13: </a>#include <A href="../../../../include/petscdm.h.html">&lt;petscdm.h&gt;</A>

<a name="line15"> 15: </a>static <a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a>  TSARKIMEXDefault = <a href="../../../../manualpages/TS/TSARKIMEX3.html">TSARKIMEX3</a>;
<a name="line16"> 16: </a>static <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a>      TSARKIMEXRegisterAllCalled;
<a name="line17"> 17: </a>static <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a>      TSARKIMEXPackageInitialized;
<a name="line18"> 18: </a><strong><font color="#4169E1">static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSExtrapolate_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a>, <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a>, <a href="../../../../manualpages/Vec/Vec.html">Vec</a>)</font></strong>;

<a name="line20"> 20: </a><font color="#4169E1">typedef struct _ARKTableau *ARKTableau;</font>
<a name="line21"> 21: </a><font color="#4169E1"><a name="_ARKTableau"></a>struct _ARKTableau </font>{
<a name="line22"> 22: </a>  char      *name;
<a name="line23"> 23: </a>  <a href="../../../../manualpages/Sys/PetscInt.html">PetscInt</a>   order;                <font color="#B22222">/* Classical approximation order of the method */</font>
<a name="line24"> 24: </a>  <a href="../../../../manualpages/Sys/PetscInt.html">PetscInt</a>   s;                    <font color="#B22222">/* Number of stages */</font>
<a name="line25"> 25: </a>  <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a>  stiffly_accurate;     <font color="#B22222">/* The implicit part is stiffly accurate*/</font>
<a name="line26"> 26: </a>  <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a>  FSAL_implicit;        <font color="#B22222">/* The implicit part is FSAL*/</font>
<a name="line27"> 27: </a>  <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a>  explicit_first_stage; <font color="#B22222">/* The implicit part has an explicit first stage*/</font>
<a name="line28"> 28: </a>  <a href="../../../../manualpages/Sys/PetscInt.html">PetscInt</a>   pinterp;              <font color="#B22222">/* Interpolation order */</font>
<a name="line29"> 29: </a>  <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> *At, *bt, *ct;         <font color="#B22222">/* Stiff tableau */</font>
<a name="line30"> 30: </a>  <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> *A, *b, *c;            <font color="#B22222">/* Non-stiff tableau */</font>
<a name="line31"> 31: </a>  <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> *bembedt, *bembed;     <font color="#B22222">/* Embedded formula of order one less (order-1) */</font>
<a name="line32"> 32: </a>  <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> *binterpt, *binterp;   <font color="#B22222">/* Dense output formula */</font>
<a name="line33"> 33: </a>  <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a>  ccfl;                 <font color="#B22222">/* Placeholder for CFL coefficient relative to forward Euler */</font>
<a name="line34"> 34: </a>};
<a name="line35"> 35: </a><font color="#4169E1">typedef struct _ARKTableauLink *ARKTableauLink;</font>
<a name="line36"> 36: </a><font color="#4169E1"><a name="_ARKTableauLink"></a>struct _ARKTableauLink </font>{
<a name="line37"> 37: </a>  <font color="#4169E1">struct _ARKTableau</font> tab;
<a name="line38"> 38: </a>  ARKTableauLink     next;
<a name="line39"> 39: </a>};
<a name="line40"> 40: </a>static ARKTableauLink ARKTableauList;

<a name="line42"> 42: </a><font color="#4169E1">typedef</font> <font color="#4169E1">struct</font> {
<a name="line43"> 43: </a>  ARKTableau   tableau;
<a name="line44"> 44: </a>  <a href="../../../../manualpages/Vec/Vec.html">Vec</a>         *Y;            <font color="#B22222">/* States computed during the step */</font>
<a name="line45"> 45: </a>  <a href="../../../../manualpages/Vec/Vec.html">Vec</a>         *YdotI;        <font color="#B22222">/* Time derivatives for the stiff part */</font>
<a name="line46"> 46: </a>  <a href="../../../../manualpages/Vec/Vec.html">Vec</a>         *YdotRHS;      <font color="#B22222">/* Function evaluations for the non-stiff part */</font>
<a name="line47"> 47: </a>  <a href="../../../../manualpages/Vec/Vec.html">Vec</a>         *Y_prev;       <font color="#B22222">/* States computed during the previous time step */</font>
<a name="line48"> 48: </a>  <a href="../../../../manualpages/Vec/Vec.html">Vec</a>         *YdotI_prev;   <font color="#B22222">/* Time derivatives for the stiff part for the previous time step*/</font>
<a name="line49"> 49: </a>  <a href="../../../../manualpages/Vec/Vec.html">Vec</a>         *YdotRHS_prev; <font color="#B22222">/* Function evaluations for the non-stiff part for the previous time step*/</font>
<a name="line50"> 50: </a>  <a href="../../../../manualpages/Vec/Vec.html">Vec</a>          Ydot0;        <font color="#B22222">/* Holds the slope from the previous step in FSAL case */</font>
<a name="line51"> 51: </a>  <a href="../../../../manualpages/Vec/Vec.html">Vec</a>          Ydot;         <font color="#B22222">/* Work vector holding Ydot during residual evaluation */</font>
<a name="line52"> 52: </a>  <a href="../../../../manualpages/Vec/Vec.html">Vec</a>          Z;            <font color="#B22222">/* Ydot = shift(Y-Z) */</font>
<a name="line53"> 53: </a>  <a href="../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> *work;         <font color="#B22222">/* Scalar work */</font>
<a name="line54"> 54: </a>  <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a>    scoeff;       <font color="#B22222">/* shift = scoeff/dt */</font>
<a name="line55"> 55: </a>  <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a>    stage_time;
<a name="line56"> 56: </a>  <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a>    imex;
<a name="line57"> 57: </a>  <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a>    extrapolate; <font color="#B22222">/* Extrapolate initial guess from previous time-step stage values */</font>
<a name="line58"> 58: </a>  TSStepStatus status;

<a name="line60"> 60: </a>  <font color="#B22222">/* context for sensitivity analysis */</font>
<a name="line61"> 61: </a>  <a href="../../../../manualpages/Vec/Vec.html">Vec</a> *VecsDeltaLam;   <font color="#B22222">/* Increment of the adjoint sensitivity w.r.t IC at stage */</font>
<a name="line62"> 62: </a>  <a href="../../../../manualpages/Vec/Vec.html">Vec</a> *VecsSensiTemp;  <font color="#B22222">/* Vectors to be multiplied with Jacobian transpose */</font>
<a name="line63"> 63: </a>  <a href="../../../../manualpages/Vec/Vec.html">Vec</a> *VecsSensiPTemp; <font color="#B22222">/* Temporary Vectors to store JacobianP-transpose-vector product */</font>
<a name="line64"> 64: </a>} TS_ARKIMEX;
<a name="line65"> 65: </a><font color="#B22222">/*MC</font>
<a name="line66"> 66: </a><font color="#B22222">     <a href="../../../../manualpages/TS/TSARKIMEXARS122.html">TSARKIMEXARS122</a> - Second order ARK IMEX scheme.</font>

<a name="line68"> 68: </a><font color="#B22222">     This method has one explicit stage and one implicit stage.</font>

<a name="line70"> 70: </a><font color="#B22222">     Options Database Key:</font>
<a name="line71"> 71: </a><font color="#B22222">.      -ts_arkimex_type ars122 - set arkimex type to ars122</font>

<a name="line73"> 73: </a><font color="#B22222">     Level: advanced</font>

<a name="line75"> 75: </a><font color="#B22222">     References:</font>
<a name="line76"> 76: </a><font color="#B22222">.    * -  U. Ascher, S. Ruuth, R. J. Spiteri, Implicit explicit Runge Kutta methods for time dependent Partial Differential Equations. Appl. Numer. Math. 25, (1997).</font>

<a name="line78"> 78: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a>()`</font>
<a name="line79"> 79: </a><font color="#B22222">M*/</font>
<a name="line80"> 80: </a><font color="#B22222">/*MC</font>
<a name="line81"> 81: </a><font color="#B22222">     <a href="../../../../manualpages/TS/TSARKIMEXA2.html">TSARKIMEXA2</a> - Second order ARK IMEX scheme with A-stable implicit part.</font>

<a name="line83"> 83: </a><font color="#B22222">     This method has an explicit stage and one implicit stage, and has an A-stable implicit scheme. This method was provided by Emil Constantinescu.</font>

<a name="line85"> 85: </a><font color="#B22222">     Options Database Key:</font>
<a name="line86"> 86: </a><font color="#B22222">.      -ts_arkimex_type a2 - set arkimex type to a2</font>

<a name="line88"> 88: </a><font color="#B22222">     Level: advanced</font>

<a name="line90"> 90: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a>()`</font>
<a name="line91"> 91: </a><font color="#B22222">M*/</font>
<a name="line92"> 92: </a><font color="#B22222">/*MC</font>
<a name="line93"> 93: </a><font color="#B22222">     <a href="../../../../manualpages/TS/TSARKIMEXL2.html">TSARKIMEXL2</a> - Second order ARK IMEX scheme with L-stable implicit part.</font>

<a name="line95"> 95: </a><font color="#B22222">     This method has two implicit stages, and L-stable implicit scheme.</font>

<a name="line97"> 97: </a><font color="#B22222">     Options Database Key:</font>
<a name="line98"> 98: </a><font color="#B22222">.      -ts_arkimex_type l2 - set arkimex type to l2</font>

<a name="line100">100: </a><font color="#B22222">     Level: advanced</font>

<a name="line102">102: </a><font color="#B22222">    References:</font>
<a name="line103">103: </a><font color="#B22222">.   * -  L. Pareschi, G. Russo, Implicit Explicit Runge Kutta schemes and applications to hyperbolic systems with relaxations. Journal of Scientific Computing Volume: 25, Issue: 1, October, 2005.</font>

<a name="line105">105: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a>()`</font>
<a name="line106">106: </a><font color="#B22222">M*/</font>
<a name="line107">107: </a><font color="#B22222">/*MC</font>
<a name="line108">108: </a><font color="#B22222">     <a href="../../../../manualpages/TS/TSARKIMEX1BEE.html">TSARKIMEX1BEE</a> - First order backward Euler represented as an ARK IMEX scheme with extrapolation as error estimator. This is a 3-stage method.</font>

<a name="line110">110: </a><font color="#B22222">     This method is aimed at starting the integration of implicit DAEs when explicit first-stage ARK methods are used.</font>

<a name="line112">112: </a><font color="#B22222">     Options Database Key:</font>
<a name="line113">113: </a><font color="#B22222">.      -ts_arkimex_type 1bee - set arkimex type to 1bee</font>

<a name="line115">115: </a><font color="#B22222">     Level: advanced</font>

<a name="line117">117: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a>()`</font>
<a name="line118">118: </a><font color="#B22222">M*/</font>
<a name="line119">119: </a><font color="#B22222">/*MC</font>
<a name="line120">120: </a><font color="#B22222">     <a href="../../../../manualpages/TS/TSARKIMEX2C.html">TSARKIMEX2C</a> - Second order ARK IMEX scheme with L-stable implicit part.</font>

<a name="line122">122: </a><font color="#B22222">     This method has one explicit stage and two implicit stages. The implicit part is the same as in <a href="../../../../manualpages/TS/TSARKIMEX2D.html">TSARKIMEX2D</a> and <a href="../../../../manualpages/TS/TSARKIMEX2E.html">TSARKIMEX2E</a>, but the explicit part has a larger stability region on the negative real axis. This method was provided by Emil Constantinescu.</font>

<a name="line124">124: </a><font color="#B22222">     Options Database Key:</font>
<a name="line125">125: </a><font color="#B22222">.      -ts_arkimex_type 2c - set arkimex type to 2c</font>

<a name="line127">127: </a><font color="#B22222">     Level: advanced</font>

<a name="line129">129: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a>()`</font>
<a name="line130">130: </a><font color="#B22222">M*/</font>
<a name="line131">131: </a><font color="#B22222">/*MC</font>
<a name="line132">132: </a><font color="#B22222">     <a href="../../../../manualpages/TS/TSARKIMEX2D.html">TSARKIMEX2D</a> - Second order ARK IMEX scheme with L-stable implicit part.</font>

<a name="line134">134: </a><font color="#B22222">     This method has one explicit stage and two implicit stages. The stability function is independent of the explicit part in the infinity limit of the implicit component. This method was provided by Emil Constantinescu.</font>

<a name="line136">136: </a><font color="#B22222">     Options Database Key:</font>
<a name="line137">137: </a><font color="#B22222">.      -ts_arkimex_type 2d - set arkimex type to 2d</font>

<a name="line139">139: </a><font color="#B22222">     Level: advanced</font>

<a name="line141">141: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a>()`</font>
<a name="line142">142: </a><font color="#B22222">M*/</font>
<a name="line143">143: </a><font color="#B22222">/*MC</font>
<a name="line144">144: </a><font color="#B22222">     <a href="../../../../manualpages/TS/TSARKIMEX2E.html">TSARKIMEX2E</a> - Second order ARK IMEX scheme with L-stable implicit part.</font>

<a name="line146">146: </a><font color="#B22222">     This method has one explicit stage and two implicit stages. It is is an optimal method developed by Emil Constantinescu.</font>

<a name="line148">148: </a><font color="#B22222">     Options Database Key:</font>
<a name="line149">149: </a><font color="#B22222">.      -ts_arkimex_type 2e - set arkimex type to 2e</font>

<a name="line151">151: </a><font color="#B22222">    Level: advanced</font>

<a name="line153">153: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a>()`</font>
<a name="line154">154: </a><font color="#B22222">M*/</font>
<a name="line155">155: </a><font color="#B22222">/*MC</font>
<a name="line156">156: </a><font color="#B22222">     <a href="../../../../manualpages/TS/TSARKIMEXPRSSP2.html">TSARKIMEXPRSSP2</a> - Second order SSP ARK IMEX scheme.</font>

<a name="line158">158: </a><font color="#B22222">     This method has three implicit stages.</font>

<a name="line160">160: </a><font color="#B22222">     References:</font>
<a name="line161">161: </a><font color="#B22222">.    * -  L. Pareschi, G. Russo, Implicit Explicit Runge Kutta schemes and applications to hyperbolic systems with relaxations. Journal of Scientific Computing Volume: 25, Issue: 1, October, 2005.</font>

<a name="line163">163: </a><font color="#B22222">     This method is referred to as SSP2-(3,3,2) in https://arxiv.org/abs/1110.4375</font>

<a name="line165">165: </a><font color="#B22222">     Options Database Key:</font>
<a name="line166">166: </a><font color="#B22222">.      -ts_arkimex_type prssp2 - set arkimex type to prssp2</font>

<a name="line168">168: </a><font color="#B22222">     Level: advanced</font>

<a name="line170">170: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a>()`</font>
<a name="line171">171: </a><font color="#B22222">M*/</font>
<a name="line172">172: </a><font color="#B22222">/*MC</font>
<a name="line173">173: </a><font color="#B22222">     <a href="../../../../manualpages/TS/TSARKIMEX3.html">TSARKIMEX3</a> - Third order ARK IMEX scheme with L-stable implicit part.</font>

<a name="line175">175: </a><font color="#B22222">     This method has one explicit stage and three implicit stages.</font>

<a name="line177">177: </a><font color="#B22222">     Options Database Key:</font>
<a name="line178">178: </a><font color="#B22222">.      -ts_arkimex_type 3 - set arkimex type to 3</font>

<a name="line180">180: </a><font color="#B22222">     Level: advanced</font>

<a name="line182">182: </a><font color="#B22222">     References:</font>
<a name="line183">183: </a><font color="#B22222">.    * -  Kennedy and Carpenter 2003.</font>

<a name="line185">185: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a>()`</font>
<a name="line186">186: </a><font color="#B22222">M*/</font>
<a name="line187">187: </a><font color="#B22222">/*MC</font>
<a name="line188">188: </a><font color="#B22222">     <a href="../../../../manualpages/TS/TSARKIMEXARS443.html">TSARKIMEXARS443</a> - Third order ARK IMEX scheme.</font>

<a name="line190">190: </a><font color="#B22222">     This method has one explicit stage and four implicit stages.</font>

<a name="line192">192: </a><font color="#B22222">     Options Database Key:</font>
<a name="line193">193: </a><font color="#B22222">.      -ts_arkimex_type ars443 - set arkimex type to ars443</font>

<a name="line195">195: </a><font color="#B22222">     Level: advanced</font>

<a name="line197">197: </a><font color="#B22222">     References:</font>
<a name="line198">198: </a><font color="#B22222">+    * -  U. Ascher, S. Ruuth, R. J. Spiteri, Implicit explicit Runge Kutta methods for time dependent Partial Differential Equations. Appl. Numer. Math. 25, (1997).</font>
<a name="line199">199: </a><font color="#B22222">-    * -  This method is referred to as ARS(4,4,3) in https://arxiv.org/abs/1110.4375</font>

<a name="line201">201: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a>()`</font>
<a name="line202">202: </a><font color="#B22222">M*/</font>
<a name="line203">203: </a><font color="#B22222">/*MC</font>
<a name="line204">204: </a><font color="#B22222">     <a href="../../../../manualpages/TS/TSARKIMEXBPR3.html">TSARKIMEXBPR3</a> - Third order ARK IMEX scheme.</font>

<a name="line206">206: </a><font color="#B22222">     This method has one explicit stage and four implicit stages.</font>

<a name="line208">208: </a><font color="#B22222">     Options Database Key:</font>
<a name="line209">209: </a><font color="#B22222">.      -ts_arkimex_type bpr3 - set arkimex type to bpr3</font>

<a name="line211">211: </a><font color="#B22222">     Level: advanced</font>

<a name="line213">213: </a><font color="#B22222">     References:</font>
<a name="line214">214: </a><font color="#B22222">.    * - This method is referred to as ARK3 in https://arxiv.org/abs/1110.4375</font>

<a name="line216">216: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a>()`</font>
<a name="line217">217: </a><font color="#B22222">M*/</font>
<a name="line218">218: </a><font color="#B22222">/*MC</font>
<a name="line219">219: </a><font color="#B22222">     <a href="../../../../manualpages/TS/TSARKIMEX4.html">TSARKIMEX4</a> - Fourth order ARK IMEX scheme with L-stable implicit part.</font>

<a name="line221">221: </a><font color="#B22222">     This method has one explicit stage and four implicit stages.</font>

<a name="line223">223: </a><font color="#B22222">     Options Database Key:</font>
<a name="line224">224: </a><font color="#B22222">.      -ts_arkimex_type 4 - set arkimex type to4</font>

<a name="line226">226: </a><font color="#B22222">     Level: advanced</font>

<a name="line228">228: </a><font color="#B22222">     References:</font>
<a name="line229">229: </a><font color="#B22222">.    * - Kennedy and Carpenter 2003.</font>

<a name="line231">231: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a>()`</font>
<a name="line232">232: </a><font color="#B22222">M*/</font>
<a name="line233">233: </a><font color="#B22222">/*MC</font>
<a name="line234">234: </a><font color="#B22222">     <a href="../../../../manualpages/TS/TSARKIMEX5.html">TSARKIMEX5</a> - Fifth order ARK IMEX scheme with L-stable implicit part.</font>

<a name="line236">236: </a><font color="#B22222">     This method has one explicit stage and five implicit stages.</font>

<a name="line238">238: </a><font color="#B22222">     Options Database Key:</font>
<a name="line239">239: </a><font color="#B22222">.      -ts_arkimex_type 5 - set arkimex type to 5</font>

<a name="line241">241: </a><font color="#B22222">     Level: advanced</font>

<a name="line243">243: </a><font color="#B22222">     References:</font>
<a name="line244">244: </a><font color="#B22222">.    * - Kennedy and Carpenter 2003.</font>

<a name="line246">246: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a>()`</font>
<a name="line247">247: </a><font color="#B22222">M*/</font>

<a name="line249">249: </a><font color="#B22222">/*@C</font>
<a name="line250">250: </a><font color="#B22222">  <a href="../../../../manualpages/TS/TSARKIMEXRegisterAll.html">TSARKIMEXRegisterAll</a> - Registers all of the additive Runge-Kutta implicit-explicit methods in `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>`</font>

<a name="line252">252: </a><font color="#B22222">  Not Collective, but should be called by all processes which will need the schemes to be registered</font>

<a name="line254">254: </a><font color="#B22222">  Level: advanced</font>

<a name="line256">256: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TS.html">TS</a>`, `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXRegisterDestroy.html">TSARKIMEXRegisterDestroy</a>()`</font>
<a name="line257">257: </a><font color="#B22222">@*/</font>
<a name="line258">258: </a><strong><font color="#4169E1"><a name="TSARKIMEXRegisterAll"></a><a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../manualpages/TS/TSARKIMEXRegisterAll.html">TSARKIMEXRegisterAll</a>(void)</font></strong>
<a name="line259">259: </a>{
<a name="line260">260: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line261">261: </a>  <font color="#4169E1">if</font> (TSARKIMEXRegisterAllCalled) <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line262">262: </a>  TSARKIMEXRegisterAllCalled = <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_TRUE</a>;

<a name="line264">264: </a>  {
<a name="line265">265: </a>    const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> A[3][3] =
<a name="line266">266: </a>      {
<a name="line267">267: </a>        {0.0, 0.0, 0.0},
<a name="line268">268: </a>        {0.0, 0.0, 0.0},
<a name="line269">269: </a>        {0.0, 0.5, 0.0}
<a name="line270">270: </a>    },
<a name="line271">271: </a>                    At[3][3] = {{1.0, 0.0, 0.0}, {0.0, 0.5, 0.0}, {0.0, 0.5, 0.5}}, b[3] = {0.0, 0.5, 0.5}, bembedt[3] = {1.0, 0.0, 0.0};
<a name="line272">272: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXRegister.html">TSARKIMEXRegister</a>(<a href="../../../../manualpages/TS/TSARKIMEX1BEE.html">TSARKIMEX1BEE</a>, 2, 3, &amp;At[0][0], b, NULL, &amp;A[0][0], b, NULL, bembedt, bembedt, 1, b, NULL));
<a name="line273">273: </a>  }
<a name="line274">274: </a>  {
<a name="line275">275: </a>    const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> A[2][2] =
<a name="line276">276: </a>      {
<a name="line277">277: </a>        {0.0, 0.0},
<a name="line278">278: </a>        {0.5, 0.0}
<a name="line279">279: </a>    },
<a name="line280">280: </a>                    At[2][2] = {{0.0, 0.0}, {0.0, 0.5}}, b[2] = {0.0, 1.0}, bembedt[2] = {0.5, 0.5};
<a name="line281">281: </a>    <font color="#B22222">/* binterpt[2][2] = {{1.0,-1.0},{0.0,1.0}};  second order dense output has poor stability properties and hence it is not currently in use*/</font>
<a name="line282">282: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXRegister.html">TSARKIMEXRegister</a>(<a href="../../../../manualpages/TS/TSARKIMEXARS122.html">TSARKIMEXARS122</a>, 2, 2, &amp;At[0][0], b, NULL, &amp;A[0][0], b, NULL, bembedt, bembedt, 1, b, NULL));
<a name="line283">283: </a>  }
<a name="line284">284: </a>  {
<a name="line285">285: </a>    const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> A[2][2] =
<a name="line286">286: </a>      {
<a name="line287">287: </a>        {0.0, 0.0},
<a name="line288">288: </a>        {1.0, 0.0}
<a name="line289">289: </a>    },
<a name="line290">290: </a>                    At[2][2] = {{0.0, 0.0}, {0.5, 0.5}}, b[2] = {0.5, 0.5}, bembedt[2] = {0.0, 1.0};
<a name="line291">291: </a>    <font color="#B22222">/* binterpt[2][2] = {{1.0,-0.5},{0.0,0.5}}  second order dense output has poor stability properties and hence it is not currently in use*/</font>
<a name="line292">292: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXRegister.html">TSARKIMEXRegister</a>(<a href="../../../../manualpages/TS/TSARKIMEXA2.html">TSARKIMEXA2</a>, 2, 2, &amp;At[0][0], b, NULL, &amp;A[0][0], b, NULL, bembedt, bembedt, 1, b, NULL));
<a name="line293">293: </a>  }
<a name="line294">294: </a>  {
<a name="line295">295: </a>    <font color="#B22222">/* const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> us2 = 1.0-1.0/PetscSqrtReal((<a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a>)2.0);    Direct evaluation: 0.2928932188134524755992. Used below to ensure all values are available at compile time   */</font>
<a name="line296">296: </a>    const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> A[2][2] =
<a name="line297">297: </a>      {
<a name="line298">298: </a>        {0.0, 0.0},
<a name="line299">299: </a>        {1.0, 0.0}
<a name="line300">300: </a>    },
<a name="line301">301: </a>                    At[2][2] = {{0.2928932188134524755992, 0.0}, {1.0 - 2.0 * 0.2928932188134524755992, 0.2928932188134524755992}}, b[2] = {0.5, 0.5}, bembedt[2] = {0.0, 1.0}, binterpt[2][2] = {{(0.2928932188134524755992 - 1.0) / (2.0 * 0.2928932188134524755992 - 1.0), -1 / (2.0 * (1.0 - 2.0 * 0.2928932188134524755992))}, {1 - (0.2928932188134524755992 - 1.0) / (2.0 * 0.2928932188134524755992 - 1.0), -1 / (2.0 * (1.0 - 2.0 * 0.2928932188134524755992))}}, binterp[2][2] = {{1.0, -0.5}, {0.0, 0.5}};
<a name="line302">302: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXRegister.html">TSARKIMEXRegister</a>(<a href="../../../../manualpages/TS/TSARKIMEXL2.html">TSARKIMEXL2</a>, 2, 2, &amp;At[0][0], b, NULL, &amp;A[0][0], b, NULL, bembedt, bembedt, 2, binterpt[0], binterp[0]));
<a name="line303">303: </a>  }
<a name="line304">304: </a>  {
<a name="line305">305: </a>    <font color="#B22222">/* const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> s2 = PetscSqrtReal((<a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a>)2.0),  Direct evaluation: 1.414213562373095048802. Used below to ensure all values are available at compile time   */</font>
<a name="line306">306: </a>    const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> A[3][3] =
<a name="line307">307: </a>      {
<a name="line308">308: </a>        {0,                           0,   0},
<a name="line309">309: </a>        {2 - 1.414213562373095048802, 0,   0},
<a name="line310">310: </a>        {0.5,                         0.5, 0}
<a name="line311">311: </a>    },
<a name="line312">312: </a>                    At[3][3] = {{0, 0, 0}, {1 - 1 / 1.414213562373095048802, 1 - 1 / 1.414213562373095048802, 0}, {1 / (2 * 1.414213562373095048802), 1 / (2 * 1.414213562373095048802), 1 - 1 / 1.414213562373095048802}}, bembedt[3] = {(4. - 1.414213562373095048802) / 8., (4. - 1.414213562373095048802) / 8., 1 / (2. * 1.414213562373095048802)}, binterpt[3][2] = {{1.0 / 1.414213562373095048802, -1.0 / (2.0 * 1.414213562373095048802)}, {1.0 / 1.414213562373095048802, -1.0 / (2.0 * 1.414213562373095048802)}, {1.0 - 1.414213562373095048802, 1.0 / 1.414213562373095048802}};
<a name="line313">313: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXRegister.html">TSARKIMEXRegister</a>(<a href="../../../../manualpages/TS/TSARKIMEX2C.html">TSARKIMEX2C</a>, 2, 3, &amp;At[0][0], NULL, NULL, &amp;A[0][0], NULL, NULL, bembedt, bembedt, 2, binterpt[0], NULL));
<a name="line314">314: </a>  }
<a name="line315">315: </a>  {
<a name="line316">316: </a>    <font color="#B22222">/* const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> s2 = PetscSqrtReal((<a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a>)2.0),  Direct evaluation: 1.414213562373095048802. Used below to ensure all values are available at compile time   */</font>
<a name="line317">317: </a>    const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> A[3][3] =
<a name="line318">318: </a>      {
<a name="line319">319: </a>        {0,                           0,    0},
<a name="line320">320: </a>        {2 - 1.414213562373095048802, 0,    0},
<a name="line321">321: </a>        {0.75,                        0.25, 0}
<a name="line322">322: </a>    },
<a name="line323">323: </a>                    At[3][3] = {{0, 0, 0}, {1 - 1 / 1.414213562373095048802, 1 - 1 / 1.414213562373095048802, 0}, {1 / (2 * 1.414213562373095048802), 1 / (2 * 1.414213562373095048802), 1 - 1 / 1.414213562373095048802}}, bembedt[3] = {(4. - 1.414213562373095048802) / 8., (4. - 1.414213562373095048802) / 8., 1 / (2. * 1.414213562373095048802)}, binterpt[3][2] = {{1.0 / 1.414213562373095048802, -1.0 / (2.0 * 1.414213562373095048802)}, {1.0 / 1.414213562373095048802, -1.0 / (2.0 * 1.414213562373095048802)}, {1.0 - 1.414213562373095048802, 1.0 / 1.414213562373095048802}};
<a name="line324">324: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXRegister.html">TSARKIMEXRegister</a>(<a href="../../../../manualpages/TS/TSARKIMEX2D.html">TSARKIMEX2D</a>, 2, 3, &amp;At[0][0], NULL, NULL, &amp;A[0][0], NULL, NULL, bembedt, bembedt, 2, binterpt[0], NULL));
<a name="line325">325: </a>  }
<a name="line326">326: </a>  { <font color="#B22222">/* Optimal for linear implicit part */</font>
<a name="line327">327: </a>    <font color="#B22222">/* const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> s2 = PetscSqrtReal((<a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a>)2.0),  Direct evaluation: 1.414213562373095048802. Used below to ensure all values are available at compile time   */</font>
<a name="line328">328: </a>    const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> A[3][3] =
<a name="line329">329: </a>      {
<a name="line330">330: </a>        {0,                                     0,                                     0},
<a name="line331">331: </a>        {2 - 1.414213562373095048802,           0,                                     0},
<a name="line332">332: </a>        {(3 - 2 * 1.414213562373095048802) / 6, (3 + 2 * 1.414213562373095048802) / 6, 0}
<a name="line333">333: </a>    },
<a name="line334">334: </a>                    At[3][3] = {{0, 0, 0}, {1 - 1 / 1.414213562373095048802, 1 - 1 / 1.414213562373095048802, 0}, {1 / (2 * 1.414213562373095048802), 1 / (2 * 1.414213562373095048802), 1 - 1 / 1.414213562373095048802}}, bembedt[3] = {(4. - 1.414213562373095048802) / 8., (4. - 1.414213562373095048802) / 8., 1 / (2. * 1.414213562373095048802)}, binterpt[3][2] = {{1.0 / 1.414213562373095048802, -1.0 / (2.0 * 1.414213562373095048802)}, {1.0 / 1.414213562373095048802, -1.0 / (2.0 * 1.414213562373095048802)}, {1.0 - 1.414213562373095048802, 1.0 / 1.414213562373095048802}};
<a name="line335">335: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXRegister.html">TSARKIMEXRegister</a>(<a href="../../../../manualpages/TS/TSARKIMEX2E.html">TSARKIMEX2E</a>, 2, 3, &amp;At[0][0], NULL, NULL, &amp;A[0][0], NULL, NULL, bembedt, bembedt, 2, binterpt[0], NULL));
<a name="line336">336: </a>  }
<a name="line337">337: </a>  { <font color="#B22222">/* Optimal for linear implicit part */</font>
<a name="line338">338: </a>    const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> A[3][3] =
<a name="line339">339: </a>      {
<a name="line340">340: </a>        {0,   0,   0},
<a name="line341">341: </a>        {0.5, 0,   0},
<a name="line342">342: </a>        {0.5, 0.5, 0}
<a name="line343">343: </a>    },
<a name="line344">344: </a>                    At[3][3] = {{0.25, 0, 0}, {0, 0.25, 0}, {1. / 3, 1. / 3, 1. / 3}};
<a name="line345">345: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXRegister.html">TSARKIMEXRegister</a>(<a href="../../../../manualpages/TS/TSARKIMEXPRSSP2.html">TSARKIMEXPRSSP2</a>, 2, 3, &amp;At[0][0], NULL, NULL, &amp;A[0][0], NULL, NULL, NULL, NULL, 0, NULL, NULL));
<a name="line346">346: </a>  }
<a name="line347">347: </a>  {
<a name="line348">348: </a>    const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> A[4][4] =
<a name="line349">349: </a>      {
<a name="line350">350: </a>        {0,                                0,                                0,                                 0},
<a name="line351">351: </a>        {1767732205903. / 2027836641118.,  0,                                0,                                 0},
<a name="line352">352: </a>        {5535828885825. / 10492691773637., 788022342437. / 10882634858940.,  0,                                 0},
<a name="line353">353: </a>        {6485989280629. / 16251701735622., -4246266847089. / 9704473918619., 10755448449292. / 10357097424841., 0}
<a name="line354">354: </a>    },
<a name="line355">355: </a>                    At[4][4] = {{0, 0, 0, 0}, {1767732205903. / 4055673282236., 1767732205903. / 4055673282236., 0, 0}, {2746238789719. / 10658868560708., -640167445237. / 6845629431997., 1767732205903. / 4055673282236., 0}, {1471266399579. / 7840856788654., -4482444167858. / 7529755066697., 11266239266428. / 11593286722821., 1767732205903. / 4055673282236.}}, bembedt[4] = {2756255671327. / 12835298489170., -10771552573575. / 22201958757719., 9247589265047. / 10645013368117., 2193209047091. / 5459859503100.}, binterpt[4][2] = {{4655552711362. / 22874653954995., -215264564351. / 13552729205753.}, {-18682724506714. / 9892148508045., 17870216137069. / 13817060693119.}, {34259539580243. / 13192909600954., -28141676662227. / 17317692491321.}, {584795268549. / 6622622206610., 2508943948391. / 7218656332882.}};
<a name="line356">356: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXRegister.html">TSARKIMEXRegister</a>(<a href="../../../../manualpages/TS/TSARKIMEX3.html">TSARKIMEX3</a>, 3, 4, &amp;At[0][0], NULL, NULL, &amp;A[0][0], NULL, NULL, bembedt, bembedt, 2, binterpt[0], NULL));
<a name="line357">357: </a>  }
<a name="line358">358: </a>  {
<a name="line359">359: </a>    const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> A[5][5] =
<a name="line360">360: </a>      {
<a name="line361">361: </a>        {0,        0,       0,      0,       0},
<a name="line362">362: </a>        {1. / 2,   0,       0,      0,       0},
<a name="line363">363: </a>        {11. / 18, 1. / 18, 0,      0,       0},
<a name="line364">364: </a>        {5. / 6,   -5. / 6, .5,     0,       0},
<a name="line365">365: </a>        {1. / 4,   7. / 4,  3. / 4, -7. / 4, 0}
<a name="line366">366: </a>    },
<a name="line367">367: </a>                    At[5][5] = {{0, 0, 0, 0, 0}, {0, 1. / 2, 0, 0, 0}, {0, 1. / 6, 1. / 2, 0, 0}, {0, -1. / 2, 1. / 2, 1. / 2, 0}, {0, 3. / 2, -3. / 2, 1. / 2, 1. / 2}}, *bembedt = NULL;
<a name="line368">368: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXRegister.html">TSARKIMEXRegister</a>(<a href="../../../../manualpages/TS/TSARKIMEXARS443.html">TSARKIMEXARS443</a>, 3, 5, &amp;At[0][0], NULL, NULL, &amp;A[0][0], NULL, NULL, bembedt, bembedt, 0, NULL, NULL));
<a name="line369">369: </a>  }
<a name="line370">370: </a>  {
<a name="line371">371: </a>    const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> A[5][5] =
<a name="line372">372: </a>      {
<a name="line373">373: </a>        {0,      0,      0,      0, 0},
<a name="line374">374: </a>        {1,      0,      0,      0, 0},
<a name="line375">375: </a>        {4. / 9, 2. / 9, 0,      0, 0},
<a name="line376">376: </a>        {1. / 4, 0,      3. / 4, 0, 0},
<a name="line377">377: </a>        {1. / 4, 0,      3. / 5, 0, 0}
<a name="line378">378: </a>    },
<a name="line379">379: </a>                    At[5][5] = {{0, 0, 0, 0, 0}, {.5, .5, 0, 0, 0}, {5. / 18, -1. / 9, .5, 0, 0}, {.5, 0, 0, .5, 0}, {.25, 0, .75, -.5, .5}}, *bembedt = NULL;
<a name="line380">380: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXRegister.html">TSARKIMEXRegister</a>(<a href="../../../../manualpages/TS/TSARKIMEXBPR3.html">TSARKIMEXBPR3</a>, 3, 5, &amp;At[0][0], NULL, NULL, &amp;A[0][0], NULL, NULL, bembedt, bembedt, 0, NULL, NULL));
<a name="line381">381: </a>  }
<a name="line382">382: </a>  {
<a name="line383">383: </a>    const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> A[6][6] =
<a name="line384">384: </a>      {
<a name="line385">385: </a>        {0,                               0,                                 0,                                 0,                                0,              0},
<a name="line386">386: </a>        {1. / 2,                          0,                                 0,                                 0,                                0,              0},
<a name="line387">387: </a>        {13861. / 62500.,                 6889. / 62500.,                    0,                                 0,                                0,              0},
<a name="line388">388: </a>        {-116923316275. / 2393684061468., -2731218467317. / 15368042101831., 9408046702089. / 11113171139209.,  0,                                0,              0},
<a name="line389">389: </a>        {-451086348788. / 2902428689909., -2682348792572. / 7519795681897.,  12662868775082. / 11960479115383., 3355817975965. / 11060851509271., 0,              0},
<a name="line390">390: </a>        {647845179188. / 3216320057751.,  73281519250. / 8382639484533.,     552539513391. / 3454668386233.,    3354512671639. / 8306763924573.,  4040. / 17871., 0}
<a name="line391">391: </a>    },
<a name="line392">392: </a>                    At[6][6] = {{0, 0, 0, 0, 0, 0}, {1. / 4, 1. / 4, 0, 0, 0, 0}, {8611. / 62500., -1743. / 31250., 1. / 4, 0, 0, 0}, {5012029. / 34652500., -654441. / 2922500., 174375. / 388108., 1. / 4, 0, 0}, {15267082809. / 155376265600., -71443401. / 120774400., 730878875. / 902184768., 2285395. / 8070912., 1. / 4, 0}, {82889. / 524892., 0, 15625. / 83664., 69875. / 102672., -2260. / 8211, 1. / 4}}, bembedt[6] = {4586570599. / 29645900160., 0, 178811875. / 945068544., 814220225. / 1159782912., -3700637. / 11593932., 61727. / 225920.}, binterpt[6][3] = {{6943876665148. / 7220017795957., -54480133. / 30881146., 6818779379841. / 7100303317025.},  {0, 0, 0},
<a name="line393">393: </a>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {7640104374378. / 9702883013639., -11436875. / 14766696., 2173542590792. / 12501825683035.}, {-20649996744609. / 7521556579894., 174696575. / 18121608., -31592104683404. / 5083833661969.},
<a name="line394">394: </a>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {8854892464581. / 2390941311638., -12120380. / 966161., 61146701046299. / 7138195549469.},   {-11397109935349. / 6675773540249., 3843. / 706., -17219254887155. / 4939391667607.}};
<a name="line395">395: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXRegister.html">TSARKIMEXRegister</a>(<a href="../../../../manualpages/TS/TSARKIMEX4.html">TSARKIMEX4</a>, 4, 6, &amp;At[0][0], NULL, NULL, &amp;A[0][0], NULL, NULL, bembedt, bembedt, 3, binterpt[0], NULL));
<a name="line396">396: </a>  }
<a name="line397">397: </a>  {
<a name="line398">398: </a>    const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> A[8][8] =
<a name="line399">399: </a>      {
<a name="line400">400: </a>        {0,                                  0,                              0,                                 0,                                  0,                               0,                                 0,                               0},
<a name="line401">401: </a>        {41. / 100,                          0,                              0,                                 0,                                  0,                               0,                                 0,                               0},
<a name="line402">402: </a>        {367902744464. / 2072280473677.,     677623207551. / 8224143866563., 0,                                 0,                                  0,                               0,                                 0,                               0},
<a name="line403">403: </a>        {1268023523408. / 10340822734521.,   0,                              1029933939417. / 13636558850479.,  0,                                  0,                               0,                                 0,                               0},
<a name="line404">404: </a>        {14463281900351. / 6315353703477.,   0,                              66114435211212. / 5879490589093.,  -54053170152839. / 4284798021562.,  0,                               0,                                 0,                               0},
<a name="line405">405: </a>        {14090043504691. / 34967701212078.,  0,                              15191511035443. / 11219624916014., -18461159152457. / 12425892160975., -281667163811. / 9011619295870., 0,                                 0,                               0},
<a name="line406">406: </a>        {19230459214898. / 13134317526959.,  0,                              21275331358303. / 2942455364971.,  -38145345988419. / 4862620318723.,  -1. / 8,                         -1. / 8,                           0,                               0},
<a name="line407">407: </a>        {-19977161125411. / 11928030595625., 0,                              -40795976796054. / 6384907823539., 177454434618887. / 12078138498510., 782672205425. / 8267701900261.,  -69563011059811. / 9646580694205., 7356628210526. / 4942186776405., 0}
<a name="line408">408: </a>    },
<a name="line409">409: </a>                    At[8][8] = {{0, 0, 0, 0, 0, 0, 0, 0}, {41. / 200., 41. / 200., 0, 0, 0, 0, 0, 0}, {41. / 400., -567603406766. / 11931857230679., 41. / 200., 0, 0, 0, 0, 0}, {683785636431. / 9252920307686., 0, -110385047103. / 1367015193373., 41. / 200., 0, 0, 0, 0}, {3016520224154. / 10081342136671., 0, 30586259806659. / 12414158314087., -22760509404356. / 11113319521817., 41. / 200., 0, 0, 0}, {218866479029. / 1489978393911., 0, 638256894668. / 5436446318841., -1179710474555. / 5321154724896., -60928119172. / 8023461067671., 41. / 200., 0, 0}, {1020004230633. / 5715676835656., 0, 25762820946817. / 25263940353407., -2161375909145. / 9755907335909., -211217309593. / 5846859502534., -4269925059573. / 7827059040749., 41. / 200, 0}, {-872700587467. / 9133579230613., 0, 0, 22348218063261. / 9555858737531., -1143369518992. / 8141816002931., -39379526789629. / 19018526304540., 32727382324388. / 42900044865799., 41. / 200.}}, bembedt[8] = {-975461918565. / 9796059967033., 0, 0, 78070527104295. / 32432590147079., -548382580838. / 3424219808633., -33438840321285. / 15594753105479., 3629800801594. / 4656183773603., 4035322873751. / 18575991585200.}, binterpt[8][3] = {{-17674230611817. / 10670229744614., 43486358583215. / 12773830924787., -9257016797708. / 5021505065439.}, {0, 0, 0}, {0, 0, 0}, {65168852399939. / 7868540260826., -91478233927265. / 11067650958493., 26096422576131. / 11239449250142.}, {15494834004392. / 5936557850923., -79368583304911. / 10890268929626., 92396832856987. / 20362823103730.}, {-99329723586156. / 26959484932159., -12239297817655. / 9152339842473., 30029262896817. / 10175596800299.}, {-19024464361622. / 5461577185407., 115839755401235. / 10719374521269., -26136350496073. / 3983972220547.}, {-6511271360970. / 6095937251113., 5843115559534. / 2180450260947., -5289405421727. / 3760307252460.}};
<a name="line410">410: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXRegister.html">TSARKIMEXRegister</a>(<a href="../../../../manualpages/TS/TSARKIMEX5.html">TSARKIMEX5</a>, 5, 8, &amp;At[0][0], NULL, NULL, &amp;A[0][0], NULL, NULL, bembedt, bembedt, 3, binterpt[0], NULL));
<a name="line411">411: </a>  }
<a name="line412">412: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line413">413: </a>}

<a name="line415">415: </a><font color="#B22222">/*@C</font>
<a name="line416">416: </a><font color="#B22222">   <a href="../../../../manualpages/TS/TSARKIMEXRegisterDestroy.html">TSARKIMEXRegisterDestroy</a> - Frees the list of schemes that were registered by `<a href="../../../../manualpages/TS/TSARKIMEXRegister.html">TSARKIMEXRegister</a>()`.</font>

<a name="line418">418: </a><font color="#B22222">   Not Collective</font>

<a name="line420">420: </a><font color="#B22222">   Level: advanced</font>

<a name="line422">422: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXRegister.html">TSARKIMEXRegister</a>()`, `<a href="../../../../manualpages/TS/TSARKIMEXRegisterAll.html">TSARKIMEXRegisterAll</a>()`</font>
<a name="line423">423: </a><font color="#B22222">@*/</font>
<a name="line424">424: </a><strong><font color="#4169E1"><a name="TSARKIMEXRegisterDestroy"></a><a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../manualpages/TS/TSARKIMEXRegisterDestroy.html">TSARKIMEXRegisterDestroy</a>(void)</font></strong>
<a name="line425">425: </a>{
<a name="line426">426: </a>  ARKTableauLink link;

<a name="line428">428: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line429">429: </a>  <font color="#4169E1">while</font> ((link = ARKTableauList)) {
<a name="line430">430: </a>    ARKTableau t   = &amp;link-&gt;tab;
<a name="line431">431: </a>    ARKTableauList = link-&gt;next;
<a name="line432">432: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscFree6.html">PetscFree6</a>(t-&gt;At, t-&gt;bt, t-&gt;ct, t-&gt;A, t-&gt;b, t-&gt;c));
<a name="line433">433: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscFree2.html">PetscFree2</a>(t-&gt;bembedt, t-&gt;bembed));
<a name="line434">434: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscFree2.html">PetscFree2</a>(t-&gt;binterpt, t-&gt;binterp));
<a name="line435">435: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscFree.html">PetscFree</a>(t-&gt;name));
<a name="line436">436: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscFree.html">PetscFree</a>(link));
<a name="line437">437: </a>  }
<a name="line438">438: </a>  TSARKIMEXRegisterAllCalled = <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_FALSE</a>;
<a name="line439">439: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line440">440: </a>}

<a name="line442">442: </a><font color="#B22222">/*@C</font>
<a name="line443">443: </a><font color="#B22222">  <a href="../../../../manualpages/TS/TSARKIMEXInitializePackage.html">TSARKIMEXInitializePackage</a> - This function initializes everything in the `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>` package. It is called</font>
<a name="line444">444: </a><font color="#B22222">  from `<a href="../../../../manualpages/TS/TSInitializePackage.html">TSInitializePackage</a>()`.</font>

<a name="line446">446: </a><font color="#B22222">  Level: developer</font>

<a name="line448">448: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/Sys/PetscInitialize.html">PetscInitialize</a>()`, `<a href="../../../../manualpages/TS/TSARKIMEXFinalizePackage.html">TSARKIMEXFinalizePackage</a>()`</font>
<a name="line449">449: </a><font color="#B22222">@*/</font>
<a name="line450">450: </a><strong><font color="#4169E1"><a name="TSARKIMEXInitializePackage"></a><a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../manualpages/TS/TSARKIMEXInitializePackage.html">TSARKIMEXInitializePackage</a>(void)</font></strong>
<a name="line451">451: </a>{
<a name="line452">452: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line453">453: </a>  <font color="#4169E1">if</font> (TSARKIMEXPackageInitialized) <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line454">454: </a>  TSARKIMEXPackageInitialized = <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_TRUE</a>;
<a name="line455">455: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXRegisterAll.html">TSARKIMEXRegisterAll</a>());
<a name="line456">456: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscRegisterFinalize.html">PetscRegisterFinalize</a>(<a href="../../../../manualpages/TS/TSARKIMEXFinalizePackage.html">TSARKIMEXFinalizePackage</a>));
<a name="line457">457: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line458">458: </a>}

<a name="line460">460: </a><font color="#B22222">/*@C</font>
<a name="line461">461: </a><font color="#B22222">  <a href="../../../../manualpages/TS/TSARKIMEXFinalizePackage.html">TSARKIMEXFinalizePackage</a> - This function destroys everything in the `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>` package. It is</font>
<a name="line462">462: </a><font color="#B22222">  called from `<a href="../../../../manualpages/Sys/PetscFinalize.html">PetscFinalize</a>()`.</font>

<a name="line464">464: </a><font color="#B22222">  Level: developer</font>

<a name="line466">466: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/Sys/PetscFinalize.html">PetscFinalize</a>()`, `<a href="../../../../manualpages/TS/TSARKIMEXInitializePackage.html">TSARKIMEXInitializePackage</a>()`</font>
<a name="line467">467: </a><font color="#B22222">@*/</font>
<a name="line468">468: </a><strong><font color="#4169E1"><a name="TSARKIMEXFinalizePackage"></a><a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../manualpages/TS/TSARKIMEXFinalizePackage.html">TSARKIMEXFinalizePackage</a>(void)</font></strong>
<a name="line469">469: </a>{
<a name="line470">470: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line471">471: </a>  TSARKIMEXPackageInitialized = <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_FALSE</a>;
<a name="line472">472: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXRegisterDestroy.html">TSARKIMEXRegisterDestroy</a>());
<a name="line473">473: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line474">474: </a>}

<a name="line476">476: </a><font color="#B22222">/*@C</font>
<a name="line477">477: </a><font color="#B22222">   <a href="../../../../manualpages/TS/TSARKIMEXRegister.html">TSARKIMEXRegister</a> - register a `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>` scheme by providing the entries in the Butcher tableau and optionally embedded approximations and interpolation</font>

<a name="line479">479: </a><font color="#B22222">   Not Collective, but the same schemes should be registered on all processes on which they will be used</font>

<a name="line481">481: </a><font color="#B22222">   Input Parameters:</font>
<a name="line482">482: </a><font color="#B22222">+  name - identifier for method</font>
<a name="line483">483: </a><font color="#B22222">.  order - approximation order of method</font>
<a name="line484">484: </a><font color="#B22222">.  s - number of stages, this is the dimension of the matrices below</font>
<a name="line485">485: </a><font color="#B22222">.  At - Butcher table of stage coefficients for stiff part (dimension s*s, row-major)</font>
<a name="line486">486: </a><font color="#B22222">.  bt - Butcher table for completing the stiff part of the step (dimension s; NULL to use the last row of At)</font>
<a name="line487">487: </a><font color="#B22222">.  ct - Abscissa of each stiff stage (dimension s, NULL to use row sums of At)</font>
<a name="line488">488: </a><font color="#B22222">.  A - Non-stiff stage coefficients (dimension s*s, row-major)</font>
<a name="line489">489: </a><font color="#B22222">.  b - Non-stiff step completion table (dimension s; NULL to use last row of At)</font>
<a name="line490">490: </a><font color="#B22222">.  c - Non-stiff abscissa (dimension s; NULL to use row sums of A)</font>
<a name="line491">491: </a><font color="#B22222">.  bembedt - Stiff part of completion table for embedded method (dimension s; NULL if not available)</font>
<a name="line492">492: </a><font color="#B22222">.  bembed - Non-stiff part of completion table for embedded method (dimension s; NULL to use bembedt if provided)</font>
<a name="line493">493: </a><font color="#B22222">.  pinterp - Order of the interpolation scheme, equal to the number of columns of binterpt and binterp</font>
<a name="line494">494: </a><font color="#B22222">.  binterpt - Coefficients of the interpolation formula for the stiff part (dimension s*pinterp)</font>
<a name="line495">495: </a><font color="#B22222">-  binterp - Coefficients of the interpolation formula for the non-stiff part (dimension s*pinterp; NULL to reuse binterpt)</font>

<a name="line497">497: </a><font color="#B22222">   Level: advanced</font>

<a name="line499">499: </a><font color="#B22222">   Note:</font>
<a name="line500">500: </a><font color="#B22222">   Several `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>` methods are provided, this function is only needed to create new methods.</font>

<a name="line502">502: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>`, `<a href="../../../../manualpages/TS/TSType.html">TSType</a>`, `<a href="../../../../manualpages/TS/TS.html">TS</a>`</font>
<a name="line503">503: </a><font color="#B22222">@*/</font>
<a name="line504">504: </a><strong><font color="#4169E1"><a name="TSARKIMEXRegister"></a><a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../manualpages/TS/TSARKIMEXRegister.html">TSARKIMEXRegister</a>(<a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a> name, <a href="../../../../manualpages/Sys/PetscInt.html">PetscInt</a> order, <a href="../../../../manualpages/Sys/PetscInt.html">PetscInt</a> s, const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> At[], const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> bt[], const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> ct[], const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> A[], const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> b[], const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> c[], const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> bembedt[], const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> bembed[], <a href="../../../../manualpages/Sys/PetscInt.html">PetscInt</a> pinterp, const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> binterpt[], const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> binterp[])</font></strong>
<a name="line505">505: </a>{
<a name="line506">506: </a>  ARKTableauLink link;
<a name="line507">507: </a>  ARKTableau     t;
<a name="line508">508: </a>  <a href="../../../../manualpages/Sys/PetscInt.html">PetscInt</a>       i, j;

<a name="line510">510: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line511">511: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXInitializePackage.html">TSARKIMEXInitializePackage</a>());
<a name="line512">512: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscNew.html">PetscNew</a>(&amp;link));
<a name="line513">513: </a>  t = &amp;link-&gt;tab;
<a name="line514">514: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscStrallocpy.html">PetscStrallocpy</a>(name, &amp;t-&gt;name));
<a name="line515">515: </a>  t-&gt;order = order;
<a name="line516">516: </a>  t-&gt;s     = s;
<a name="line517">517: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscMalloc6.html">PetscMalloc6</a>(s * s, &amp;t-&gt;At, s, &amp;t-&gt;bt, s, &amp;t-&gt;ct, s * s, &amp;t-&gt;A, s, &amp;t-&gt;b, s, &amp;t-&gt;c));
<a name="line518">518: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscArraycpy.html">PetscArraycpy</a>(t-&gt;At, At, s * s));
<a name="line519">519: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscArraycpy.html">PetscArraycpy</a>(t-&gt;A, A, s * s));
<a name="line520">520: </a>  <font color="#4169E1">if</font> (bt) <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscArraycpy.html">PetscArraycpy</a>(t-&gt;bt, bt, s));
<a name="line521">521: </a>  <font color="#4169E1">else</font>
<a name="line522">522: </a>    <font color="#4169E1">for</font> (i = 0; i &lt; s; i++) t-&gt;bt[i] = At[(s - 1) * s + i];
<a name="line523">523: </a>  <font color="#4169E1">if</font> (b) <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscArraycpy.html">PetscArraycpy</a>(t-&gt;b, b, s));
<a name="line524">524: </a>  <font color="#4169E1">else</font>
<a name="line525">525: </a>    <font color="#4169E1">for</font> (i = 0; i &lt; s; i++) t-&gt;b[i] = t-&gt;bt[i];
<a name="line526">526: </a>  <font color="#4169E1">if</font> (ct) <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscArraycpy.html">PetscArraycpy</a>(t-&gt;ct, ct, s));
<a name="line527">527: </a>  <font color="#4169E1">else</font>
<a name="line528">528: </a>    <font color="#4169E1">for</font> (i = 0; i &lt; s; i++)
<a name="line529">529: </a>      <font color="#4169E1">for</font> (j = 0, t-&gt;ct[i] = 0; j &lt; s; j++) t-&gt;ct[i] += At[i * s + j];
<a name="line530">530: </a>  <font color="#4169E1">if</font> (c) <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscArraycpy.html">PetscArraycpy</a>(t-&gt;c, c, s));
<a name="line531">531: </a>  <font color="#4169E1">else</font>
<a name="line532">532: </a>    <font color="#4169E1">for</font> (i = 0; i &lt; s; i++)
<a name="line533">533: </a>      <font color="#4169E1">for</font> (j = 0, t-&gt;c[i] = 0; j &lt; s; j++) t-&gt;c[i] += A[i * s + j];
<a name="line534">534: </a>  t-&gt;stiffly_accurate = <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_TRUE</a>;
<a name="line535">535: </a>  <font color="#4169E1">for</font> (i = 0; i &lt; s; i++)
<a name="line536">536: </a>    <font color="#4169E1">if</font> (t-&gt;At[(s - 1) * s + i] != t-&gt;bt[i]) t-&gt;stiffly_accurate = <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_FALSE</a>;
<a name="line537">537: </a>  t-&gt;explicit_first_stage = <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_TRUE</a>;
<a name="line538">538: </a>  <font color="#4169E1">for</font> (i = 0; i &lt; s; i++)
<a name="line539">539: </a>    <font color="#4169E1">if</font> (t-&gt;At[i] != 0.0) t-&gt;explicit_first_stage = <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_FALSE</a>;
<a name="line540">540: </a>  <font color="#B22222">/*def of FSAL can be made more precise*/</font>
<a name="line541">541: </a>  t-&gt;FSAL_implicit = (<a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a>)(t-&gt;explicit_first_stage &amp;&amp; t-&gt;stiffly_accurate);
<a name="line542">542: </a>  <font color="#4169E1">if</font> (bembedt) {
<a name="line543">543: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscMalloc2.html">PetscMalloc2</a>(s, &amp;t-&gt;bembedt, s, &amp;t-&gt;bembed));
<a name="line544">544: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscArraycpy.html">PetscArraycpy</a>(t-&gt;bembedt, bembedt, s));
<a name="line545">545: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscArraycpy.html">PetscArraycpy</a>(t-&gt;bembed, bembed ? bembed : bembedt, s));
<a name="line546">546: </a>  }

<a name="line548">548: </a>  t-&gt;pinterp = pinterp;
<a name="line549">549: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscMalloc2.html">PetscMalloc2</a>(s * pinterp, &amp;t-&gt;binterpt, s * pinterp, &amp;t-&gt;binterp));
<a name="line550">550: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscArraycpy.html">PetscArraycpy</a>(t-&gt;binterpt, binterpt, s * pinterp));
<a name="line551">551: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscArraycpy.html">PetscArraycpy</a>(t-&gt;binterp, binterp ? binterp : binterpt, s * pinterp));
<a name="line552">552: </a>  link-&gt;next     = ARKTableauList;
<a name="line553">553: </a>  ARKTableauList = link;
<a name="line554">554: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line555">555: </a>}

<a name="line557">557: </a><font color="#B22222">/*</font>
<a name="line558">558: </a><font color="#B22222"> The step completion formula is</font>

<a name="line560">560: </a><font color="#B22222"> x1 = x0 - h bt^T YdotI + h b^T YdotRHS</font>

<a name="line562">562: </a><font color="#B22222"> This function can be called before or after ts-&gt;vec_sol has been updated.</font>
<a name="line563">563: </a><font color="#B22222"> Suppose we have a completion formula (bt,b) and an embedded formula (bet,be) of different order.</font>
<a name="line564">564: </a><font color="#B22222"> We can write</font>

<a name="line566">566: </a><font color="#B22222"> x1e = x0 - h bet^T YdotI + h be^T YdotRHS</font>
<a name="line567">567: </a><font color="#B22222">     = x1 + h bt^T YdotI - h b^T YdotRHS - h bet^T YdotI + h be^T YdotRHS</font>
<a name="line568">568: </a><font color="#B22222">     = x1 - h (bet - bt)^T YdotI + h (be - b)^T YdotRHS</font>

<a name="line570">570: </a><font color="#B22222"> so we can evaluate the method with different order even after the step has been optimistically completed.</font>
<a name="line571">571: </a><font color="#B22222">*/</font>
<a name="line572">572: </a><strong><font color="#4169E1"><a name="TSEvaluateStep_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSEvaluateStep_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a> ts, <a href="../../../../manualpages/Sys/PetscInt.html">PetscInt</a> order, <a href="../../../../manualpages/Vec/Vec.html">Vec</a> X, <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a> *done)</font></strong>
<a name="line573">573: </a>{
<a name="line574">574: </a>  TS_ARKIMEX  *ark = (TS_ARKIMEX *)ts-&gt;data;
<a name="line575">575: </a>  ARKTableau   tab = ark-&gt;tableau;
<a name="line576">576: </a>  <a href="../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> *w   = ark-&gt;work;
<a name="line577">577: </a>  <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a>    h;
<a name="line578">578: </a>  <a href="../../../../manualpages/Sys/PetscInt.html">PetscInt</a>     s = tab-&gt;s, j;

<a name="line580">580: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line581">581: </a>  <font color="#4169E1">switch</font> (ark-&gt;status) {
<a name="line582">582: </a>  <font color="#4169E1">case</font> TS_STEP_INCOMPLETE:
<a name="line583">583: </a>  <font color="#4169E1">case</font> TS_STEP_PENDING:
<a name="line584">584: </a>    h = ts-&gt;time_step;
<a name="line585">585: </a>    <font color="#4169E1">break</font>;
<a name="line586">586: </a>  <font color="#4169E1">case</font> TS_STEP_COMPLETE:
<a name="line587">587: </a>    h = ts-&gt;ptime - ts-&gt;ptime_prev;
<a name="line588">588: </a>    <font color="#4169E1">break</font>;
<a name="line589">589: </a><strong><font color="#FF0000">  default:</font></strong>
<a name="line590">590: </a>    <a href="../../../../manualpages/Sys/SETERRQ.html">SETERRQ</a>(<a href="../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts), <a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_PLIB</a>, <font color="#666666">"Invalid TSStepStatus"</font>);
<a name="line591">591: </a>  }
<a name="line592">592: </a>  <font color="#4169E1">if</font> (order == tab-&gt;order) {
<a name="line593">593: </a>    <font color="#4169E1">if</font> (ark-&gt;status == TS_STEP_INCOMPLETE) {
<a name="line594">594: </a>      <font color="#4169E1">if</font> (!ark-&gt;imex &amp;&amp; tab-&gt;stiffly_accurate) { <font color="#B22222">/* Only the stiffly accurate implicit formula is used */</font>
<a name="line595">595: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecCopy.html">VecCopy</a>(ark-&gt;Y[s - 1], X));
<a name="line596">596: </a>      } <font color="#4169E1">else</font> { <font color="#B22222">/* Use the standard completion formula (bt,b) */</font>
<a name="line597">597: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecCopy.html">VecCopy</a>(ts-&gt;vec_sol, X));
<a name="line598">598: </a>        <font color="#4169E1">for</font> (j = 0; j &lt; s; j++) w[j] = h * tab-&gt;bt[j];
<a name="line599">599: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecMAXPY.html">VecMAXPY</a>(X, s, w, ark-&gt;YdotI));
<a name="line600">600: </a>        <font color="#4169E1">if</font> (ark-&gt;imex) { <font color="#B22222">/* Method is IMEX, complete the explicit formula */</font>
<a name="line601">601: </a>          <font color="#4169E1">for</font> (j = 0; j &lt; s; j++) w[j] = h * tab-&gt;b[j];
<a name="line602">602: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecMAXPY.html">VecMAXPY</a>(X, s, w, ark-&gt;YdotRHS));
<a name="line603">603: </a>        }
<a name="line604">604: </a>      }
<a name="line605">605: </a>    } <font color="#4169E1">else</font> <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecCopy.html">VecCopy</a>(ts-&gt;vec_sol, X));
<a name="line606">606: </a>    <font color="#4169E1">if</font> (done) *done = <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_TRUE</a>;
<a name="line607">607: </a>    <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line608">608: </a>  } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (order == tab-&gt;order - 1) {
<a name="line609">609: </a>    <font color="#4169E1">if</font> (!tab-&gt;bembedt) <font color="#4169E1">goto</font> unavailable;
<a name="line610">610: </a>    <font color="#4169E1">if</font> (ark-&gt;status == TS_STEP_INCOMPLETE) { <font color="#B22222">/* Complete with the embedded method (bet,be) */</font>
<a name="line611">611: </a>      <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecCopy.html">VecCopy</a>(ts-&gt;vec_sol, X));
<a name="line612">612: </a>      <font color="#4169E1">for</font> (j = 0; j &lt; s; j++) w[j] = h * tab-&gt;bembedt[j];
<a name="line613">613: </a>      <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecMAXPY.html">VecMAXPY</a>(X, s, w, ark-&gt;YdotI));
<a name="line614">614: </a>      <font color="#4169E1">for</font> (j = 0; j &lt; s; j++) w[j] = h * tab-&gt;bembed[j];
<a name="line615">615: </a>      <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecMAXPY.html">VecMAXPY</a>(X, s, w, ark-&gt;YdotRHS));
<a name="line616">616: </a>    } <font color="#4169E1">else</font> { <font color="#B22222">/* Rollback and re-complete using (bet-be,be-b) */</font>
<a name="line617">617: </a>      <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecCopy.html">VecCopy</a>(ts-&gt;vec_sol, X));
<a name="line618">618: </a>      <font color="#4169E1">for</font> (j = 0; j &lt; s; j++) w[j] = h * (tab-&gt;bembedt[j] - tab-&gt;bt[j]);
<a name="line619">619: </a>      <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecMAXPY.html">VecMAXPY</a>(X, tab-&gt;s, w, ark-&gt;YdotI));
<a name="line620">620: </a>      <font color="#4169E1">for</font> (j = 0; j &lt; s; j++) w[j] = h * (tab-&gt;bembed[j] - tab-&gt;b[j]);
<a name="line621">621: </a>      <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecMAXPY.html">VecMAXPY</a>(X, s, w, ark-&gt;YdotRHS));
<a name="line622">622: </a>    }
<a name="line623">623: </a>    <font color="#4169E1">if</font> (done) *done = <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_TRUE</a>;
<a name="line624">624: </a>    <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line625">625: </a>  }
<a name="line626">626: </a><strong><font color="#FF0000">unavailable:</font></strong>
<a name="line627">627: </a>  <font color="#4169E1">if</font> (done) *done = <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_FALSE</a>;
<a name="line628">628: </a>  <font color="#4169E1">else</font>
<a name="line629">629: </a>    <a href="../../../../manualpages/Sys/SETERRQ.html">SETERRQ</a>(<a href="../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts), <a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_SUP</a>, <font color="#666666">"ARKIMEX '%s' of order %"</font> PetscInt_FMT <font color="#666666">" cannot evaluate step at order %"</font> PetscInt_FMT <font color="#666666">". Consider using -ts_adapt_type none or a different method that has an embedded estimate."</font>, tab-&gt;name,
<a name="line630">630: </a>            tab-&gt;order, order);
<a name="line631">631: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line632">632: </a>}

<a name="line634">634: </a><strong><font color="#4169E1"><a name="TSARKIMEXTestMassIdentity"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSARKIMEXTestMassIdentity(<a href="../../../../manualpages/TS/TS.html">TS</a> ts, <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a> *id)</font></strong>
<a name="line635">635: </a>{
<a name="line636">636: </a>  <a href="../../../../manualpages/Vec/Vec.html">Vec</a>         Udot, Y1, Y2;
<a name="line637">637: </a>  TS_ARKIMEX *ark = (TS_ARKIMEX *)ts-&gt;data;
<a name="line638">638: </a>  <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a>   norm;

<a name="line640">640: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line641">641: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDuplicate.html">VecDuplicate</a>(ts-&gt;vec_sol, &amp;Udot));
<a name="line642">642: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDuplicate.html">VecDuplicate</a>(ts-&gt;vec_sol, &amp;Y1));
<a name="line643">643: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDuplicate.html">VecDuplicate</a>(ts-&gt;vec_sol, &amp;Y2));
<a name="line644">644: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSComputeIFunction.html">TSComputeIFunction</a>(ts, ts-&gt;ptime, ts-&gt;vec_sol, Udot, Y1, ark-&gt;imex));
<a name="line645">645: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecSetRandom.html">VecSetRandom</a>(Udot, NULL));
<a name="line646">646: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSComputeIFunction.html">TSComputeIFunction</a>(ts, ts-&gt;ptime, ts-&gt;vec_sol, Udot, Y2, ark-&gt;imex));
<a name="line647">647: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecAXPY.html">VecAXPY</a>(Y2, -1.0, Y1));
<a name="line648">648: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecAXPY.html">VecAXPY</a>(Y2, -1.0, Udot));
<a name="line649">649: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecNorm.html">VecNorm</a>(Y2, <a href="../../../../manualpages/Vec/NORM_2.html">NORM_2</a>, &amp;norm));
<a name="line650">650: </a>  <font color="#4169E1">if</font> (norm &lt; 100.0 * PETSC_MACHINE_EPSILON) {
<a name="line651">651: </a>    *id = <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_TRUE</a>;
<a name="line652">652: </a>  } <font color="#4169E1">else</font> {
<a name="line653">653: </a>    *id = <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_FALSE</a>;
<a name="line654">654: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Profiling/PetscInfo.html">PetscInfo</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts, <font color="#666666">"IFunction(Udot = random) - IFunction(Udot = 0) is not near Udot, %g, suspect mass matrix implied in IFunction() is not the identity as required\n"</font>, (double)norm));
<a name="line655">655: </a>  }
<a name="line656">656: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDestroy.html">VecDestroy</a>(&amp;Udot));
<a name="line657">657: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDestroy.html">VecDestroy</a>(&amp;Y1));
<a name="line658">658: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDestroy.html">VecDestroy</a>(&amp;Y2));
<a name="line659">659: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line660">660: </a>}

<a name="line662">662: </a><strong><font color="#4169E1"><a name="TSRollBack_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSRollBack_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a> ts)</font></strong>
<a name="line663">663: </a>{
<a name="line664">664: </a>  TS_ARKIMEX      *ark = (TS_ARKIMEX *)ts-&gt;data;
<a name="line665">665: </a>  ARKTableau       tab = ark-&gt;tableau;
<a name="line666">666: </a>  const <a href="../../../../manualpages/Sys/PetscInt.html">PetscInt</a>   s   = tab-&gt;s;
<a name="line667">667: </a>  const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> *bt = tab-&gt;bt, *b = tab-&gt;b;
<a name="line668">668: </a>  <a href="../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a>     *w     = ark-&gt;work;
<a name="line669">669: </a>  <a href="../../../../manualpages/Vec/Vec.html">Vec</a>             *YdotI = ark-&gt;YdotI, *YdotRHS = ark-&gt;YdotRHS;
<a name="line670">670: </a>  <a href="../../../../manualpages/Sys/PetscInt.html">PetscInt</a>         j;
<a name="line671">671: </a>  <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a>        h;

<a name="line673">673: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line674">674: </a>  <font color="#4169E1">switch</font> (ark-&gt;status) {
<a name="line675">675: </a>  <font color="#4169E1">case</font> TS_STEP_INCOMPLETE:
<a name="line676">676: </a>  <font color="#4169E1">case</font> TS_STEP_PENDING:
<a name="line677">677: </a>    h = ts-&gt;time_step;
<a name="line678">678: </a>    <font color="#4169E1">break</font>;
<a name="line679">679: </a>  <font color="#4169E1">case</font> TS_STEP_COMPLETE:
<a name="line680">680: </a>    h = ts-&gt;ptime - ts-&gt;ptime_prev;
<a name="line681">681: </a>    <font color="#4169E1">break</font>;
<a name="line682">682: </a><strong><font color="#FF0000">  default:</font></strong>
<a name="line683">683: </a>    <a href="../../../../manualpages/Sys/SETERRQ.html">SETERRQ</a>(<a href="../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts), <a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_PLIB</a>, <font color="#666666">"Invalid TSStepStatus"</font>);
<a name="line684">684: </a>  }
<a name="line685">685: </a>  <font color="#4169E1">for</font> (j = 0; j &lt; s; j++) w[j] = -h * bt[j];
<a name="line686">686: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecMAXPY.html">VecMAXPY</a>(ts-&gt;vec_sol, s, w, YdotI));
<a name="line687">687: </a>  <font color="#4169E1">for</font> (j = 0; j &lt; s; j++) w[j] = -h * b[j];
<a name="line688">688: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecMAXPY.html">VecMAXPY</a>(ts-&gt;vec_sol, s, w, YdotRHS));
<a name="line689">689: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line690">690: </a>}

<a name="line692">692: </a><strong><font color="#4169E1"><a name="TSStep_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSStep_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a> ts)</font></strong>
<a name="line693">693: </a>{
<a name="line694">694: </a>  TS_ARKIMEX      *ark = (TS_ARKIMEX *)ts-&gt;data;
<a name="line695">695: </a>  ARKTableau       tab = ark-&gt;tableau;
<a name="line696">696: </a>  const <a href="../../../../manualpages/Sys/PetscInt.html">PetscInt</a>   s   = tab-&gt;s;
<a name="line697">697: </a>  const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> *At = tab-&gt;At, *A = tab-&gt;A, *ct = tab-&gt;ct, *c = tab-&gt;c;
<a name="line698">698: </a>  <a href="../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a>     *w = ark-&gt;work;
<a name="line699">699: </a>  <a href="../../../../manualpages/Vec/Vec.html">Vec</a>             *Y = ark-&gt;Y, *YdotI = ark-&gt;YdotI, *YdotRHS = ark-&gt;YdotRHS, Ydot = ark-&gt;Ydot, Ydot0 = ark-&gt;Ydot0, Z = ark-&gt;Z;
<a name="line700">700: </a>  <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a>        extrapolate = ark-&gt;extrapolate;
<a name="line701">701: </a>  <a href="../../../../manualpages/TS/TSAdapt.html">TSAdapt</a>          adapt;
<a name="line702">702: </a>  <a href="../../../../manualpages/SNES/SNES.html">SNES</a>             snes;
<a name="line703">703: </a>  <a href="../../../../manualpages/Sys/PetscInt.html">PetscInt</a>         i, j, its, lits;
<a name="line704">704: </a>  <a href="../../../../manualpages/Sys/PetscInt.html">PetscInt</a>         rejections = 0;
<a name="line705">705: </a>  <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a>        stageok, accept = <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_TRUE</a>;
<a name="line706">706: </a>  <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a>        next_time_step = ts-&gt;time_step;

<a name="line708">708: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line709">709: </a>  <font color="#4169E1">if</font> (ark-&gt;extrapolate &amp;&amp; !ark-&gt;Y_prev) {
<a name="line710">710: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDuplicateVecs.html">VecDuplicateVecs</a>(ts-&gt;vec_sol, tab-&gt;s, &amp;ark-&gt;Y_prev));
<a name="line711">711: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDuplicateVecs.html">VecDuplicateVecs</a>(ts-&gt;vec_sol, tab-&gt;s, &amp;ark-&gt;YdotI_prev));
<a name="line712">712: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDuplicateVecs.html">VecDuplicateVecs</a>(ts-&gt;vec_sol, tab-&gt;s, &amp;ark-&gt;YdotRHS_prev));
<a name="line713">713: </a>  }

<a name="line715">715: </a>  <font color="#4169E1">if</font> (!ts-&gt;steprollback) {
<a name="line716">716: </a>    <font color="#4169E1">if</font> (ts-&gt;equation_type &gt;= <a href="../../../../manualpages/TS/TSEquationType.html">TS_EQ_IMPLICIT</a>) { <font color="#B22222">/* Save the initial slope for the next step */</font>
<a name="line717">717: </a>      <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecCopy.html">VecCopy</a>(YdotI[s - 1], Ydot0));
<a name="line718">718: </a>    }
<a name="line719">719: </a>    <font color="#4169E1">if</font> (ark-&gt;extrapolate &amp;&amp; !ts-&gt;steprestart) { <font color="#B22222">/* Save the Y, YdotI, YdotRHS for extrapolation initial guess */</font>
<a name="line720">720: </a>      <font color="#4169E1">for</font> (i = 0; i &lt; s; i++) {
<a name="line721">721: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecCopy.html">VecCopy</a>(Y[i], ark-&gt;Y_prev[i]));
<a name="line722">722: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecCopy.html">VecCopy</a>(YdotRHS[i], ark-&gt;YdotRHS_prev[i]));
<a name="line723">723: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecCopy.html">VecCopy</a>(YdotI[i], ark-&gt;YdotI_prev[i]));
<a name="line724">724: </a>      }
<a name="line725">725: </a>    }
<a name="line726">726: </a>  }

<a name="line728">728: </a>  <font color="#4169E1">if</font> (ts-&gt;equation_type &gt;= <a href="../../../../manualpages/TS/TSEquationType.html">TS_EQ_IMPLICIT</a> &amp;&amp; tab-&gt;explicit_first_stage &amp;&amp; ts-&gt;steprestart) {
<a name="line729">729: </a>    <a href="../../../../manualpages/TS/TS.html">TS</a> ts_start;
<a name="line730">730: </a>    <font color="#4169E1">if</font> (<a href="../../../../manualpages/Sys/PetscDefined.html">PetscDefined</a>(USE_DEBUG)) {
<a name="line731">731: </a>      <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a> id = <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_FALSE</a>;
<a name="line732">732: </a>      <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSARKIMEXTestMassIdentity(ts, &amp;id));
<a name="line733">733: </a>      <a href="../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(id, <a href="../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts), <a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_INCOMP</a>, <font color="#666666">"This scheme requires an identity mass matrix, however the TSIFunction you provide does not utilize an identity mass matrix"</font>);
<a name="line734">734: </a>    }
<a name="line735">735: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSClone.html">TSClone</a>(ts, &amp;ts_start));
<a name="line736">736: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSSetSolution.html">TSSetSolution</a>(ts_start, ts-&gt;vec_sol));
<a name="line737">737: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSSetTime.html">TSSetTime</a>(ts_start, ts-&gt;ptime));
<a name="line738">738: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSSetMaxSteps.html">TSSetMaxSteps</a>(ts_start, ts-&gt;steps + 1));
<a name="line739">739: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSSetMaxTime.html">TSSetMaxTime</a>(ts_start, ts-&gt;ptime + ts-&gt;time_step));
<a name="line740">740: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSSetExactFinalTime.html">TSSetExactFinalTime</a>(ts_start, <a href="../../../../manualpages/TS/TSExactFinalTimeOption.html">TS_EXACTFINALTIME_STEPOVER</a>));
<a name="line741">741: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSSetTimeStep.html">TSSetTimeStep</a>(ts_start, ts-&gt;time_step));
<a name="line742">742: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSSetType.html">TSSetType</a>(ts_start, <a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>));
<a name="line743">743: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXSetFullyImplicit.html">TSARKIMEXSetFullyImplicit</a>(ts_start, <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_TRUE</a>));
<a name="line744">744: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a>(ts_start, <a href="../../../../manualpages/TS/TSARKIMEX1BEE.html">TSARKIMEX1BEE</a>));

<a name="line746">746: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSRestartStep.html">TSRestartStep</a>(ts_start));
<a name="line747">747: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSSolve.html">TSSolve</a>(ts_start, ts-&gt;vec_sol));
<a name="line748">748: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSGetTime.html">TSGetTime</a>(ts_start, &amp;ts-&gt;ptime));
<a name="line749">749: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSGetTimeStep.html">TSGetTimeStep</a>(ts_start, &amp;ts-&gt;time_step));

<a name="line751">751: </a>    { <font color="#B22222">/* Save the initial slope for the next step */</font>
<a name="line752">752: </a>      TS_ARKIMEX *ark_start = (TS_ARKIMEX *)ts_start-&gt;data;
<a name="line753">753: </a>      <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecCopy.html">VecCopy</a>(ark_start-&gt;YdotI[ark_start-&gt;tableau-&gt;s - 1], Ydot0));
<a name="line754">754: </a>    }
<a name="line755">755: </a>    ts-&gt;steps++;

<a name="line757">757: </a>    <font color="#B22222">/* Set the correct <a href="../../../../manualpages/TS/TS.html">TS</a> in <a href="../../../../manualpages/SNES/SNES.html">SNES</a> */</font>
<a name="line758">758: </a>    <font color="#B22222">/* We'll try to bypass this by changing the method on the fly */</font>
<a name="line759">759: </a>    {
<a name="line760">760: </a>      <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSGetSNES.html">TSGetSNES</a>(ts, &amp;snes));
<a name="line761">761: </a>      <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSSetSNES.html">TSSetSNES</a>(ts, snes));
<a name="line762">762: </a>    }
<a name="line763">763: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSDestroy.html">TSDestroy</a>(&amp;ts_start));
<a name="line764">764: </a>  }

<a name="line766">766: </a>  ark-&gt;status = TS_STEP_INCOMPLETE;
<a name="line767">767: </a>  <font color="#4169E1">while</font> (!ts-&gt;reason &amp;&amp; ark-&gt;status != TS_STEP_COMPLETE) {
<a name="line768">768: </a>    <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> t = ts-&gt;ptime;
<a name="line769">769: </a>    <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> h = ts-&gt;time_step;
<a name="line770">770: </a>    <font color="#4169E1">for</font> (i = 0; i &lt; s; i++) {
<a name="line771">771: </a>      ark-&gt;stage_time = t + h * ct[i];
<a name="line772">772: </a>      <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSPreStage.html">TSPreStage</a>(ts, ark-&gt;stage_time));
<a name="line773">773: </a>      <font color="#4169E1">if</font> (At[i * s + i] == 0) { <font color="#B22222">/* This stage is explicit */</font>
<a name="line774">774: </a>        <a href="../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(i == 0 || ts-&gt;equation_type &lt; <a href="../../../../manualpages/TS/TSEquationType.html">TS_EQ_IMPLICIT</a>, <a href="../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts), <a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_SUP</a>, <font color="#666666">"Explicit stages other than the first one are not supported for implicit problems"</font>);
<a name="line775">775: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecCopy.html">VecCopy</a>(ts-&gt;vec_sol, Y[i]));
<a name="line776">776: </a>        <font color="#4169E1">for</font> (j = 0; j &lt; i; j++) w[j] = h * At[i * s + j];
<a name="line777">777: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecMAXPY.html">VecMAXPY</a>(Y[i], i, w, YdotI));
<a name="line778">778: </a>        <font color="#4169E1">for</font> (j = 0; j &lt; i; j++) w[j] = h * A[i * s + j];
<a name="line779">779: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecMAXPY.html">VecMAXPY</a>(Y[i], i, w, YdotRHS));
<a name="line780">780: </a>      } <font color="#4169E1">else</font> {
<a name="line781">781: </a>        ark-&gt;scoeff = 1. / At[i * s + i];
<a name="line782">782: </a>        <font color="#B22222">/* Ydot = shift*(Y-Z) */</font>
<a name="line783">783: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecCopy.html">VecCopy</a>(ts-&gt;vec_sol, Z));
<a name="line784">784: </a>        <font color="#4169E1">for</font> (j = 0; j &lt; i; j++) w[j] = h * At[i * s + j];
<a name="line785">785: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecMAXPY.html">VecMAXPY</a>(Z, i, w, YdotI));
<a name="line786">786: </a>        <font color="#4169E1">for</font> (j = 0; j &lt; i; j++) w[j] = h * A[i * s + j];
<a name="line787">787: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecMAXPY.html">VecMAXPY</a>(Z, i, w, YdotRHS));
<a name="line788">788: </a>        <font color="#4169E1">if</font> (extrapolate &amp;&amp; !ts-&gt;steprestart) {
<a name="line789">789: </a>          <font color="#B22222">/* Initial guess extrapolated from previous time step stage values */</font>
<a name="line790">790: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSExtrapolate_ARKIMEX(ts, c[i], Y[i]));
<a name="line791">791: </a>        } <font color="#4169E1">else</font> {
<a name="line792">792: </a>          <font color="#B22222">/* Initial guess taken from last stage */</font>
<a name="line793">793: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecCopy.html">VecCopy</a>(i &gt; 0 ? Y[i - 1] : ts-&gt;vec_sol, Y[i]));
<a name="line794">794: </a>        }
<a name="line795">795: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSGetSNES.html">TSGetSNES</a>(ts, &amp;snes));
<a name="line796">796: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/SNES/SNESSolve.html">SNESSolve</a>(snes, NULL, Y[i]));
<a name="line797">797: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/SNES/SNESGetIterationNumber.html">SNESGetIterationNumber</a>(snes, &amp;its));
<a name="line798">798: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/SNES/SNESGetLinearSolveIterations.html">SNESGetLinearSolveIterations</a>(snes, &amp;lits));
<a name="line799">799: </a>        ts-&gt;snes_its += its;
<a name="line800">800: </a>        ts-&gt;ksp_its += lits;
<a name="line801">801: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSGetAdapt.html">TSGetAdapt</a>(ts, &amp;adapt));
<a name="line802">802: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSAdaptCheckStage.html">TSAdaptCheckStage</a>(adapt, ts, ark-&gt;stage_time, Y[i], &amp;stageok));
<a name="line803">803: </a>        <font color="#4169E1">if</font> (!stageok) {
<a name="line804">804: </a>          <font color="#B22222">/* We are likely rejecting the step because of solver or function domain problems so we should not attempt to</font>
<a name="line805">805: </a><font color="#B22222">           * use extrapolation to initialize the solves on the next attempt. */</font>
<a name="line806">806: </a>          extrapolate = <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_FALSE</a>;
<a name="line807">807: </a>          <font color="#4169E1">goto</font> reject_step;
<a name="line808">808: </a>        }
<a name="line809">809: </a>      }
<a name="line810">810: </a>      <font color="#4169E1">if</font> (ts-&gt;equation_type &gt;= <a href="../../../../manualpages/TS/TSEquationType.html">TS_EQ_IMPLICIT</a>) {
<a name="line811">811: </a>        <font color="#4169E1">if</font> (i == 0 &amp;&amp; tab-&gt;explicit_first_stage) {
<a name="line812">812: </a>          <a href="../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(tab-&gt;stiffly_accurate, <a href="../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts), <a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_SUP</a>, <font color="#666666">"<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a> %s is not stiffly accurate and therefore explicit-first stage methods cannot be used if the equation is implicit because the slope cannot be evaluated"</font>,
<a name="line813">813: </a>                     ark-&gt;tableau-&gt;name);
<a name="line814">814: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecCopy.html">VecCopy</a>(Ydot0, YdotI[0])); <font color="#B22222">/* YdotI = YdotI(tn-1) */</font>
<a name="line815">815: </a>        } <font color="#4169E1">else</font> {
<a name="line816">816: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecAXPBYPCZ.html">VecAXPBYPCZ</a>(YdotI[i], -ark-&gt;scoeff / h, ark-&gt;scoeff / h, 0, Z, Y[i])); <font color="#B22222">/* YdotI = shift*(X-Z) */</font>
<a name="line817">817: </a>        }
<a name="line818">818: </a>      } <font color="#4169E1">else</font> {
<a name="line819">819: </a>        <font color="#4169E1">if</font> (i == 0 &amp;&amp; tab-&gt;explicit_first_stage) {
<a name="line820">820: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecZeroEntries.html">VecZeroEntries</a>(Ydot));
<a name="line821">821: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSComputeIFunction.html">TSComputeIFunction</a>(ts, t + h * ct[i], Y[i], Ydot, YdotI[i], ark-&gt;imex)); <font color="#B22222">/* YdotI = -G(t,Y,0)   */</font>
<a name="line822">822: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecScale.html">VecScale</a>(YdotI[i], -1.0));
<a name="line823">823: </a>        } <font color="#4169E1">else</font> {
<a name="line824">824: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecAXPBYPCZ.html">VecAXPBYPCZ</a>(YdotI[i], -ark-&gt;scoeff / h, ark-&gt;scoeff / h, 0, Z, Y[i])); <font color="#B22222">/* YdotI = shift*(X-Z) */</font>
<a name="line825">825: </a>        }
<a name="line826">826: </a>        <font color="#4169E1">if</font> (ark-&gt;imex) {
<a name="line827">827: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSComputeRHSFunction.html">TSComputeRHSFunction</a>(ts, t + h * c[i], Y[i], YdotRHS[i]));
<a name="line828">828: </a>        } <font color="#4169E1">else</font> {
<a name="line829">829: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecZeroEntries.html">VecZeroEntries</a>(YdotRHS[i]));
<a name="line830">830: </a>        }
<a name="line831">831: </a>      }
<a name="line832">832: </a>      <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSPostStage.html">TSPostStage</a>(ts, ark-&gt;stage_time, i, Y));
<a name="line833">833: </a>    }

<a name="line835">835: </a>    ark-&gt;status = TS_STEP_INCOMPLETE;
<a name="line836">836: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSEvaluateStep_ARKIMEX(ts, tab-&gt;order, ts-&gt;vec_sol, NULL));
<a name="line837">837: </a>    ark-&gt;status = TS_STEP_PENDING;
<a name="line838">838: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSGetAdapt.html">TSGetAdapt</a>(ts, &amp;adapt));
<a name="line839">839: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSAdaptCandidatesClear.html">TSAdaptCandidatesClear</a>(adapt));
<a name="line840">840: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSAdaptCandidateAdd.html">TSAdaptCandidateAdd</a>(adapt, tab-&gt;name, tab-&gt;order, 1, tab-&gt;ccfl, (<a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a>)tab-&gt;s, <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_TRUE</a>));
<a name="line841">841: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSAdaptChoose.html">TSAdaptChoose</a>(adapt, ts, ts-&gt;time_step, NULL, &amp;next_time_step, &amp;accept));
<a name="line842">842: </a>    ark-&gt;status = accept ? TS_STEP_COMPLETE : TS_STEP_INCOMPLETE;
<a name="line843">843: </a>    <font color="#4169E1">if</font> (!accept) { <font color="#B22222">/* Roll back the current step */</font>
<a name="line844">844: </a>      <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSRollBack_ARKIMEX(ts));
<a name="line845">845: </a>      ts-&gt;time_step = next_time_step;
<a name="line846">846: </a>      <font color="#4169E1">goto</font> reject_step;
<a name="line847">847: </a>    }

<a name="line849">849: </a>    ts-&gt;ptime += ts-&gt;time_step;
<a name="line850">850: </a>    ts-&gt;time_step = next_time_step;
<a name="line851">851: </a>    <font color="#4169E1">break</font>;

<a name="line853">853: </a><strong><font color="#FF0000">  reject_step:</font></strong>
<a name="line854">854: </a>    ts-&gt;reject++;
<a name="line855">855: </a>    accept = <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_FALSE</a>;
<a name="line856">856: </a>    <font color="#4169E1">if</font> (!ts-&gt;reason &amp;&amp; ++rejections &gt; ts-&gt;max_reject &amp;&amp; ts-&gt;max_reject &gt;= 0) {
<a name="line857">857: </a>      ts-&gt;reason = <a href="../../../../manualpages/TS/TS_DIVERGED_STEP_REJECTED.html">TS_DIVERGED_STEP_REJECTED</a>;
<a name="line858">858: </a>      <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Profiling/PetscInfo.html">PetscInfo</a>(ts, <font color="#666666">"Step=%"</font> PetscInt_FMT <font color="#666666">", step rejections %"</font> PetscInt_FMT <font color="#666666">" greater than current <a href="../../../../manualpages/TS/TS.html">TS</a> allowed, stopping solve\n"</font>, ts-&gt;steps, rejections));
<a name="line859">859: </a>    }
<a name="line860">860: </a>  }
<a name="line861">861: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line862">862: </a>}
<a name="line863">863: </a><font color="#B22222">/*</font>
<a name="line864">864: </a><font color="#B22222">  This adjoint step function assumes the partitioned ODE system has an identity mass matrix and thus can be represented in the form</font>
<a name="line865">865: </a><font color="#B22222">  Udot = H(t,U) + G(t,U)</font>
<a name="line866">866: </a><font color="#B22222">  This corresponds to F(t,U,Udot) = Udot-H(t,U).</font>

<a name="line868">868: </a><font color="#B22222">  The complete adjoint equations are</font>
<a name="line869">869: </a><font color="#B22222">  (shift*I - dHdu) lambda_s[i]   = 1/at[i][i] (</font>
<a name="line870">870: </a><font color="#B22222">    (b_i dGdU + bt[i] dHdU) lambda_{n+1} + dGdU \sum_{j=i+1}^s a[j][i] lambda_s[j]</font>
<a name="line871">871: </a><font color="#B22222">    + dHdU \sum_{j=i+1}^s at[j][i] lambda_s[j]),  i = s-1,...,0</font>
<a name="line872">872: </a><font color="#B22222">  lambda_n = lambda_{n+1} + \sum_{j=1}^s lambda_s[j]</font>
<a name="line873">873: </a><font color="#B22222">  mu_{n+1}[i]   = h (at[i][i] dHdP lambda_s[i]</font>
<a name="line874">874: </a><font color="#B22222">    + (b_i dGdP + bt[i] dHdP) lambda_{n+1} + dGdP \sum_{j=i+1}^s a[j][i] lambda_s[j]</font>
<a name="line875">875: </a><font color="#B22222">    + dHdP \sum_{j=i+1}^s at[j][i] lambda_s[j]), i = s-1,...,0</font>
<a name="line876">876: </a><font color="#B22222">  mu_n = mu_{n+1} + \sum_{j=1}^s mu_{n+1}[j]</font>
<a name="line877">877: </a><font color="#B22222">  where shift = 1/(at[i][i]*h)</font>

<a name="line879">879: </a><font color="#B22222">  If at[i][i] is 0, the first equation falls back to</font>
<a name="line880">880: </a><font color="#B22222">  lambda_s[i] = h (</font>
<a name="line881">881: </a><font color="#B22222">    (b_i dGdU + bt[i] dHdU) lambda_{n+1} + dGdU \sum_{j=i+1}^s a[j][i] lambda_s[j]</font>
<a name="line882">882: </a><font color="#B22222">    + dHdU \sum_{j=i+1}^s at[j][i] lambda_s[j])</font>

<a name="line884">884: </a><font color="#B22222">*/</font>
<a name="line885">885: </a><strong><font color="#4169E1"><a name="TSAdjointStep_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSAdjointStep_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a> ts)</font></strong>
<a name="line886">886: </a>{
<a name="line887">887: </a>  TS_ARKIMEX      *ark = (TS_ARKIMEX *)ts-&gt;data;
<a name="line888">888: </a>  ARKTableau       tab = ark-&gt;tableau;
<a name="line889">889: </a>  const <a href="../../../../manualpages/Sys/PetscInt.html">PetscInt</a>   s   = tab-&gt;s;
<a name="line890">890: </a>  const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> *At = tab-&gt;At, *A = tab-&gt;A, *ct = tab-&gt;ct, *c = tab-&gt;c, *b = tab-&gt;b, *bt = tab-&gt;bt;
<a name="line891">891: </a>  <a href="../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a>     *w = ark-&gt;work;
<a name="line892">892: </a>  <a href="../../../../manualpages/Vec/Vec.html">Vec</a>             *Y = ark-&gt;Y, Ydot = ark-&gt;Ydot, *VecsDeltaLam = ark-&gt;VecsDeltaLam, *VecsSensiTemp = ark-&gt;VecsSensiTemp, *VecsSensiPTemp = ark-&gt;VecsSensiPTemp;
<a name="line893">893: </a>  <a href="../../../../manualpages/Mat/Mat.html">Mat</a>              Jex, Jim, Jimpre;
<a name="line894">894: </a>  <a href="../../../../manualpages/Sys/PetscInt.html">PetscInt</a>         i, j, nadj;
<a name="line895">895: </a>  <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a>        t                 = ts-&gt;ptime, stage_time_ex;
<a name="line896">896: </a>  <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a>        adjoint_time_step = -ts-&gt;time_step; <font color="#B22222">/* always positive since ts-&gt;time_step is negative */</font>
<a name="line897">897: </a>  <a href="../../../../manualpages/KSP/KSP.html">KSP</a>              ksp;

<a name="line899">899: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line900">900: </a>  ark-&gt;status = TS_STEP_INCOMPLETE;
<a name="line901">901: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/SNES/SNESGetKSP.html">SNESGetKSP</a>(ts-&gt;snes, &amp;ksp));
<a name="line902">902: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSGetRHSMats_Private(ts, &amp;Jex, NULL));
<a name="line903">903: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSGetIJacobian.html">TSGetIJacobian</a>(ts, &amp;Jim, &amp;Jimpre, NULL, NULL));

<a name="line905">905: </a>  <font color="#4169E1">for</font> (i = s - 1; i &gt;= 0; i--) {
<a name="line906">906: </a>    ark-&gt;stage_time = t - adjoint_time_step * (1.0 - ct[i]);
<a name="line907">907: </a>    stage_time_ex   = t - adjoint_time_step * (1.0 - c[i]);
<a name="line908">908: </a>    <font color="#4169E1">if</font> (At[i * s + i] == 0) { // This stage is explicit
<a name="line909">909: </a>      ark-&gt;scoeff = 0.;
<a name="line910">910: </a>    } <font color="#4169E1">else</font> {
<a name="line911">911: </a>      ark-&gt;scoeff = -1. / At[i * s + i]; // this makes shift=ark-&gt;scoeff/ts-&gt;time_step positive since ts-&gt;time_step is negative
<a name="line912">912: </a>    }
<a name="line913">913: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sensitivity/TSComputeSNESJacobian.html">TSComputeSNESJacobian</a>(ts, Y[i], Jim, Jimpre));
<a name="line914">914: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSComputeRHSJacobian.html">TSComputeRHSJacobian</a>(ts, stage_time_ex, Y[i], Jex, Jex));
<a name="line915">915: </a>    <font color="#4169E1">if</font> (ts-&gt;vecs_sensip) {
<a name="line916">916: </a>      <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sensitivity/TSComputeIJacobianP.html">TSComputeIJacobianP</a>(ts, ark-&gt;stage_time, Y[i], Ydot, ark-&gt;scoeff / adjoint_time_step, ts-&gt;Jacp, <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_TRUE</a>)); // get dFdP (-dHdP), Ydot not really used since mass matrix is identity
<a name="line917">917: </a>      <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sensitivity/TSComputeRHSJacobianP.html">TSComputeRHSJacobianP</a>(ts, stage_time_ex, Y[i], ts-&gt;Jacprhs));                                                 // get dGdP
<a name="line918">918: </a>    }
<a name="line919">919: </a>    <font color="#4169E1">for</font> (nadj = 0; nadj &lt; ts-&gt;numcost; nadj++) {
<a name="line920">920: </a>      <font color="#B22222">/* Build RHS (stored in VecsDeltaLam) for first-order adjoint */</font>
<a name="line921">921: </a>      <font color="#4169E1">if</font> (s - i - 1 &gt; 0) {
<a name="line922">922: </a>        <font color="#B22222">/* Temp = -\sum_{j=i+1}^s at[j][i] lambda_s[j] */</font>
<a name="line923">923: </a>        <font color="#4169E1">for</font> (j = i + 1; j &lt; s; j++) w[j - i - 1] = -At[j * s + i];
<a name="line924">924: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecSet.html">VecSet</a>(VecsSensiTemp[nadj], 0));
<a name="line925">925: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecMAXPY.html">VecMAXPY</a>(VecsSensiTemp[nadj], s - i - 1, w, &amp;VecsDeltaLam[nadj * s + i + 1]));
<a name="line926">926: </a>        <font color="#B22222">/* (shift I - dHdU) Temp */</font>
<a name="line927">927: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Mat/MatMultTranspose.html">MatMultTranspose</a>(Jim, VecsSensiTemp[nadj], VecsDeltaLam[nadj * s + i]));
<a name="line928">928: </a>        <font color="#B22222">/* cancel out shift Temp where shift=-scoeff/h */</font>
<a name="line929">929: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecAXPY.html">VecAXPY</a>(VecsDeltaLam[nadj * s + i], ark-&gt;scoeff / adjoint_time_step, VecsSensiTemp[nadj]));
<a name="line930">930: </a>        <font color="#4169E1">if</font> (ts-&gt;vecs_sensip) {
<a name="line931">931: </a>          <font color="#B22222">/* - dHdP Temp */</font>
<a name="line932">932: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Mat/MatMultTranspose.html">MatMultTranspose</a>(ts-&gt;Jacp, VecsSensiTemp[nadj], VecsSensiPTemp[nadj]));
<a name="line933">933: </a>          <font color="#B22222">/* mu_n += h dHdP Temp */</font>
<a name="line934">934: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecAXPY.html">VecAXPY</a>(ts-&gt;vecs_sensip[nadj], -adjoint_time_step, VecsSensiPTemp[nadj]));
<a name="line935">935: </a>        }
<a name="line936">936: </a>        <font color="#B22222">/* Temp = \sum_{j=i+1}^s a[j][i] lambda_s[j] */</font>
<a name="line937">937: </a>        <font color="#4169E1">for</font> (j = i + 1; j &lt; s; j++) w[j - i - 1] = A[j * s + i];
<a name="line938">938: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecSet.html">VecSet</a>(VecsSensiTemp[nadj], 0));
<a name="line939">939: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecMAXPY.html">VecMAXPY</a>(VecsSensiTemp[nadj], s - i - 1, w, &amp;VecsDeltaLam[nadj * s + i + 1]));
<a name="line940">940: </a>        <font color="#B22222">/* dGdU Temp */</font>
<a name="line941">941: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Mat/MatMultTransposeAdd.html">MatMultTransposeAdd</a>(Jex, VecsSensiTemp[nadj], VecsDeltaLam[nadj * s + i], VecsDeltaLam[nadj * s + i]));
<a name="line942">942: </a>        <font color="#4169E1">if</font> (ts-&gt;vecs_sensip) {
<a name="line943">943: </a>          <font color="#B22222">/* dGdP Temp */</font>
<a name="line944">944: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Mat/MatMultTranspose.html">MatMultTranspose</a>(ts-&gt;Jacprhs, VecsSensiTemp[nadj], VecsSensiPTemp[nadj]));
<a name="line945">945: </a>          <font color="#B22222">/* mu_n += h dGdP Temp */</font>
<a name="line946">946: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecAXPY.html">VecAXPY</a>(ts-&gt;vecs_sensip[nadj], adjoint_time_step, VecsSensiPTemp[nadj]));
<a name="line947">947: </a>        }
<a name="line948">948: </a>      } <font color="#4169E1">else</font> {
<a name="line949">949: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecSet.html">VecSet</a>(VecsDeltaLam[nadj * s + i], 0)); // make sure it is initialized
<a name="line950">950: </a>      }
<a name="line951">951: </a>      <font color="#4169E1">if</font> (bt[i]) { // bt[i] dHdU lambda_{n+1}
<a name="line952">952: </a>        <font color="#B22222">/* (shift I - dHdU)^T lambda_{n+1} */</font>
<a name="line953">953: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Mat/MatMultTranspose.html">MatMultTranspose</a>(Jim, ts-&gt;vecs_sensi[nadj], VecsSensiTemp[nadj]));
<a name="line954">954: </a>        <font color="#B22222">/* -bt[i] (shift I - dHdU)^T lambda_{n+1} */</font>
<a name="line955">955: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecAXPY.html">VecAXPY</a>(VecsDeltaLam[nadj * s + i], -bt[i], VecsSensiTemp[nadj]));
<a name="line956">956: </a>        <font color="#B22222">/* cancel out -bt[i] shift lambda_{n+1} */</font>
<a name="line957">957: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecAXPY.html">VecAXPY</a>(VecsDeltaLam[nadj * s + i], -bt[i] * ark-&gt;scoeff / adjoint_time_step, ts-&gt;vecs_sensi[nadj]));
<a name="line958">958: </a>        <font color="#4169E1">if</font> (ts-&gt;vecs_sensip) {
<a name="line959">959: </a>          <font color="#B22222">/* -dHdP lambda_{n+1} */</font>
<a name="line960">960: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Mat/MatMultTranspose.html">MatMultTranspose</a>(ts-&gt;Jacp, ts-&gt;vecs_sensi[nadj], VecsSensiPTemp[nadj]));
<a name="line961">961: </a>          <font color="#B22222">/* mu_n += h bt[i] dHdP lambda_{n+1} */</font>
<a name="line962">962: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecAXPY.html">VecAXPY</a>(ts-&gt;vecs_sensip[nadj], -bt[i] * adjoint_time_step, VecsSensiPTemp[nadj]));
<a name="line963">963: </a>        }
<a name="line964">964: </a>      }
<a name="line965">965: </a>      <font color="#4169E1">if</font> (b[i]) { // b[i] dGdU lambda_{n+1}
<a name="line966">966: </a>        <font color="#B22222">/* dGdU lambda_{n+1} */</font>
<a name="line967">967: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Mat/MatMultTranspose.html">MatMultTranspose</a>(Jex, ts-&gt;vecs_sensi[nadj], VecsSensiTemp[nadj]));
<a name="line968">968: </a>        <font color="#B22222">/* b[i] dGdU lambda_{n+1} */</font>
<a name="line969">969: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecAXPY.html">VecAXPY</a>(VecsDeltaLam[nadj * s + i], b[i], VecsSensiTemp[nadj]));
<a name="line970">970: </a>        <font color="#4169E1">if</font> (ts-&gt;vecs_sensip) {
<a name="line971">971: </a>          <font color="#B22222">/* dGdP lambda_{n+1} */</font>
<a name="line972">972: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Mat/MatMultTranspose.html">MatMultTranspose</a>(ts-&gt;Jacprhs, ts-&gt;vecs_sensi[nadj], VecsSensiPTemp[nadj]));
<a name="line973">973: </a>          <font color="#B22222">/* mu_n += h b[i] dGdP lambda_{n+1} */</font>
<a name="line974">974: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecAXPY.html">VecAXPY</a>(ts-&gt;vecs_sensip[nadj], b[i] * adjoint_time_step, VecsSensiPTemp[nadj]));
<a name="line975">975: </a>        }
<a name="line976">976: </a>      }
<a name="line977">977: </a>      <font color="#B22222">/* Build LHS for first-order adjoint */</font>
<a name="line978">978: </a>      <font color="#4169E1">if</font> (At[i * s + i] == 0) { // This stage is explicit
<a name="line979">979: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecScale.html">VecScale</a>(VecsDeltaLam[nadj * s + i], adjoint_time_step));
<a name="line980">980: </a>      } <font color="#4169E1">else</font> {
<a name="line981">981: </a>        <a href="../../../../manualpages/KSP/KSP.html">KSP</a>                ksp;
<a name="line982">982: </a>        <a href="../../../../manualpages/KSP/KSPConvergedReason.html">KSPConvergedReason</a> kspreason;
<a name="line983">983: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/SNES/SNESGetKSP.html">SNESGetKSP</a>(ts-&gt;snes, &amp;ksp));
<a name="line984">984: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/KSP/KSPSetOperators.html">KSPSetOperators</a>(ksp, Jim, Jimpre));
<a name="line985">985: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecScale.html">VecScale</a>(VecsDeltaLam[nadj * s + i], 1. / At[i * s + i]));
<a name="line986">986: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/KSP/KSPSolveTranspose.html">KSPSolveTranspose</a>(ksp, VecsDeltaLam[nadj * s + i], VecsDeltaLam[nadj * s + i]));
<a name="line987">987: </a>        <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/KSP/KSPGetConvergedReason.html">KSPGetConvergedReason</a>(ksp, &amp;kspreason));
<a name="line988">988: </a>        <font color="#4169E1">if</font> (kspreason &lt; 0) {
<a name="line989">989: </a>          ts-&gt;reason = <a href="../../../../manualpages/TS/TSConvergedReason.html">TSADJOINT_DIVERGED_LINEAR_SOLVE</a>;
<a name="line990">990: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Profiling/PetscInfo.html">PetscInfo</a>(ts, <font color="#666666">"Step=%"</font> PetscInt_FMT <font color="#666666">", %"</font> PetscInt_FMT <font color="#666666">"th cost function, transposed linear solve fails, stopping 1st-order adjoint solve\n"</font>, ts-&gt;steps, nadj));
<a name="line991">991: </a>        }
<a name="line992">992: </a>        <font color="#4169E1">if</font> (ts-&gt;vecs_sensip) {
<a name="line993">993: </a>          <font color="#B22222">/* -dHdP lambda_s[i] */</font>
<a name="line994">994: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Mat/MatMultTranspose.html">MatMultTranspose</a>(ts-&gt;Jacp, VecsDeltaLam[nadj * s + i], VecsSensiPTemp[nadj]));
<a name="line995">995: </a>          <font color="#B22222">/* mu_n += h at[i][i] dHdP lambda_s[i] */</font>
<a name="line996">996: </a>          <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecAXPY.html">VecAXPY</a>(ts-&gt;vecs_sensip[nadj], -At[i * s + i] * adjoint_time_step, VecsSensiPTemp[nadj]));
<a name="line997">997: </a>        }
<a name="line998">998: </a>      }
<a name="line999">999: </a>    }
<a name="line1000">1000: </a>  }
<a name="line1001">1001: </a>  <font color="#4169E1">for</font> (j = 0; j &lt; s; j++) w[j] = 1.0;
<a name="line1002">1002: </a>  <font color="#4169E1">for</font> (nadj = 0; nadj &lt; ts-&gt;numcost; nadj++) // no need to <font color="#4169E1">do</font> this <font color="#4169E1">for</font> mu's
<a name="line1003">1003: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecMAXPY.html">VecMAXPY</a>(ts-&gt;vecs_sensi[nadj], s, w, &amp;VecsDeltaLam[nadj * s]));
<a name="line1004">1004: </a>  ark-&gt;status = TS_STEP_COMPLETE;
<a name="line1005">1005: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1006">1006: </a>}

<a name="line1008">1008: </a><strong><font color="#4169E1"><a name="TSInterpolate_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSInterpolate_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a> ts, <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> itime, <a href="../../../../manualpages/Vec/Vec.html">Vec</a> X)</font></strong>
<a name="line1009">1009: </a>{
<a name="line1010">1010: </a>  TS_ARKIMEX      *ark = (TS_ARKIMEX *)ts-&gt;data;
<a name="line1011">1011: </a>  <a href="../../../../manualpages/Sys/PetscInt.html">PetscInt</a>         s = ark-&gt;tableau-&gt;s, pinterp = ark-&gt;tableau-&gt;pinterp, i, j;
<a name="line1012">1012: </a>  <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a>        h;
<a name="line1013">1013: </a>  <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a>        tt, t;
<a name="line1014">1014: </a>  <a href="../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a>     *bt, *b;
<a name="line1015">1015: </a>  const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> *Bt = ark-&gt;tableau-&gt;binterpt, *B = ark-&gt;tableau-&gt;binterp;

<a name="line1017">1017: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1018">1018: </a>  <a href="../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(Bt &amp;&amp; B, <a href="../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts), <a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_SUP</a>, <font color="#666666">"<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a> %s does not have an interpolation formula"</font>, ark-&gt;tableau-&gt;name);
<a name="line1019">1019: </a>  <font color="#4169E1">switch</font> (ark-&gt;status) {
<a name="line1020">1020: </a>  <font color="#4169E1">case</font> TS_STEP_INCOMPLETE:
<a name="line1021">1021: </a>  <font color="#4169E1">case</font> TS_STEP_PENDING:
<a name="line1022">1022: </a>    h = ts-&gt;time_step;
<a name="line1023">1023: </a>    t = (itime - ts-&gt;ptime) / h;
<a name="line1024">1024: </a>    <font color="#4169E1">break</font>;
<a name="line1025">1025: </a>  <font color="#4169E1">case</font> TS_STEP_COMPLETE:
<a name="line1026">1026: </a>    h = ts-&gt;ptime - ts-&gt;ptime_prev;
<a name="line1027">1027: </a>    t = (itime - ts-&gt;ptime) / h + 1; <font color="#B22222">/* In the interval [0,1] */</font>
<a name="line1028">1028: </a>    <font color="#4169E1">break</font>;
<a name="line1029">1029: </a><strong><font color="#FF0000">  default:</font></strong>
<a name="line1030">1030: </a>    <a href="../../../../manualpages/Sys/SETERRQ.html">SETERRQ</a>(<a href="../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts), <a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_PLIB</a>, <font color="#666666">"Invalid TSStepStatus"</font>);
<a name="line1031">1031: </a>  }
<a name="line1032">1032: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscMalloc2.html">PetscMalloc2</a>(s, &amp;bt, s, &amp;b));
<a name="line1033">1033: </a>  <font color="#4169E1">for</font> (i = 0; i &lt; s; i++) bt[i] = b[i] = 0;
<a name="line1034">1034: </a>  <font color="#4169E1">for</font> (j = 0, tt = t; j &lt; pinterp; j++, tt *= t) {
<a name="line1035">1035: </a>    <font color="#4169E1">for</font> (i = 0; i &lt; s; i++) {
<a name="line1036">1036: </a>      bt[i] += h * Bt[i * pinterp + j] * tt;
<a name="line1037">1037: </a>      b[i] += h * B[i * pinterp + j] * tt;
<a name="line1038">1038: </a>    }
<a name="line1039">1039: </a>  }
<a name="line1040">1040: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecCopy.html">VecCopy</a>(ark-&gt;Y[0], X));
<a name="line1041">1041: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecMAXPY.html">VecMAXPY</a>(X, s, bt, ark-&gt;YdotI));
<a name="line1042">1042: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecMAXPY.html">VecMAXPY</a>(X, s, b, ark-&gt;YdotRHS));
<a name="line1043">1043: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscFree2.html">PetscFree2</a>(bt, b));
<a name="line1044">1044: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1045">1045: </a>}

<a name="line1047">1047: </a><strong><font color="#4169E1"><a name="TSExtrapolate_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSExtrapolate_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a> ts, <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> c, <a href="../../../../manualpages/Vec/Vec.html">Vec</a> X)</font></strong>
<a name="line1048">1048: </a>{
<a name="line1049">1049: </a>  TS_ARKIMEX      *ark = (TS_ARKIMEX *)ts-&gt;data;
<a name="line1050">1050: </a>  <a href="../../../../manualpages/Sys/PetscInt.html">PetscInt</a>         s = ark-&gt;tableau-&gt;s, pinterp = ark-&gt;tableau-&gt;pinterp, i, j;
<a name="line1051">1051: </a>  <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a>        h, h_prev, t, tt;
<a name="line1052">1052: </a>  <a href="../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a>     *bt, *b;
<a name="line1053">1053: </a>  const <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a> *Bt = ark-&gt;tableau-&gt;binterpt, *B = ark-&gt;tableau-&gt;binterp;

<a name="line1055">1055: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1056">1056: </a>  <a href="../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(Bt &amp;&amp; B, <a href="../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts), <a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_SUP</a>, <font color="#666666">"<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a> %s does not have an interpolation formula"</font>, ark-&gt;tableau-&gt;name);
<a name="line1057">1057: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscCalloc2.html">PetscCalloc2</a>(s, &amp;bt, s, &amp;b));
<a name="line1058">1058: </a>  h      = ts-&gt;time_step;
<a name="line1059">1059: </a>  h_prev = ts-&gt;ptime - ts-&gt;ptime_prev;
<a name="line1060">1060: </a>  t      = 1 + h / h_prev * c;
<a name="line1061">1061: </a>  <font color="#4169E1">for</font> (j = 0, tt = t; j &lt; pinterp; j++, tt *= t) {
<a name="line1062">1062: </a>    <font color="#4169E1">for</font> (i = 0; i &lt; s; i++) {
<a name="line1063">1063: </a>      bt[i] += h * Bt[i * pinterp + j] * tt;
<a name="line1064">1064: </a>      b[i] += h * B[i * pinterp + j] * tt;
<a name="line1065">1065: </a>    }
<a name="line1066">1066: </a>  }
<a name="line1067">1067: </a>  <a href="../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(ark-&gt;Y_prev, <a href="../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts), <a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_SUP</a>, <font color="#666666">"Stages from previous step have not been stored"</font>);
<a name="line1068">1068: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecCopy.html">VecCopy</a>(ark-&gt;Y_prev[0], X));
<a name="line1069">1069: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecMAXPY.html">VecMAXPY</a>(X, s, bt, ark-&gt;YdotI_prev));
<a name="line1070">1070: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecMAXPY.html">VecMAXPY</a>(X, s, b, ark-&gt;YdotRHS_prev));
<a name="line1071">1071: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscFree2.html">PetscFree2</a>(bt, b));
<a name="line1072">1072: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1073">1073: </a>}

<a name="line1075">1075: </a><font color="#B22222">/*------------------------------------------------------------*/</font>

<a name="line1077">1077: </a><strong><font color="#4169E1"><a name="TSARKIMEXTableauReset"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSARKIMEXTableauReset(<a href="../../../../manualpages/TS/TS.html">TS</a> ts)</font></strong>
<a name="line1078">1078: </a>{
<a name="line1079">1079: </a>  TS_ARKIMEX *ark = (TS_ARKIMEX *)ts-&gt;data;
<a name="line1080">1080: </a>  ARKTableau  tab = ark-&gt;tableau;

<a name="line1082">1082: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1083">1083: </a>  <font color="#4169E1">if</font> (!tab) <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1084">1084: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscFree.html">PetscFree</a>(ark-&gt;work));
<a name="line1085">1085: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDestroyVecs.html">VecDestroyVecs</a>(tab-&gt;s, &amp;ark-&gt;Y));
<a name="line1086">1086: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDestroyVecs.html">VecDestroyVecs</a>(tab-&gt;s, &amp;ark-&gt;YdotI));
<a name="line1087">1087: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDestroyVecs.html">VecDestroyVecs</a>(tab-&gt;s, &amp;ark-&gt;YdotRHS));
<a name="line1088">1088: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDestroyVecs.html">VecDestroyVecs</a>(tab-&gt;s, &amp;ark-&gt;Y_prev));
<a name="line1089">1089: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDestroyVecs.html">VecDestroyVecs</a>(tab-&gt;s, &amp;ark-&gt;YdotI_prev));
<a name="line1090">1090: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDestroyVecs.html">VecDestroyVecs</a>(tab-&gt;s, &amp;ark-&gt;YdotRHS_prev));
<a name="line1091">1091: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1092">1092: </a>}

<a name="line1094">1094: </a><strong><font color="#4169E1"><a name="TSReset_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSReset_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a> ts)</font></strong>
<a name="line1095">1095: </a>{
<a name="line1096">1096: </a>  TS_ARKIMEX *ark = (TS_ARKIMEX *)ts-&gt;data;

<a name="line1098">1098: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1099">1099: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSARKIMEXTableauReset(ts));
<a name="line1100">1100: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDestroy.html">VecDestroy</a>(&amp;ark-&gt;Ydot));
<a name="line1101">1101: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDestroy.html">VecDestroy</a>(&amp;ark-&gt;Ydot0));
<a name="line1102">1102: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDestroy.html">VecDestroy</a>(&amp;ark-&gt;Z));
<a name="line1103">1103: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1104">1104: </a>}

<a name="line1106">1106: </a><strong><font color="#4169E1"><a name="TSAdjointReset_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSAdjointReset_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a> ts)</font></strong>
<a name="line1107">1107: </a>{
<a name="line1108">1108: </a>  TS_ARKIMEX *ark = (TS_ARKIMEX *)ts-&gt;data;
<a name="line1109">1109: </a>  ARKTableau  tab = ark-&gt;tableau;

<a name="line1111">1111: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1112">1112: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDestroyVecs.html">VecDestroyVecs</a>(tab-&gt;s * ts-&gt;numcost, &amp;ark-&gt;VecsDeltaLam));
<a name="line1113">1113: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDestroyVecs.html">VecDestroyVecs</a>(ts-&gt;numcost, &amp;ark-&gt;VecsSensiTemp));
<a name="line1114">1114: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDestroyVecs.html">VecDestroyVecs</a>(ts-&gt;numcost, &amp;ark-&gt;VecsSensiPTemp));
<a name="line1115">1115: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1116">1116: </a>}

<a name="line1118">1118: </a><strong><font color="#4169E1"><a name="TSARKIMEXGetVecs"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSARKIMEXGetVecs(<a href="../../../../manualpages/TS/TS.html">TS</a> ts, <a href="../../../../manualpages/DM/DM.html">DM</a> dm, <a href="../../../../manualpages/Vec/Vec.html">Vec</a> *Z, <a href="../../../../manualpages/Vec/Vec.html">Vec</a> *Ydot)</font></strong>
<a name="line1119">1119: </a>{
<a name="line1120">1120: </a>  TS_ARKIMEX *ax = (TS_ARKIMEX *)ts-&gt;data;

<a name="line1122">1122: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1123">1123: </a>  <font color="#4169E1">if</font> (Z) {
<a name="line1124">1124: </a>    <font color="#4169E1">if</font> (dm &amp;&amp; dm != ts-&gt;dm) {
<a name="line1125">1125: </a>      <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/DM/DMGetNamedGlobalVector.html">DMGetNamedGlobalVector</a>(dm, <font color="#666666">"TSARKIMEX_Z"</font>, Z));
<a name="line1126">1126: </a>    } <font color="#4169E1">else</font> *Z = ax-&gt;Z;
<a name="line1127">1127: </a>  }
<a name="line1128">1128: </a>  <font color="#4169E1">if</font> (Ydot) {
<a name="line1129">1129: </a>    <font color="#4169E1">if</font> (dm &amp;&amp; dm != ts-&gt;dm) {
<a name="line1130">1130: </a>      <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/DM/DMGetNamedGlobalVector.html">DMGetNamedGlobalVector</a>(dm, <font color="#666666">"TSARKIMEX_Ydot"</font>, Ydot));
<a name="line1131">1131: </a>    } <font color="#4169E1">else</font> *Ydot = ax-&gt;Ydot;
<a name="line1132">1132: </a>  }
<a name="line1133">1133: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1134">1134: </a>}

<a name="line1136">1136: </a><strong><font color="#4169E1"><a name="TSARKIMEXRestoreVecs"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSARKIMEXRestoreVecs(<a href="../../../../manualpages/TS/TS.html">TS</a> ts, <a href="../../../../manualpages/DM/DM.html">DM</a> dm, <a href="../../../../manualpages/Vec/Vec.html">Vec</a> *Z, <a href="../../../../manualpages/Vec/Vec.html">Vec</a> *Ydot)</font></strong>
<a name="line1137">1137: </a>{
<a name="line1138">1138: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1139">1139: </a>  <font color="#4169E1">if</font> (Z) {
<a name="line1140">1140: </a>    <font color="#4169E1">if</font> (dm &amp;&amp; dm != ts-&gt;dm) <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/DM/DMRestoreNamedGlobalVector.html">DMRestoreNamedGlobalVector</a>(dm, <font color="#666666">"TSARKIMEX_Z"</font>, Z));
<a name="line1141">1141: </a>  }
<a name="line1142">1142: </a>  <font color="#4169E1">if</font> (Ydot) {
<a name="line1143">1143: </a>    <font color="#4169E1">if</font> (dm &amp;&amp; dm != ts-&gt;dm) <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/DM/DMRestoreNamedGlobalVector.html">DMRestoreNamedGlobalVector</a>(dm, <font color="#666666">"TSARKIMEX_Ydot"</font>, Ydot));
<a name="line1144">1144: </a>  }
<a name="line1145">1145: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1146">1146: </a>}

<a name="line1148">1148: </a><font color="#B22222">/*</font>
<a name="line1149">1149: </a><font color="#B22222">  This defines the nonlinear equation that is to be solved with <a href="../../../../manualpages/SNES/SNES.html">SNES</a></font>
<a name="line1150">1150: </a><font color="#B22222">  G(U) = F[t0+Theta*dt, U, (U-U0)*shift] = 0</font>
<a name="line1151">1151: </a><font color="#B22222">*/</font>
<a name="line1152">1152: </a><strong><font color="#4169E1"><a name="SNESTSFormFunction_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> SNESTSFormFunction_ARKIMEX(<a href="../../../../manualpages/SNES/SNES.html">SNES</a> snes, <a href="../../../../manualpages/Vec/Vec.html">Vec</a> X, <a href="../../../../manualpages/Vec/Vec.html">Vec</a> F, <a href="../../../../manualpages/TS/TS.html">TS</a> ts)</font></strong>
<a name="line1153">1153: </a>{
<a name="line1154">1154: </a>  TS_ARKIMEX *ark = (TS_ARKIMEX *)ts-&gt;data;
<a name="line1155">1155: </a>  <a href="../../../../manualpages/DM/DM.html">DM</a>          dm, dmsave;
<a name="line1156">1156: </a>  <a href="../../../../manualpages/Vec/Vec.html">Vec</a>         Z, Ydot;
<a name="line1157">1157: </a>  <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a>   shift = ark-&gt;scoeff / ts-&gt;time_step;

<a name="line1159">1159: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1160">1160: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/SNES/SNESGetDM.html">SNESGetDM</a>(snes, &amp;dm));
<a name="line1161">1161: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSARKIMEXGetVecs(ts, dm, &amp;Z, &amp;Ydot));
<a name="line1162">1162: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecAXPBYPCZ.html">VecAXPBYPCZ</a>(Ydot, -shift, shift, 0, Z, X)); <font color="#B22222">/* Ydot = shift*(X-Z) */</font>
<a name="line1163">1163: </a>  dmsave = ts-&gt;dm;
<a name="line1164">1164: </a>  ts-&gt;dm = dm;

<a name="line1166">1166: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSComputeIFunction.html">TSComputeIFunction</a>(ts, ark-&gt;stage_time, X, Ydot, F, ark-&gt;imex));

<a name="line1168">1168: </a>  ts-&gt;dm = dmsave;
<a name="line1169">1169: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSARKIMEXRestoreVecs(ts, dm, &amp;Z, &amp;Ydot));
<a name="line1170">1170: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1171">1171: </a>}

<a name="line1173">1173: </a><strong><font color="#4169E1"><a name="SNESTSFormJacobian_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> SNESTSFormJacobian_ARKIMEX(<a href="../../../../manualpages/SNES/SNES.html">SNES</a> snes, <a href="../../../../manualpages/Vec/Vec.html">Vec</a> X, <a href="../../../../manualpages/Mat/Mat.html">Mat</a> A, <a href="../../../../manualpages/Mat/Mat.html">Mat</a> B, <a href="../../../../manualpages/TS/TS.html">TS</a> ts)</font></strong>
<a name="line1174">1174: </a>{
<a name="line1175">1175: </a>  TS_ARKIMEX *ark = (TS_ARKIMEX *)ts-&gt;data;
<a name="line1176">1176: </a>  <a href="../../../../manualpages/DM/DM.html">DM</a>          dm, dmsave;
<a name="line1177">1177: </a>  <a href="../../../../manualpages/Vec/Vec.html">Vec</a>         Ydot;
<a name="line1178">1178: </a>  <a href="../../../../manualpages/Sys/PetscReal.html">PetscReal</a>   shift = ark-&gt;scoeff / ts-&gt;time_step;

<a name="line1180">1180: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1181">1181: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/SNES/SNESGetDM.html">SNESGetDM</a>(snes, &amp;dm));
<a name="line1182">1182: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSARKIMEXGetVecs(ts, dm, NULL, &amp;Ydot));
<a name="line1183">1183: </a>  <font color="#B22222">/* ark-&gt;Ydot has already been computed in SNESTSFormFunction_ARKIMEX (<a href="../../../../manualpages/SNES/SNES.html">SNES</a> guarantees this) */</font>
<a name="line1184">1184: </a>  dmsave = ts-&gt;dm;
<a name="line1185">1185: </a>  ts-&gt;dm = dm;

<a name="line1187">1187: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSComputeIJacobian.html">TSComputeIJacobian</a>(ts, ark-&gt;stage_time, X, Ydot, shift, A, B, ark-&gt;imex));

<a name="line1189">1189: </a>  ts-&gt;dm = dmsave;
<a name="line1190">1190: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSARKIMEXRestoreVecs(ts, dm, NULL, &amp;Ydot));
<a name="line1191">1191: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1192">1192: </a>}

<a name="line1194">1194: </a><strong><font color="#4169E1"><a name="TSGetStages_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSGetStages_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a> ts, <a href="../../../../manualpages/Sys/PetscInt.html">PetscInt</a> *ns, <a href="../../../../manualpages/Vec/Vec.html">Vec</a> *Y[])</font></strong>
<a name="line1195">1195: </a>{
<a name="line1196">1196: </a>  TS_ARKIMEX *ark = (TS_ARKIMEX *)ts-&gt;data;

<a name="line1198">1198: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1199">1199: </a>  <font color="#4169E1">if</font> (ns) *ns = ark-&gt;tableau-&gt;s;
<a name="line1200">1200: </a>  <font color="#4169E1">if</font> (Y) *Y = ark-&gt;Y;
<a name="line1201">1201: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1202">1202: </a>}

<a name="line1204">1204: </a><strong><font color="#4169E1"><a name="DMCoarsenHook_TSARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> DMCoarsenHook_TSARKIMEX(<a href="../../../../manualpages/DM/DM.html">DM</a> fine, <a href="../../../../manualpages/DM/DM.html">DM</a> coarse, void *ctx)</font></strong>
<a name="line1205">1205: </a>{
<a name="line1206">1206: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1207">1207: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1208">1208: </a>}

<a name="line1210">1210: </a><strong><font color="#4169E1"><a name="DMRestrictHook_TSARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> DMRestrictHook_TSARKIMEX(<a href="../../../../manualpages/DM/DM.html">DM</a> fine, <a href="../../../../manualpages/Mat/Mat.html">Mat</a> restrct, <a href="../../../../manualpages/Vec/Vec.html">Vec</a> rscale, <a href="../../../../manualpages/Mat/Mat.html">Mat</a> inject, <a href="../../../../manualpages/DM/DM.html">DM</a> coarse, void *ctx)</font></strong>
<a name="line1211">1211: </a>{
<a name="line1212">1212: </a>  <a href="../../../../manualpages/TS/TS.html">TS</a>  ts = (<a href="../../../../manualpages/TS/TS.html">TS</a>)ctx;
<a name="line1213">1213: </a>  <a href="../../../../manualpages/Vec/Vec.html">Vec</a> Z, Z_c;

<a name="line1215">1215: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1216">1216: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSARKIMEXGetVecs(ts, fine, &amp;Z, NULL));
<a name="line1217">1217: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSARKIMEXGetVecs(ts, coarse, &amp;Z_c, NULL));
<a name="line1218">1218: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Mat/MatRestrict.html">MatRestrict</a>(restrct, Z, Z_c));
<a name="line1219">1219: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecPointwiseMult.html">VecPointwiseMult</a>(Z_c, rscale, Z_c));
<a name="line1220">1220: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSARKIMEXRestoreVecs(ts, fine, &amp;Z, NULL));
<a name="line1221">1221: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSARKIMEXRestoreVecs(ts, coarse, &amp;Z_c, NULL));
<a name="line1222">1222: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1223">1223: </a>}

<a name="line1225">1225: </a><strong><font color="#4169E1"><a name="DMSubDomainHook_TSARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> DMSubDomainHook_TSARKIMEX(<a href="../../../../manualpages/DM/DM.html">DM</a> dm, <a href="../../../../manualpages/DM/DM.html">DM</a> subdm, void *ctx)</font></strong>
<a name="line1226">1226: </a>{
<a name="line1227">1227: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1228">1228: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1229">1229: </a>}

<a name="line1231">1231: </a><strong><font color="#4169E1"><a name="DMSubDomainRestrictHook_TSARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> DMSubDomainRestrictHook_TSARKIMEX(<a href="../../../../manualpages/DM/DM.html">DM</a> dm, <a href="../../../../manualpages/PetscSF/VecScatter.html">VecScatter</a> gscat, <a href="../../../../manualpages/PetscSF/VecScatter.html">VecScatter</a> lscat, <a href="../../../../manualpages/DM/DM.html">DM</a> subdm, void *ctx)</font></strong>
<a name="line1232">1232: </a>{
<a name="line1233">1233: </a>  <a href="../../../../manualpages/TS/TS.html">TS</a>  ts = (<a href="../../../../manualpages/TS/TS.html">TS</a>)ctx;
<a name="line1234">1234: </a>  <a href="../../../../manualpages/Vec/Vec.html">Vec</a> Z, Z_c;

<a name="line1236">1236: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1237">1237: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSARKIMEXGetVecs(ts, dm, &amp;Z, NULL));
<a name="line1238">1238: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSARKIMEXGetVecs(ts, subdm, &amp;Z_c, NULL));

<a name="line1240">1240: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/PetscSF/VecScatterBegin.html">VecScatterBegin</a>(gscat, Z, Z_c, <a href="../../../../manualpages/Sys/INSERT_VALUES.html">INSERT_VALUES</a>, <a href="../../../../manualpages/Vec/SCATTER_FORWARD.html">SCATTER_FORWARD</a>));
<a name="line1241">1241: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/PetscSF/VecScatterEnd.html">VecScatterEnd</a>(gscat, Z, Z_c, <a href="../../../../manualpages/Sys/INSERT_VALUES.html">INSERT_VALUES</a>, <a href="../../../../manualpages/Vec/SCATTER_FORWARD.html">SCATTER_FORWARD</a>));

<a name="line1243">1243: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSARKIMEXRestoreVecs(ts, dm, &amp;Z, NULL));
<a name="line1244">1244: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSARKIMEXRestoreVecs(ts, subdm, &amp;Z_c, NULL));
<a name="line1245">1245: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1246">1246: </a>}

<a name="line1248">1248: </a><strong><font color="#4169E1"><a name="TSARKIMEXTableauSetUp"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSARKIMEXTableauSetUp(<a href="../../../../manualpages/TS/TS.html">TS</a> ts)</font></strong>
<a name="line1249">1249: </a>{
<a name="line1250">1250: </a>  TS_ARKIMEX *ark = (TS_ARKIMEX *)ts-&gt;data;
<a name="line1251">1251: </a>  ARKTableau  tab = ark-&gt;tableau;

<a name="line1253">1253: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1254">1254: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscMalloc1.html">PetscMalloc1</a>(tab-&gt;s, &amp;ark-&gt;work));
<a name="line1255">1255: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDuplicateVecs.html">VecDuplicateVecs</a>(ts-&gt;vec_sol, tab-&gt;s, &amp;ark-&gt;Y));
<a name="line1256">1256: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDuplicateVecs.html">VecDuplicateVecs</a>(ts-&gt;vec_sol, tab-&gt;s, &amp;ark-&gt;YdotI));
<a name="line1257">1257: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDuplicateVecs.html">VecDuplicateVecs</a>(ts-&gt;vec_sol, tab-&gt;s, &amp;ark-&gt;YdotRHS));
<a name="line1258">1258: </a>  <font color="#4169E1">if</font> (ark-&gt;extrapolate) {
<a name="line1259">1259: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDuplicateVecs.html">VecDuplicateVecs</a>(ts-&gt;vec_sol, tab-&gt;s, &amp;ark-&gt;Y_prev));
<a name="line1260">1260: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDuplicateVecs.html">VecDuplicateVecs</a>(ts-&gt;vec_sol, tab-&gt;s, &amp;ark-&gt;YdotI_prev));
<a name="line1261">1261: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDuplicateVecs.html">VecDuplicateVecs</a>(ts-&gt;vec_sol, tab-&gt;s, &amp;ark-&gt;YdotRHS_prev));
<a name="line1262">1262: </a>  }
<a name="line1263">1263: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1264">1264: </a>}

<a name="line1266">1266: </a><strong><font color="#4169E1"><a name="TSSetUp_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSSetUp_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a> ts)</font></strong>
<a name="line1267">1267: </a>{
<a name="line1268">1268: </a>  TS_ARKIMEX *ark = (TS_ARKIMEX *)ts-&gt;data;
<a name="line1269">1269: </a>  <a href="../../../../manualpages/DM/DM.html">DM</a>          dm;
<a name="line1270">1270: </a>  <a href="../../../../manualpages/SNES/SNES.html">SNES</a>        snes;

<a name="line1272">1272: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1273">1273: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSARKIMEXTableauSetUp(ts));
<a name="line1274">1274: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDuplicate.html">VecDuplicate</a>(ts-&gt;vec_sol, &amp;ark-&gt;Ydot));
<a name="line1275">1275: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDuplicate.html">VecDuplicate</a>(ts-&gt;vec_sol, &amp;ark-&gt;Ydot0));
<a name="line1276">1276: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDuplicate.html">VecDuplicate</a>(ts-&gt;vec_sol, &amp;ark-&gt;Z));
<a name="line1277">1277: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSGetDM.html">TSGetDM</a>(ts, &amp;dm));
<a name="line1278">1278: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/DM/DMCoarsenHookAdd.html">DMCoarsenHookAdd</a>(dm, DMCoarsenHook_TSARKIMEX, DMRestrictHook_TSARKIMEX, ts));
<a name="line1279">1279: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/DM/DMSubDomainHookAdd.html">DMSubDomainHookAdd</a>(dm, DMSubDomainHook_TSARKIMEX, DMSubDomainRestrictHook_TSARKIMEX, ts));
<a name="line1280">1280: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSGetSNES.html">TSGetSNES</a>(ts, &amp;snes));
<a name="line1281">1281: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1282">1282: </a>}
<a name="line1283">1283: </a><font color="#B22222">/*------------------------------------------------------------*/</font>

<a name="line1285">1285: </a><strong><font color="#4169E1"><a name="TSAdjointSetUp_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSAdjointSetUp_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a> ts)</font></strong>
<a name="line1286">1286: </a>{
<a name="line1287">1287: </a>  TS_ARKIMEX *ark = (TS_ARKIMEX *)ts-&gt;data;
<a name="line1288">1288: </a>  ARKTableau  tab = ark-&gt;tableau;

<a name="line1290">1290: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1291">1291: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDuplicateVecs.html">VecDuplicateVecs</a>(ts-&gt;vecs_sensi[0], tab-&gt;s * ts-&gt;numcost, &amp;ark-&gt;VecsDeltaLam));
<a name="line1292">1292: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDuplicateVecs.html">VecDuplicateVecs</a>(ts-&gt;vecs_sensi[0], ts-&gt;numcost, &amp;ark-&gt;VecsSensiTemp));
<a name="line1293">1293: </a>  <font color="#4169E1">if</font> (ts-&gt;vecs_sensip) { <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Vec/VecDuplicateVecs.html">VecDuplicateVecs</a>(ts-&gt;vecs_sensip[0], ts-&gt;numcost, &amp;ark-&gt;VecsSensiPTemp)); }
<a name="line1294">1294: </a>  <font color="#4169E1">if</font> (<a href="../../../../manualpages/Sys/PetscDefined.html">PetscDefined</a>(USE_DEBUG)) {
<a name="line1295">1295: </a>    <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a> id = <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_FALSE</a>;
<a name="line1296">1296: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSARKIMEXTestMassIdentity(ts, &amp;id));
<a name="line1297">1297: </a>    <a href="../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(id, <a href="../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts), <a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_INCOMP</a>, <font color="#666666">"Adjoint ARKIMEX requires an identity mass matrix, however the TSIFunction you provide does not utilize an identity mass matrix"</font>);
<a name="line1298">1298: </a>  }
<a name="line1299">1299: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1300">1300: </a>}

<a name="line1302">1302: </a><strong><font color="#4169E1"><a name="TSSetFromOptions_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSSetFromOptions_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a> ts, PetscOptionItems *PetscOptionsObject)</font></strong>
<a name="line1303">1303: </a>{
<a name="line1304">1304: </a>  TS_ARKIMEX *ark = (TS_ARKIMEX *)ts-&gt;data;

<a name="line1306">1306: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1307">1307: </a>  <a href="../../../../manualpages/Sys/PetscOptionsHeadBegin.html">PetscOptionsHeadBegin</a>(PetscOptionsObject, <font color="#666666">"ARKIMEX ODE solver options"</font>);
<a name="line1308">1308: </a>  {
<a name="line1309">1309: </a>    ARKTableauLink link;
<a name="line1310">1310: </a>    <a href="../../../../manualpages/Sys/PetscInt.html">PetscInt</a>       count, choice;
<a name="line1311">1311: </a>    <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a>      flg;
<a name="line1312">1312: </a>    const char   **namelist;
<a name="line1313">1313: </a>    <font color="#4169E1">for</font> (link = ARKTableauList, count = 0; link; link = link-&gt;next, count++)
<a name="line1314">1314: </a>      ;
<a name="line1315">1315: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscMalloc1.html">PetscMalloc1</a>(count, (char ***)&amp;namelist));
<a name="line1316">1316: </a>    <font color="#4169E1">for</font> (link = ARKTableauList, count = 0; link; link = link-&gt;next, count++) namelist[count] = link-&gt;tab.name;
<a name="line1317">1317: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscOptionsEList.html">PetscOptionsEList</a>(<font color="#666666">"-ts_arkimex_type"</font>, <font color="#666666">"Family of ARK IMEX method"</font>, <font color="#666666">"<a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a>"</font>, (const char *const *)namelist, count, ark-&gt;tableau-&gt;name, &amp;choice, &amp;flg));
<a name="line1318">1318: </a>    <font color="#4169E1">if</font> (flg) <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a>(ts, namelist[choice]));
<a name="line1319">1319: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscFree.html">PetscFree</a>(namelist));

<a name="line1321">1321: </a>    flg = (<a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a>)!ark-&gt;imex;
<a name="line1322">1322: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscOptionsBool.html">PetscOptionsBool</a>(<font color="#666666">"-ts_arkimex_fully_implicit"</font>, <font color="#666666">"Solve the problem fully implicitly"</font>, <font color="#666666">"<a href="../../../../manualpages/TS/TSARKIMEXSetFullyImplicit.html">TSARKIMEXSetFullyImplicit</a>"</font>, flg, &amp;flg, NULL));
<a name="line1323">1323: </a>    ark-&gt;imex = (<a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a>)!flg;
<a name="line1324">1324: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscOptionsBool.html">PetscOptionsBool</a>(<font color="#666666">"-ts_arkimex_initial_guess_extrapolate"</font>, <font color="#666666">"Extrapolate the initial guess for the stage solution from stage values of the previous time step"</font>, <font color="#666666">""</font>, ark-&gt;extrapolate, &amp;ark-&gt;extrapolate, NULL));
<a name="line1325">1325: </a>  }
<a name="line1326">1326: </a>  PetscOptionsHeadEnd();
<a name="line1327">1327: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1328">1328: </a>}

<a name="line1330">1330: </a><strong><font color="#4169E1"><a name="TSView_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSView_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a> ts, <a href="../../../../manualpages/Viewer/PetscViewer.html">PetscViewer</a> viewer)</font></strong>
<a name="line1331">1331: </a>{
<a name="line1332">1332: </a>  TS_ARKIMEX *ark = (TS_ARKIMEX *)ts-&gt;data;
<a name="line1333">1333: </a>  <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a>   iascii;

<a name="line1335">1335: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1336">1336: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscObjectTypeCompare.html">PetscObjectTypeCompare</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)viewer, <a href="../../../../manualpages/Viewer/PETSCVIEWERASCII.html">PETSCVIEWERASCII</a>, &amp;iascii));
<a name="line1337">1337: </a>  <font color="#4169E1">if</font> (iascii) {
<a name="line1338">1338: </a>    ARKTableau    tab = ark-&gt;tableau;
<a name="line1339">1339: </a>    <a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a> arktype;
<a name="line1340">1340: </a>    char          buf[512];
<a name="line1341">1341: </a>    <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a>     flg;

<a name="line1343">1343: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXGetType.html">TSARKIMEXGetType</a>(ts, &amp;arktype));
<a name="line1344">1344: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXGetFullyImplicit.html">TSARKIMEXGetFullyImplicit</a>(ts, &amp;flg));
<a name="line1345">1345: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Viewer/PetscViewerASCIIPrintf.html">PetscViewerASCIIPrintf</a>(viewer, <font color="#666666">"  ARK IMEX %s\n"</font>, arktype));
<a name="line1346">1346: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(PetscFormatRealArray(buf, <font color="#4169E1">sizeof</font>(buf), <font color="#666666">"% 8.6f"</font>, tab-&gt;s, tab-&gt;ct));
<a name="line1347">1347: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Viewer/PetscViewerASCIIPrintf.html">PetscViewerASCIIPrintf</a>(viewer, <font color="#666666">"  Stiff abscissa       ct = %s\n"</font>, buf));
<a name="line1348">1348: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(PetscFormatRealArray(buf, <font color="#4169E1">sizeof</font>(buf), <font color="#666666">"% 8.6f"</font>, tab-&gt;s, tab-&gt;c));
<a name="line1349">1349: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Viewer/PetscViewerASCIIPrintf.html">PetscViewerASCIIPrintf</a>(viewer, <font color="#666666">"Fully implicit: %s\n"</font>, flg ? <font color="#666666">"yes"</font> : <font color="#666666">"no"</font>));
<a name="line1350">1350: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Viewer/PetscViewerASCIIPrintf.html">PetscViewerASCIIPrintf</a>(viewer, <font color="#666666">"Stiffly accurate: %s\n"</font>, tab-&gt;stiffly_accurate ? <font color="#666666">"yes"</font> : <font color="#666666">"no"</font>));
<a name="line1351">1351: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Viewer/PetscViewerASCIIPrintf.html">PetscViewerASCIIPrintf</a>(viewer, <font color="#666666">"Explicit first stage: %s\n"</font>, tab-&gt;explicit_first_stage ? <font color="#666666">"yes"</font> : <font color="#666666">"no"</font>));
<a name="line1352">1352: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Viewer/PetscViewerASCIIPrintf.html">PetscViewerASCIIPrintf</a>(viewer, <font color="#666666">"FSAL property: %s\n"</font>, tab-&gt;FSAL_implicit ? <font color="#666666">"yes"</font> : <font color="#666666">"no"</font>));
<a name="line1353">1353: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Viewer/PetscViewerASCIIPrintf.html">PetscViewerASCIIPrintf</a>(viewer, <font color="#666666">"  Nonstiff abscissa     c = %s\n"</font>, buf));
<a name="line1354">1354: </a>  }
<a name="line1355">1355: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1356">1356: </a>}

<a name="line1358">1358: </a><strong><font color="#4169E1"><a name="TSLoad_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSLoad_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a> ts, <a href="../../../../manualpages/Viewer/PetscViewer.html">PetscViewer</a> viewer)</font></strong>
<a name="line1359">1359: </a>{
<a name="line1360">1360: </a>  <a href="../../../../manualpages/SNES/SNES.html">SNES</a>    snes;
<a name="line1361">1361: </a>  <a href="../../../../manualpages/TS/TSAdapt.html">TSAdapt</a> adapt;

<a name="line1363">1363: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1364">1364: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSGetAdapt.html">TSGetAdapt</a>(ts, &amp;adapt));
<a name="line1365">1365: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSAdaptLoad.html">TSAdaptLoad</a>(adapt, viewer));
<a name="line1366">1366: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSGetSNES.html">TSGetSNES</a>(ts, &amp;snes));
<a name="line1367">1367: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/SNES/SNESLoad.html">SNESLoad</a>(snes, viewer));
<a name="line1368">1368: </a>  <font color="#B22222">/* function and Jacobian context for <a href="../../../../manualpages/SNES/SNES.html">SNES</a> when used with <a href="../../../../manualpages/TS/TS.html">TS</a> is always ts object */</font>
<a name="line1369">1369: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/SNES/SNESSetFunction.html">SNESSetFunction</a>(snes, NULL, NULL, ts));
<a name="line1370">1370: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/SNES/SNESSetJacobian.html">SNESSetJacobian</a>(snes, NULL, NULL, NULL, ts));
<a name="line1371">1371: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1372">1372: </a>}

<a name="line1374">1374: </a><font color="#B22222">/*@C</font>
<a name="line1375">1375: </a><font color="#B22222">  <a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a> - Set the type of `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>` scheme</font>

<a name="line1377">1377: </a><font color="#B22222">  Logically Collective</font>

<a name="line1379">1379: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1380">1380: </a><font color="#B22222">+  ts - timestepping context</font>
<a name="line1381">1381: </a><font color="#B22222">-  arktype - type of `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>` scheme</font>

<a name="line1383">1383: </a><font color="#B22222">  Options Database Key:</font>
<a name="line1384">1384: </a><font color="#B22222">.  -ts_arkimex_type &lt;1bee,a2,l2,ars122,2c,2d,2e,prssp2,3,bpr3,ars443,4,5&gt; - set `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>` scheme type</font>

<a name="line1386">1386: </a><font color="#B22222">  Level: intermediate</font>

<a name="line1388">1388: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TSARKIMEXGetType.html">TSARKIMEXGetType</a>()`, `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a>`, `<a href="../../../../manualpages/TS/TSARKIMEX1BEE.html">TSARKIMEX1BEE</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXA2.html">TSARKIMEXA2</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXL2.html">TSARKIMEXL2</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXARS122.html">TSARKIMEXARS122</a>`, `<a href="../../../../manualpages/TS/TSARKIMEX2C.html">TSARKIMEX2C</a>`, `<a href="../../../../manualpages/TS/TSARKIMEX2D.html">TSARKIMEX2D</a>`, `<a href="../../../../manualpages/TS/TSARKIMEX2E.html">TSARKIMEX2E</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXPRSSP2.html">TSARKIMEXPRSSP2</a>`,</font>
<a name="line1389">1389: </a><font color="#B22222">          `<a href="../../../../manualpages/TS/TSARKIMEX3.html">TSARKIMEX3</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXBPR3.html">TSARKIMEXBPR3</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXARS443.html">TSARKIMEXARS443</a>`, `<a href="../../../../manualpages/TS/TSARKIMEX4.html">TSARKIMEX4</a>`, `<a href="../../../../manualpages/TS/TSARKIMEX5.html">TSARKIMEX5</a>`</font>
<a name="line1390">1390: </a><font color="#B22222">@*/</font>
<a name="line1391">1391: </a><strong><font color="#4169E1"><a name="TSARKIMEXSetType"></a><a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a>(<a href="../../../../manualpages/TS/TS.html">TS</a> ts, <a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a> arktype)</font></strong>
<a name="line1392">1392: </a>{
<a name="line1393">1393: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1396">1396: </a>  <a href="../../../../manualpages/Sys/PetscTryMethod.html">PetscTryMethod</a>(ts, <font color="#666666">"TSARKIMEXSetType_C"</font>, (<a href="../../../../manualpages/TS/TS.html">TS</a>, <a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a>), (ts, arktype));
<a name="line1397">1397: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1398">1398: </a>}

<a name="line1400">1400: </a><font color="#B22222">/*@C</font>
<a name="line1401">1401: </a><font color="#B22222">  <a href="../../../../manualpages/TS/TSARKIMEXGetType.html">TSARKIMEXGetType</a> - Get the type of `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>` scheme</font>

<a name="line1403">1403: </a><font color="#B22222">  Logically Collective</font>

<a name="line1405">1405: </a><font color="#B22222">  Input Parameter:</font>
<a name="line1406">1406: </a><font color="#B22222">.  ts - timestepping context</font>

<a name="line1408">1408: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1409">1409: </a><font color="#B22222">.  arktype - type of `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>` scheme</font>

<a name="line1411">1411: </a><font color="#B22222">  Level: intermediate</font>

<a name="line1413">1413: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>`c, `<a href="../../../../manualpages/TS/TSARKIMEXGetType.html">TSARKIMEXGetType</a>()`</font>
<a name="line1414">1414: </a><font color="#B22222">@*/</font>
<a name="line1415">1415: </a><strong><font color="#4169E1"><a name="TSARKIMEXGetType"></a><a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../manualpages/TS/TSARKIMEXGetType.html">TSARKIMEXGetType</a>(<a href="../../../../manualpages/TS/TS.html">TS</a> ts, <a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a> *arktype)</font></strong>
<a name="line1416">1416: </a>{
<a name="line1417">1417: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1419">1419: </a>  <a href="../../../../manualpages/Sys/PetscUseMethod.html">PetscUseMethod</a>(ts, <font color="#666666">"TSARKIMEXGetType_C"</font>, (<a href="../../../../manualpages/TS/TS.html">TS</a>, <a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a> *), (ts, arktype));
<a name="line1420">1420: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1421">1421: </a>}

<a name="line1423">1423: </a><font color="#B22222">/*@</font>
<a name="line1424">1424: </a><font color="#B22222">  <a href="../../../../manualpages/TS/TSARKIMEXSetFullyImplicit.html">TSARKIMEXSetFullyImplicit</a> - Solve both parts of the equation implicitly, including the part that is normally solved explicitly</font>

<a name="line1426">1426: </a><font color="#B22222">  Logically Collective</font>

<a name="line1428">1428: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1429">1429: </a><font color="#B22222">+  ts - timestepping context</font>
<a name="line1430">1430: </a><font color="#B22222">-  flg - `<a href="../../../../manualpages/Sys/PetscBool.html">PETSC_TRUE</a>` for fully implicit</font>

<a name="line1432">1432: </a><font color="#B22222">  Level: intermediate</font>

<a name="line1434">1434: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXGetType.html">TSARKIMEXGetType</a>()`, `<a href="../../../../manualpages/TS/TSARKIMEXGetFullyImplicit.html">TSARKIMEXGetFullyImplicit</a>()`</font>
<a name="line1435">1435: </a><font color="#B22222">@*/</font>
<a name="line1436">1436: </a><strong><font color="#4169E1"><a name="TSARKIMEXSetFullyImplicit"></a><a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../manualpages/TS/TSARKIMEXSetFullyImplicit.html">TSARKIMEXSetFullyImplicit</a>(<a href="../../../../manualpages/TS/TS.html">TS</a> ts, <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a> flg)</font></strong>
<a name="line1437">1437: </a>{
<a name="line1438">1438: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1441">1441: </a>  <a href="../../../../manualpages/Sys/PetscTryMethod.html">PetscTryMethod</a>(ts, <font color="#666666">"TSARKIMEXSetFullyImplicit_C"</font>, (<a href="../../../../manualpages/TS/TS.html">TS</a>, <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a>), (ts, flg));
<a name="line1442">1442: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1443">1443: </a>}

<a name="line1445">1445: </a><font color="#B22222">/*@</font>
<a name="line1446">1446: </a><font color="#B22222">  <a href="../../../../manualpages/TS/TSARKIMEXGetFullyImplicit.html">TSARKIMEXGetFullyImplicit</a> - Inquires if both parts of the equation are solved implicitly</font>

<a name="line1448">1448: </a><font color="#B22222">  Logically Collective</font>

<a name="line1450">1450: </a><font color="#B22222">  Input Parameter:</font>
<a name="line1451">1451: </a><font color="#B22222">.  ts - timestepping context</font>

<a name="line1453">1453: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1454">1454: </a><font color="#B22222">.  flg - `<a href="../../../../manualpages/Sys/PetscBool.html">PETSC_TRUE</a>` for fully implicit</font>

<a name="line1456">1456: </a><font color="#B22222">  Level: intermediate</font>

<a name="line1458">1458: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TSARKIMEXGetType.html">TSARKIMEXGetType</a>()`, `<a href="../../../../manualpages/TS/TSARKIMEXSetFullyImplicit.html">TSARKIMEXSetFullyImplicit</a>()`</font>
<a name="line1459">1459: </a><font color="#B22222">@*/</font>
<a name="line1460">1460: </a><strong><font color="#4169E1"><a name="TSARKIMEXGetFullyImplicit"></a><a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../manualpages/TS/TSARKIMEXGetFullyImplicit.html">TSARKIMEXGetFullyImplicit</a>(<a href="../../../../manualpages/TS/TS.html">TS</a> ts, <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a> *flg)</font></strong>
<a name="line1461">1461: </a>{
<a name="line1462">1462: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1465">1465: </a>  <a href="../../../../manualpages/Sys/PetscUseMethod.html">PetscUseMethod</a>(ts, <font color="#666666">"TSARKIMEXGetFullyImplicit_C"</font>, (<a href="../../../../manualpages/TS/TS.html">TS</a>, <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a> *), (ts, flg));
<a name="line1466">1466: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1467">1467: </a>}

<a name="line1469">1469: </a><strong><font color="#4169E1"><a name="TSARKIMEXGetType_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSARKIMEXGetType_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a> ts, <a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a> *arktype)</font></strong>
<a name="line1470">1470: </a>{
<a name="line1471">1471: </a>  TS_ARKIMEX *ark = (TS_ARKIMEX *)ts-&gt;data;

<a name="line1473">1473: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1474">1474: </a>  *arktype = ark-&gt;tableau-&gt;name;
<a name="line1475">1475: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1476">1476: </a>}
<a name="line1477">1477: </a><strong><font color="#4169E1"><a name="TSARKIMEXSetType_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSARKIMEXSetType_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a> ts, <a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a> arktype)</font></strong>
<a name="line1478">1478: </a>{
<a name="line1479">1479: </a>  TS_ARKIMEX    *ark = (TS_ARKIMEX *)ts-&gt;data;
<a name="line1480">1480: </a>  <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a>      match;
<a name="line1481">1481: </a>  ARKTableauLink link;

<a name="line1483">1483: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1484">1484: </a>  <font color="#4169E1">if</font> (ark-&gt;tableau) {
<a name="line1485">1485: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscStrcmp.html">PetscStrcmp</a>(ark-&gt;tableau-&gt;name, arktype, &amp;match));
<a name="line1486">1486: </a>    <font color="#4169E1">if</font> (match) <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1487">1487: </a>  }
<a name="line1488">1488: </a>  <font color="#4169E1">for</font> (link = ARKTableauList; link; link = link-&gt;next) {
<a name="line1489">1489: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscStrcmp.html">PetscStrcmp</a>(link-&gt;tab.name, arktype, &amp;match));
<a name="line1490">1490: </a>    <font color="#4169E1">if</font> (match) {
<a name="line1491">1491: </a>      <font color="#4169E1">if</font> (ts-&gt;setupcalled) <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSARKIMEXTableauReset(ts));
<a name="line1492">1492: </a>      ark-&gt;tableau = &amp;link-&gt;tab;
<a name="line1493">1493: </a>      <font color="#4169E1">if</font> (ts-&gt;setupcalled) <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSARKIMEXTableauSetUp(ts));
<a name="line1494">1494: </a>      ts-&gt;default_adapt_type = ark-&gt;tableau-&gt;bembed ? <a href="../../../../manualpages/TS/TSADAPTBASIC.html">TSADAPTBASIC</a> : <a href="../../../../manualpages/TS/TSADAPTNONE.html">TSADAPTNONE</a>;
<a name="line1495">1495: </a>      <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1496">1496: </a>    }
<a name="line1497">1497: </a>  }
<a name="line1498">1498: </a>  <a href="../../../../manualpages/Sys/SETERRQ.html">SETERRQ</a>(<a href="../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts), <a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_UNKNOWN_TYPE</a>, <font color="#666666">"Could not find '%s'"</font>, arktype);
<a name="line1499">1499: </a>}

<a name="line1501">1501: </a><strong><font color="#4169E1"><a name="TSARKIMEXSetFullyImplicit_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSARKIMEXSetFullyImplicit_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a> ts, <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a> flg)</font></strong>
<a name="line1502">1502: </a>{
<a name="line1503">1503: </a>  TS_ARKIMEX *ark = (TS_ARKIMEX *)ts-&gt;data;

<a name="line1505">1505: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1506">1506: </a>  ark-&gt;imex = (<a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a>)!flg;
<a name="line1507">1507: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1508">1508: </a>}

<a name="line1510">1510: </a><strong><font color="#4169E1"><a name="TSARKIMEXGetFullyImplicit_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSARKIMEXGetFullyImplicit_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a> ts, <a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a> *flg)</font></strong>
<a name="line1511">1511: </a>{
<a name="line1512">1512: </a>  TS_ARKIMEX *ark = (TS_ARKIMEX *)ts-&gt;data;

<a name="line1514">1514: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1515">1515: </a>  *flg = (<a href="../../../../manualpages/Sys/PetscBool.html">PetscBool</a>)!ark-&gt;imex;
<a name="line1516">1516: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1517">1517: </a>}

<a name="line1519">1519: </a><strong><font color="#4169E1"><a name="TSDestroy_ARKIMEX"></a>static <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSDestroy_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a> ts)</font></strong>
<a name="line1520">1520: </a>{
<a name="line1521">1521: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1522">1522: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(TSReset_ARKIMEX(ts));
<a name="line1523">1523: </a>  <font color="#4169E1">if</font> (ts-&gt;dm) {
<a name="line1524">1524: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/DM/DMCoarsenHookRemove.html">DMCoarsenHookRemove</a>(ts-&gt;dm, DMCoarsenHook_TSARKIMEX, DMRestrictHook_TSARKIMEX, ts));
<a name="line1525">1525: </a>    <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/DM/DMSubDomainHookRemove.html">DMSubDomainHookRemove</a>(ts-&gt;dm, DMSubDomainHook_TSARKIMEX, DMSubDomainRestrictHook_TSARKIMEX, ts));
<a name="line1526">1526: </a>  }
<a name="line1527">1527: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscFree.html">PetscFree</a>(ts-&gt;data));
<a name="line1528">1528: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts, <font color="#666666">"TSARKIMEXGetType_C"</font>, NULL));
<a name="line1529">1529: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts, <font color="#666666">"TSARKIMEXSetType_C"</font>, NULL));
<a name="line1530">1530: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts, <font color="#666666">"TSARKIMEXSetFullyImplicit_C"</font>, NULL));
<a name="line1531">1531: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts, <font color="#666666">"TSARKIMEXGetFullyImplicit_C"</font>, NULL));
<a name="line1532">1532: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1533">1533: </a>}

<a name="line1535">1535: </a><font color="#B22222">/* ------------------------------------------------------------ */</font>
<a name="line1536">1536: </a><font color="#B22222">/*MC</font>
<a name="line1537">1537: </a><font color="#B22222">      <a href="../../../../manualpages/TS/TSARKIMEX.html">TSARKIMEX</a> - ODE and DAE solver using additive Runge-Kutta IMEX schemes</font>

<a name="line1539">1539: </a><font color="#B22222">  These methods are intended for problems with well-separated time scales, especially when a slow scale is strongly</font>
<a name="line1540">1540: </a><font color="#B22222">  nonlinear such that it is expensive to solve with a fully implicit method. The user should provide the stiff part</font>
<a name="line1541">1541: </a><font color="#B22222">  of the equation using `<a href="../../../../manualpages/TS/TSSetIFunction.html">TSSetIFunction</a>()` and the non-stiff part with `<a href="../../../../manualpages/TS/TSSetRHSFunction.html">TSSetRHSFunction</a>()`.</font>

<a name="line1543">1543: </a><font color="#B22222">  Level: beginner</font>

<a name="line1545">1545: </a><font color="#B22222">  Notes:</font>
<a name="line1546">1546: </a><font color="#B22222">  The default is `<a href="../../../../manualpages/TS/TSARKIMEX3.html">TSARKIMEX3</a>`, it can be changed with `<a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a>()` or -ts_arkimex_type</font>

<a name="line1548">1548: </a><font color="#B22222">  If the equation is implicit or a DAE, then `<a href="../../../../manualpages/TS/TSSetEquationType.html">TSSetEquationType</a>()` needs to be set accordingly. Refer to the manual for further information.</font>

<a name="line1550">1550: </a><font color="#B22222">  Methods with an explicit stage can only be used with ODE in which the stiff part G(t,X,Xdot) has the form Xdot + Ghat(t,X).</font>

<a name="line1552">1552: </a><font color="#B22222">  Consider trying `<a href="../../../../manualpages/TS/TSROSW.html">TSROSW</a>` if the stiff part is linear or weakly nonlinear.</font>

<a name="line1554">1554: </a><font color="#B22222">.seealso: [](chapter_ts), `<a href="../../../../manualpages/TS/TSCreate.html">TSCreate</a>()`, `<a href="../../../../manualpages/TS/TS.html">TS</a>`, `<a href="../../../../manualpages/TS/TSSetType.html">TSSetType</a>()`, `<a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a>()`, `<a href="../../../../manualpages/TS/TSARKIMEXGetType.html">TSARKIMEXGetType</a>()`, `<a href="../../../../manualpages/TS/TSARKIMEXSetFullyImplicit.html">TSARKIMEXSetFullyImplicit</a>()`, `<a href="../../../../manualpages/TS/TSARKIMEXGetFullyImplicit.html">TSARKIMEXGetFullyImplicit</a>()`,</font>
<a name="line1555">1555: </a><font color="#B22222">          `<a href="../../../../manualpages/TS/TSARKIMEX1BEE.html">TSARKIMEX1BEE</a>`, `<a href="../../../../manualpages/TS/TSARKIMEX2C.html">TSARKIMEX2C</a>`, `<a href="../../../../manualpages/TS/TSARKIMEX2D.html">TSARKIMEX2D</a>`, `<a href="../../../../manualpages/TS/TSARKIMEX2E.html">TSARKIMEX2E</a>`, `<a href="../../../../manualpages/TS/TSARKIMEX3.html">TSARKIMEX3</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXL2.html">TSARKIMEXL2</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXA2.html">TSARKIMEXA2</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXARS122.html">TSARKIMEXARS122</a>`,</font>
<a name="line1556">1556: </a><font color="#B22222">          `<a href="../../../../manualpages/TS/TSARKIMEX4.html">TSARKIMEX4</a>`, `<a href="../../../../manualpages/TS/TSARKIMEX5.html">TSARKIMEX5</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXPRSSP2.html">TSARKIMEXPRSSP2</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXARS443.html">TSARKIMEXARS443</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXBPR3.html">TSARKIMEXBPR3</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXType.html">TSARKIMEXType</a>`, `<a href="../../../../manualpages/TS/TSARKIMEXRegister.html">TSARKIMEXRegister</a>()`, `<a href="../../../../manualpages/TS/TSType.html">TSType</a>`</font>
<a name="line1557">1557: </a><font color="#B22222">M*/</font>
<a name="line1558">1558: </a><strong><font color="#4169E1"><a name="TSCreate_ARKIMEX"></a>PETSC_EXTERN <a href="../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> TSCreate_ARKIMEX(<a href="../../../../manualpages/TS/TS.html">TS</a> ts)</font></strong>
<a name="line1559">1559: </a>{
<a name="line1560">1560: </a>  TS_ARKIMEX *ark;

<a name="line1562">1562: </a>  <a href="../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1563">1563: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXInitializePackage.html">TSARKIMEXInitializePackage</a>());

<a name="line1565">1565: </a>  ts-&gt;ops-&gt;reset          = TSReset_ARKIMEX;
<a name="line1566">1566: </a>  ts-&gt;ops-&gt;adjointreset   = TSAdjointReset_ARKIMEX;
<a name="line1567">1567: </a>  ts-&gt;ops-&gt;destroy        = TSDestroy_ARKIMEX;
<a name="line1568">1568: </a>  ts-&gt;ops-&gt;view           = TSView_ARKIMEX;
<a name="line1569">1569: </a>  ts-&gt;ops-&gt;load           = TSLoad_ARKIMEX;
<a name="line1570">1570: </a>  ts-&gt;ops-&gt;setup          = TSSetUp_ARKIMEX;
<a name="line1571">1571: </a>  ts-&gt;ops-&gt;adjointsetup   = TSAdjointSetUp_ARKIMEX;
<a name="line1572">1572: </a>  ts-&gt;ops-&gt;step           = TSStep_ARKIMEX;
<a name="line1573">1573: </a>  ts-&gt;ops-&gt;interpolate    = TSInterpolate_ARKIMEX;
<a name="line1574">1574: </a>  ts-&gt;ops-&gt;evaluatestep   = TSEvaluateStep_ARKIMEX;
<a name="line1575">1575: </a>  ts-&gt;ops-&gt;rollback       = TSRollBack_ARKIMEX;
<a name="line1576">1576: </a>  ts-&gt;ops-&gt;setfromoptions = TSSetFromOptions_ARKIMEX;
<a name="line1577">1577: </a>  ts-&gt;ops-&gt;snesfunction   = SNESTSFormFunction_ARKIMEX;
<a name="line1578">1578: </a>  ts-&gt;ops-&gt;snesjacobian   = SNESTSFormJacobian_ARKIMEX;
<a name="line1579">1579: </a>  ts-&gt;ops-&gt;getstages      = TSGetStages_ARKIMEX;
<a name="line1580">1580: </a>  ts-&gt;ops-&gt;adjointstep    = TSAdjointStep_ARKIMEX;

<a name="line1582">1582: </a>  ts-&gt;usessnes = <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_TRUE</a>;

<a name="line1584">1584: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscNew.html">PetscNew</a>(&amp;ark));
<a name="line1585">1585: </a>  ts-&gt;data  = (void *)ark;
<a name="line1586">1586: </a>  ark-&gt;imex = <a href="../../../../manualpages/Sys/PetscBool.html">PETSC_TRUE</a>;

<a name="line1588">1588: </a>  ark-&gt;VecsDeltaLam   = NULL;
<a name="line1589">1589: </a>  ark-&gt;VecsSensiTemp  = NULL;
<a name="line1590">1590: </a>  ark-&gt;VecsSensiPTemp = NULL;

<a name="line1592">1592: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts, <font color="#666666">"TSARKIMEXGetType_C"</font>, TSARKIMEXGetType_ARKIMEX));
<a name="line1593">1593: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts, <font color="#666666">"TSARKIMEXSetType_C"</font>, TSARKIMEXSetType_ARKIMEX));
<a name="line1594">1594: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts, <font color="#666666">"TSARKIMEXSetFullyImplicit_C"</font>, TSARKIMEXSetFullyImplicit_ARKIMEX));
<a name="line1595">1595: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)ts, <font color="#666666">"TSARKIMEXGetFullyImplicit_C"</font>, TSARKIMEXGetFullyImplicit_ARKIMEX));

<a name="line1597">1597: </a>  <a href="../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../manualpages/TS/TSARKIMEXSetType.html">TSARKIMEXSetType</a>(ts, TSARKIMEXDefault));
<a name="line1598">1598: </a>  <a href="../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1599">1599: </a>}
</pre>
</body>

</html>
