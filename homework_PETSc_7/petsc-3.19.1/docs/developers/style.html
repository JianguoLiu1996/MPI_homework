
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>PETSc Style and Usage Guide &#8212; PETSc 3.19.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/katex-math.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script src="../_static/katex.min.js"></script>
    <script src="../_static/auto-render.min.js"></script>
    <script src="../_static/katex_autorenderer.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'developers/style';</script>
    <link rel="shortcut icon" href="../_static/petsc_favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Getting your code and documentation into PETSc" href="integration.html" />
    <link rel="prev" title="Contributing to PETSc" href="contributing.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
    <img src="../_static/PETSc-TAO_RGB.svg" class="logo__image only-light" alt="Logo image">
    <img src="../_static/PETSc-TAO_RGB_white.svg" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../overview/index.html">
                        Overview
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../install/index.html">
                        Install
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../tutorials/index.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../manual/index.html">
                        User-Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../manualpages/index.html">
                        C/Fortran API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../petsc4py/petsc4py.html">
                        Python API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../faq/index.html">
                        FAQ
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../community/index.html">
                        Community
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        Developers
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../miscellaneous/index.html">
                        Misc.
                      </a>
                    </li>
                
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://gitlab.com/petsc/petsc" title="GitLab" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fab fa-gitlab"></i></span>
            <label class="sr-only">GitLab</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../overview/index.html">
                        Overview
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../install/index.html">
                        Install
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../tutorials/index.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../manual/index.html">
                        User-Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../manualpages/index.html">
                        C/Fortran API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../petsc4py/petsc4py.html">
                        Python API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../faq/index.html">
                        FAQ
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../community/index.html">
                        Community
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        Developers
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../miscellaneous/index.html">
                        Misc.
                      </a>
                    </li>
                
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://gitlab.com/petsc/petsc" title="GitLab" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fab fa-gitlab"></i></span>
            <label class="sr-only">GitLab</label></a>
        </li>
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Section navigation">
  <p class="bd-links__title" role="heading" aria-level="1">
    Section Navigation
  </p>
  <div class="bd-toc-item navbar-nav">
    <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="communication.html">Communication Channels for PETSc Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to PETSc</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">PETSc Style and Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="integration.html">Getting your code and documentation into PETSc</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipelines.html">GitLab CI Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="buildsystem.html">BuildSystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">PETSc Testing System</a></li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">Developing PETSc Documentation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="design.html">The Design of PETSc</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="kernel.html">The PETSc Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="objects.html">Basic Object Design and Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="callbacks.html">How the Solvers Handle User Provided Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="matrices.html">The Various Matrix Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="articles.html">Articles about PETSc Design</a></li>
</ul>
</li>
</ul>

  </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <section id="petsc-style-and-usage-guide">
<h1>PETSc Style and Usage Guide<a class="headerlink" href="#petsc-style-and-usage-guide" title="Permalink to this heading">#</a></h1>
<p>The PETSc team uses certain conventions to make the source code
consistent and hence easier to maintain. We will interchangeably use the
terminology <em>subclass</em>, <em>implementation</em>, or <em>type</em> <a class="footnote-reference brackets" href="#id6" id="id1">1</a> to refer to a
concrete realization of an abstract base class. For example,
<code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPGMRES.html">KSPGMRES</a></span></code> is a type for the base class <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSP.html">KSP</a></span></code>.</p>
<section id="names">
<h2>Names<a class="headerlink" href="#names" title="Permalink to this heading">#</a></h2>
<p>Consistency of names for variables, functions, and so on is extremely
important. We use several conventions</p>
<ol class="arabic">
<li><p>All function names and enum types consist of acronyms or words, each
of which is capitalized, for example, <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPSolve.html">KSPSolve</a>()</span></code> and
<code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/MatOrderings/MatGetOrdering.html">MatGetOrdering</a>()</span></code>.</p></li>
<li><p>All enum elements and macro variables are named with all capital
letters. When they consist of several complete words, there is an
underscore between each word. For example, <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/MatAssemblyType.html">MAT_FINAL_ASSEMBLY</a></span></code>.</p></li>
<li><p>Functions that are private to PETSc (not callable by the application
code) either</p>
<ul class="simple">
<li><p>have an appended <code class="docutils literal notranslate"><span class="pre">_Private</span></code> (for example, <code class="docutils literal notranslate"><span class="pre">StashValues_Private</span></code>)
or</p></li>
<li><p>have an appended <code class="docutils literal notranslate"><span class="pre">_Subtype</span></code> (for example, <code class="docutils literal notranslate"><span class="pre">MatMultSeq_AIJ</span></code>).</p></li>
</ul>
<p>In addition, functions that are not intended for use outside of a
particular file are declared <code class="docutils literal notranslate"><span class="pre">static</span></code>. Also see item
on symbol visibility in <a class="reference internal" href="#usage-of-petsc-functions-and-macros"><span class="std std-ref">Usage of PETSc Functions and Macros</span></a>.</p>
</li>
<li><p>Function names in structures (for example, <code class="docutils literal notranslate"><span class="pre">_matops</span></code>) are the same
as the base application function name without the object prefix and
are in small letters. For example, <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/MatMultTranspose.html">MatMultTranspose</a>()</span></code> has a
structure name of <code class="docutils literal notranslate"><span class="pre">multtranspose</span></code>.</p></li>
<li><p>Names of implementations of class functions should begin with the
function name, an underscore, and the name of the implementation, for
example, <code class="docutils literal notranslate"><span class="pre">KSPSolve_GMRES()</span></code>.</p></li>
<li><p>Each application-usable function begins with the name of the class
object, followed by any subclass name, for example,
<code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/IS/ISInvertPermutation.html">ISInvertPermutation</a>()</span></code>, <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/MatMult.html">MatMult</a>()</span></code>, or
<code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPGMRESSetRestart.html">KSPGMRESSetRestart</a>()</span></code>.</p></li>
<li><p>Functions that PETSc provides as defaults for user-providable
functions end with <code class="docutils literal notranslate"><span class="pre">Default</span></code> (for example, <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscSignalHandlerDefault.html">PetscSignalHandlerDefault</a>()</span></code>).</p></li>
<li><p>Options database keys are lower case, have an underscore between
words, and match the function name associated with the option without
the word “set” or “get”, for example, <code class="docutils literal notranslate"><span class="pre">-ksp_gmres_restart</span></code>.</p></li>
<li><p>Specific <code class="docutils literal notranslate"><span class="pre">XXXType</span></code> values (for example, <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/MATSEQAIJ.html">MATSEQAIJ</a></span></code>) do not have
an underscore in them unless they refer to another package that uses
an underscore, for example, <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/MATSOLVERSUPERLU_DIST.html">MATSOLVERSUPERLU_DIST</a></span></code>.</p></li>
</ol>
</section>
<section id="coding-conventions-and-style">
<h2>Coding Conventions and Style<a class="headerlink" href="#coding-conventions-and-style" title="Permalink to this heading">#</a></h2>
<p>Within the PETSc source code, we adhere to the following guidelines so
that the code is uniform and easily maintained.</p>
<section id="c-formatting">
<h3>C Formatting<a class="headerlink" href="#c-formatting" title="Permalink to this heading">#</a></h3>
<p>The white space and basic layout is controlled by the <code class="docutils literal notranslate"><span class="pre">.clang-format</span></code> file in the root directory. You can run the formatter in a single directory or in the entire repository with <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clangformat</span></code>. All merge requests must be properly formatted; this is automatically checked for merge requests with <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">checkclangformat</span></code>.</p>
<p>Even with the use of <code class="docutils literal notranslate"><span class="pre">clang-format</span></code> there are still many decisions about code formatting that must be constantly made. A subset of these are automatically checked for merge requests with <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">checkbadSource</span></code>.</p>
<ol class="arabic">
<li><p>The prototypes for functions should not include the names of the
variables</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PETSC_EXTERN</span><span class="w"> </span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a></span><span class="w"> </span><span class="n">MyFunction</span><span class="p">(</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInt.html">PetscInt</a></span><span class="p">);</span><span class="w"> </span><span class="c1">// Correct</span>
<span class="n">PETSC_EXTERN</span><span class="w"> </span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a></span><span class="w"> </span><span class="n">MyFunction</span><span class="p">(</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInt.html">PetscInt</a></span><span class="w"> </span><span class="n">myvalue</span><span class="p">);</span><span class="w"> </span><span class="c1">// Incorrect</span>
</pre></div>
</div>
</li>
<li><p>All local variables of a particular type (for example, <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInt.html">PetscInt</a></span></code>) should be listed
on the same line if possible; otherwise, they should be listed on adjacent lines. Note
that pointers of different arity are considered to be different types. <code class="docutils literal notranslate"><span class="pre">clang-format</span></code> automatically
handles the indenting shown below.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Correct</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInt.html">PetscInt</a></span><span class="w">   </span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">;</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInt.html">PetscInt</a></span><span class="w">  </span><span class="o">*</span><span class="n">d</span><span class="p">,</span><span class="o">*</span><span class="n">e</span><span class="p">;</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInt.html">PetscInt</a></span><span class="w"> </span><span class="o">**</span><span class="n">f</span><span class="p">;</span>

<span class="c1">// Incorrect</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInt.html">PetscInt</a></span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="o">*</span><span class="n">d</span><span class="p">,</span><span class="o">*</span><span class="n">e</span><span class="p">,</span><span class="o">**</span><span class="n">f</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>Local variables should be initialized when declared when possible</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Correct</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInt.html">PetscInt</a></span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">;</span>

<span class="c1">// Incorrect</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInt.html">PetscInt</a></span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">;</span>

<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a></span><span class="p">;</span>
<span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>All PETSc subroutine code blocks <em>must</em> start with a single blank line between the local variable
declarations followed by <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a></span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Correct</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInt.html">PetscInt</a></span><span class="w"> </span><span class="n">x</span><span class="p">;</span>

<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a></span><span class="p">;</span>

<span class="c1">// Incorrect</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInt.html">PetscInt</a></span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a></span><span class="p">;</span>

<span class="c1">// Incorrect</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInt.html">PetscInt</a></span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>Functions in PETSc examples including <code class="docutils literal notranslate"><span class="pre">main()</span></code> should have  <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFunctionBeginUser.html">PetscFunctionBeginUser</a></span></code> as the very first line after the local variable declarations.</p></li>
<li><p>PETSc functions should almost always return with <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>)</span></code> not <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">0</span></code>. <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>()</span></code> should never return a non-zero integer value.
It may, on occasion, return <code class="docutils literal notranslate"><span class="pre">MPI_SUCCESS</span></code>, NULL, or a <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscObject.html">PetscObject</a></span></code> such as a <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Viewer/PetscViewer.html">PetscViewer</a></span></code> depending on the return type of the function.</p></li>
<li><p>Functions that do use return should use <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">xx;</span></code> rather than <code class="docutils literal notranslate"><span class="pre">return(xx);</span></code></p></li>
<li><p>All PETSc functions must have their return value checked for errors using the
<code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscCall.html">PetscCall</a>()</span></code> macro. This should be wrapped around the function in question.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscCall.html">PetscCall</a></span><span class="p">(</span><span class="n">MyFunction</span><span class="p">(...));</span><span class="w"> </span><span class="c1">// Correct</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a></span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyFunction</span><span class="p">(...);</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscCall.html">PetscCall</a></span><span class="p">(</span><span class="n">ierr</span><span class="p">);</span><span class="w"> </span><span class="c1">// Incorrect</span>
</pre></div>
</div>
<p>The only exceptions to this rule are begin-end style macros which embed local variables
or loops as part of their expansion
(e.g. <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscOptionsBegin.html">PetscOptionsBegin</a>()</span></code>/<code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscOptionsEnd.html">PetscOptionsEnd</a>()</span></code>).  These handle errors internally
and do not need error checking.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Correct</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscOptionsBegin.html">PetscOptionsBegin</a></span><span class="p">(...);</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscOptionsEnd.html">PetscOptionsEnd</a></span><span class="p">();</span>
</pre></div>
</div>
<p>As a rule, always try to wrap the function first, if this fails to compile you do
not need to add the error checking.</p>
<p>Calls to external package functions are generally made with <code class="docutils literal notranslate"><span class="pre">PetscCallExternal()</span></code> or its variants that are specialized for particular packages, for example <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscCallBLAS.html">PetscCallBLAS</a>()</span></code></p>
</li>
<li><p>Single operation <code class="docutils literal notranslate"><span class="pre">if</span></code> and <code class="docutils literal notranslate"><span class="pre">else</span></code> commands should not be wrapped in braces. They should be done as follows,</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">XXXX</span><span class="p">;</span>
<span class="k">else</span><span class="w"> </span><span class="n">YYY</span><span class="p">;</span>
</pre></div>
</div>
<p>not</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">XXXX</span><span class="p">;}</span>
<span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="n">YYY</span><span class="p">;}</span>
</pre></div>
</div>
</li>
<li><p>Do not leave sections of commented-out code or dead source code protected with <code class="docutils literal notranslate"><span class="pre">ifdef</span> <span class="pre">foo</span></code> in the source files.</p></li>
<li><p>Use classic block comments (<code class="docutils literal notranslate"><span class="pre">/*</span> <span class="pre">There</span> <span class="pre">must</span> <span class="pre">be</span> <span class="pre">a</span> <span class="pre">space</span> <span class="pre">before</span> <span class="pre">the</span> <span class="pre">first</span> <span class="pre">word</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">comment</span> <span class="pre">and</span> <span class="pre">a</span> <span class="pre">space</span> <span class="pre">at</span> <span class="pre">the</span> <span class="pre">end</span> <span class="pre">*/</span></code>,
(<code class="docutils literal notranslate"><span class="pre">/*Do</span> <span class="pre">not</span> <span class="pre">do</span> <span class="pre">this*/</span></code>) for multi-line comments, and <code class="docutils literal notranslate"><span class="pre">//</span> <span class="pre">Comment</span></code> for single-line comments in source files.</p></li>
<li><p>Do not put a <code class="docutils literal notranslate"><span class="pre">*</span></code> at the beginning or end of each line of a multi-line comment.</p></li>
<li><p>Do not use <code class="docutils literal notranslate"><span class="pre">/*</span> <span class="pre">----</span> <span class="pre">...</span> <span class="pre">-----</span> <span class="pre">*/</span></code> or similar constructs to separate parts of source code files.</p></li>
<li><p>Use appropriate grammar and spelling in the comments.</p></li>
<li><p>All variables must be declared at the beginning of the code block (C89
style), never mixed in with code. When variables are only used in a limited
scope, it is encouraged to declare them in that scope. For example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cond</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscScalar.html">PetscScalar</a></span><span class="w"> </span><span class="o">*</span><span class="n">tmp</span><span class="p">;</span>

<span class="w">  </span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscCall.html">PetscCall</a></span><span class="p">(</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscMalloc1.html">PetscMalloc1</a></span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="o">&amp;</span><span class="n">tmp</span><span class="p">));</span>
<span class="w">  </span><span class="c1">// use tmp</span>
<span class="w">  </span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscCall.html">PetscCall</a></span><span class="p">(</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFree.html">PetscFree</a></span><span class="p">(</span><span class="n">tmp</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The only exception to this variables used exclusively within a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop, which must
be declared inside the loop initializer:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Correct</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInt.html">PetscInt</a></span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// loop body</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Correct, variable used outside of loop</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInt.html">PetscInt</a></span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// loop body</span>
<span class="p">}</span>
<span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Incorrect</span>
<span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInt.html">PetscInt</a></span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="p">...</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// loop body</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Developers are allowed to use // to split very long lines when it improves code readability. For example</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">omega</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xdot</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">omega</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">uxx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">uyy</span><span class="w"> </span><span class="c1">//</span>
<span class="w">              </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">vxp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">].</span><span class="n">omega</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">vxm</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">].</span><span class="n">omega</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">hy</span><span class="w"> </span><span class="c1">//</span>
<span class="w">              </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">vyp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">omega</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">vym</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">omega</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">hx</span><span class="w"> </span><span class="c1">//</span>
<span class="w">              </span><span class="o">-</span><span class="w"> </span><span class="mf">.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">grashof</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">].</span><span class="n">temp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">].</span><span class="n">temp</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">hy</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>The use of clang-format off is allowed in the source code but should only be used when absolutely necessary. It should not
be used when trailing // to split lines works.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// clang-format off</span>
<span class="n">f</span><span class="w"> </span><span class="p">...</span>
<span class="c1">// clang-format on</span>
</pre></div>
</div>
</li>
<li><p><cite>size</cite> and <cite>rank</cite> should be used exclusively for the results of <cite>MPI_Comm_size()</cite> and <cite>MPI_Comm_rank()</cite> and other variable names for these values should be avoided unless necessary.</p></li>
</ol>
</section>
<section id="c-usage">
<h3>C Usage<a class="headerlink" href="#c-usage" title="Permalink to this heading">#</a></h3>
<ol class="arabic">
<li><p>Do not use language features that are not in the intersection of C99, C++11, and MSVC
v1900+ (Visual Studio 2015).  Examples of such features include variable-length arrays.
Note that variable-length arrays (including VLA-pointers) are not supported in C++ and
were made optional in C11. You may use designated initializers via the
<code class="docutils literal notranslate"><span class="pre">PetscDesignatedInitializer()</span></code> macro.</p></li>
<li><p>Array and pointer arguments where the array values are not changed
should be labeled as <code class="docutils literal notranslate"><span class="pre">const</span></code> arguments.</p></li>
<li><p>Scalar values passed to functions should <em>never</em> be labeled as
<code class="docutils literal notranslate"><span class="pre">const</span></code>.</p></li>
<li><p>Subroutines that would normally have a <code class="docutils literal notranslate"><span class="pre">void**</span></code> argument to return
a pointer to some data should be prototyped as <code class="docutils literal notranslate"><span class="pre">void*</span></code>.
This prevents the caller from having to put a <code class="docutils literal notranslate"><span class="pre">(void**)</span></code> cast in
each function call. See, for example, <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/DMDA/DMDAVecGetArray.html">DMDAVecGetArray</a>()</span></code>.</p></li>
<li><p>Do not use the <code class="docutils literal notranslate"><span class="pre">register</span></code> directive.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(v</span> <span class="pre">==</span> <span class="pre">NULL)</span></code> or  <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(flg</span> <span class="pre">==</span> <span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscBool.html">PETSC_TRUE</a>)</span></code>, instead of using <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(!v)</span></code> or <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(flg)</span></code> or <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(!flg)</span></code>.</p></li>
<li><p>Avoid <code class="docutils literal notranslate"><span class="pre">#ifdef</span></code> or <code class="docutils literal notranslate"><span class="pre">#ifndef</span></code> when possible. Rather, use <code class="docutils literal notranslate"><span class="pre">#if</span> <span class="pre">defined(...</span></code> or <code class="docutils literal notranslate"><span class="pre">#if</span>
<span class="pre">!defined(...</span></code>.  Better, use <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscDefined.html">PetscDefined</a>()</span></code> (see below). The only exception to this
rule is for header guards, where the <code class="docutils literal notranslate"><span class="pre">#ifndef</span></code> form is preferred (see below).</p></li>
<li><p>Header guard macros should include the full name and end in <code class="docutils literal notranslate"><span class="pre">_FILE_EXTENSION</span></code> of the
file and be formed using <code class="docutils literal notranslate"><span class="pre">#ifndef</span></code>. For example:</p>
<blockquote>
<div><p>// my_petsc_header_file.h
#ifndef MY_PETSC_HEADER_FILE_H
#define MY_PETSC_HEADER_FILE_H</p>
<p>#endif // MY_PETSC_HEADER_FILE_H</p>
</div></blockquote>
</li>
<li><p>Never use system random number generators such as <code class="docutils literal notranslate"><span class="pre">rand()</span></code> in PETSc
code or examples because these can produce different results on
different systems thus making portability testing difficult. Instead
use <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscRandom.html">PetscRandom</a></span></code> which produces the exact same results regardless
of system it is used on.</p></li>
<li><p>Never use system math functions or string functions in PETSc source code or examples, instead use the PETSc versions.</p></li>
<li><p>Variadic macros may be used in PETSc, but must work with MSVC v1900+ (Visual Studio
2015). Most compilers have conforming implementations of the C99/C++11 rules for
<code class="docutils literal notranslate"><span class="pre">__VA_ARGS__</span></code>, but MSVC’s implementation is not conforming and may need workarounds.
See <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscDefined.html">PetscDefined</a>()</span></code> for an example of how to work around MSVC’s limitations to write
a macro that is usable in both.</p></li>
</ol>
</section>
<section id="usage-of-petsc-functions-and-macros">
<span id="id2"></span><h3>Usage of PETSc Functions and Macros<a class="headerlink" href="#usage-of-petsc-functions-and-macros" title="Permalink to this heading">#</a></h3>
<ol class="arabic">
<li><p>Lengthy conditional preprocessor blocks should mark any <code class="docutils literal notranslate"><span class="pre">#else</span></code> or <code class="docutils literal notranslate"><span class="pre">#endif</span></code>
directives with a comment containing (or explaining) either the boolean condition or
the name of the macro if the first directive is testing whether one is defined. One
should be able to read any part of the macro block and be able to find or deduce the
initial <code class="docutils literal notranslate"><span class="pre">#if</span></code>. That is:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(MY_MACRO)</span>
<span class="c1">// many lines of code</span>
<span class="cp">#else </span><span class="c1">// MY_MACRO (use name of macro)</span>
<span class="c1">// many more lines of code</span>
<span class="cp">#endif </span><span class="c1">// MY_MACRO</span>

<span class="cp">#if MY_MACRO &gt; 10</span>
<span class="c1">// code</span>
<span class="cp">#else </span><span class="c1">// MY_MACRO &lt; 10</span>
<span class="c1">// more code</span>
<span class="cp">#endif </span><span class="c1">// MY_MACRO &gt; 10</span>
</pre></div>
</div>
</li>
<li><p>Nested preprocessor blocks should be indent the text (<em>not</em> the <code class="docutils literal notranslate"><span class="pre">#</span></code>) following the
normal indentation rules outlined above. For example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Right</span>
<span class="cp">#if MY_VARIABLE &gt; 10</span>
<span class="cp">#  if MY_OTHER_VARIABLE &gt; 15</span>
<span class="cp">#    define BIG_VARIABLE 1</span>


<span class="c1">// Wrong</span>
<span class="cp">#if MY_VARIABLE &gt; 10</span>
<span class="w">  </span><span class="cp">#if MY_OTHER_VARIABLE &gt; 15</span>
<span class="w">    </span><span class="cp">#define BIG_VARIABLE 1</span>

<span class="c1">// Wrong</span>
<span class="cp">#if MY_VARIABLE &gt; 10</span>
<span class="cp">#if MY_OTHER_VARIABLE &gt; 15</span>
<span class="cp">#define BIG_VARIABLE 1</span>
</pre></div>
</div>
</li>
<li><p>Public PETSc include files, <code class="docutils literal notranslate"><span class="pre">petsc*.h</span></code>, should not reference
private PETSc <code class="docutils literal notranslate"><span class="pre">petsc/private/*impl.h</span></code> include files.</p></li>
<li><p>Public and private PETSc include files cannot reference include files
located in the PETSc source tree.</p></li>
<li><p>All public functions must sanity-check their arguments using the appropriate
<code class="docutils literal notranslate"><span class="pre">PetscValidXXX()</span></code> macros. These must appear between <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a></span></code> and
<code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>()</span></code> For example</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a></span><span class="w"> </span><span class="nf">PetscPublicFunction</span><span class="p">(</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/Vec.html">Vec</a></span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscScalar.html">PetscScalar</a></span><span class="w"> </span><span class="o">*</span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInt.html">PetscInt</a></span><span class="w"> </span><span class="n">collectiveInt</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a></span><span class="p">;</span>
<span class="w">  </span><span class="n">PetscValidHeaderSpecific</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">VEC_CLASSID</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">PetscValidScalarPointer</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">PetscValidLogicalCollectiveInt</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">collectiveInt</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="w">  </span><span class="p">...</span>
<span class="w">  </span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a></span><span class="p">(</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a></span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See <code class="docutils literal notranslate"><span class="pre">include/petsc/private/petscimpl.h</span></code> and search for “PetscValid” to see all
available checker macros.</p>
</li>
<li><p>When possible, use <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscDefined.html">PetscDefined</a>()</span></code> instead of preprocessor conditionals.
For example use:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscDefined.html">PetscDefined</a></span><span class="p">(</span><span class="n">USE_DEBUG</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>instead of:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(PETSC_USE_DEBUG)</span>
<span class="w">  </span><span class="p">...</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>The former usage allows syntax and type checking in all configurations of
PETSc, where as the latter needs to be compiled with and without debugging
just to confirm that it compiles.</p>
</li>
<li><p>The first line of the executable statements in functions must be
<code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;</span></code></p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(returnvalue)</span></code>, not
<code class="docutils literal notranslate"><span class="pre">return(returnvalue);</span></code></p></li>
<li><p><em>Never</em> put a function call in a <code class="docutils literal notranslate"><span class="pre">return</span></code> statement; do not write</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a></span><span class="p">(</span><span class="w"> </span><span class="n">somefunction</span><span class="p">(...)</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="cm">/* Incorrect */</span>
</pre></div>
</div>
</li>
<li><p>Do <em>not</em> put a blank line immediately after <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;</span></code>
or a blank line immediately before <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);</span></code>.</p></li>
<li><p>Do not use <code class="docutils literal notranslate"><span class="pre">sqrt()</span></code>, <code class="docutils literal notranslate"><span class="pre">pow()</span></code>, <code class="docutils literal notranslate"><span class="pre">sin()</span></code>, and so on directly in
PETSc C/C++ source code or examples (usage is fine in Fortran source
code). Rather, use <code class="docutils literal notranslate"><span class="pre">PetscSqrtScalar()</span></code>, <code class="docutils literal notranslate"><span class="pre">PetscSqrtReal()</span></code>, and so
on, depending on the context. See <code class="docutils literal notranslate"><span class="pre">petscmath.h</span></code> for expressions to
use.</p></li>
<li><p>Do not include <code class="docutils literal notranslate"><span class="pre">assert.h</span></code> in PETSc source code. Do not use
<code class="docutils literal notranslate"><span class="pre">assert()</span></code>, it doesn’t play well in the parallel MPI world.
You may use <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscAssert.html">PetscAssert</a>()</span></code> where appropriate.</p></li>
<li><p>Try to make error messages short but informative. The user should be able to reasonably
diagnose the greater problem from your error message.</p></li>
<li><p>Except in code that may be called before PETSc is fully initialized,
always use <code class="docutils literal notranslate"><span class="pre">PetscMallocN()</span></code> (for example, <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscMalloc1.html">PetscMalloc1</a>()</span></code>),
<code class="docutils literal notranslate"><span class="pre">PetscCallocN()</span></code>, <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscNew.html">PetscNew</a>()</span></code>, and <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscFree.html">PetscFree</a>()</span></code>, not
<code class="docutils literal notranslate"><span class="pre">malloc()</span></code> and <code class="docutils literal notranslate"><span class="pre">free()</span></code>.</p></li>
<li><p>MPI routines and macros that are not part of the 2.1 standard
should not be used in PETSc without appropriate <code class="docutils literal notranslate"><span class="pre">configure</span></code>
checks and <code class="docutils literal notranslate"><span class="pre">#if</span> <span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscDefined.html">PetscDefined</a>()</span></code> checks. Code should also be provided
that works if the MPI feature is not available, for example,</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#if <a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscDefined.html">PetscDefined</a>(HAVE_MPI_REDUCE_LOCAL)</span>
<span class="w">  </span><span class="n">ierr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n"><a href="http://www.mpich.org/static/docs/latest/www3/MPI_Reduce_local.html#MPI_Reduce_local">MPI_Reduce_local</a></span><span class="p">(</span><span class="n">inbuf</span><span class="p">,</span><span class="n">inoutbuf</span><span class="p">,</span><span class="n">count</span><span class="p">,</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/MPIU_INT.html">MPIU_INT</a></span><span class="p">,</span><span class="n">MPI_SUM</span><span class="p">);</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/CHKERRMPI.html">CHKERRMPI</a></span><span class="p">(</span><span class="n">ierr</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="w">  </span><span class="n">ierr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n"><a href="http://www.mpich.org/static/docs/latest/www3/MPI_Reduce.html#MPI_Reduce">MPI_Reduce</a></span><span class="p">(</span><span class="n">inbuf</span><span class="p">,</span><span class="n">inoutbuf</span><span class="p">,</span><span class="n">count</span><span class="p">,</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/MPIU_INT.html">MPIU_INT</a></span><span class="p">,</span>
<span class="w">                    </span><span class="n">MPI_SUM</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a></span><span class="p">);</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/CHKERRMPI.html">CHKERRMPI</a></span><span class="p">(</span><span class="n">ierr</span><span class="p">);</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</li>
<li><p>Do not introduce PETSc routines that provide essentially the same
functionality as an available MPI routine. For example, do not write
a routine <code class="docutils literal notranslate"><span class="pre">PetscGlobalSum()</span></code> that takes a scalar value and performs
an <code class="docutils literal notranslate"><span class="pre"><a href="http://www.mpich.org/static/docs/latest/www3/MPI_Allreduce.html#MPI_Allreduce">MPI_Allreduce</a>()</span></code> on it. Instead, use the MPI routine
<code class="docutils literal notranslate"><span class="pre"><a href="http://www.mpich.org/static/docs/latest/www3/MPI_Allreduce.html#MPI_Allreduce">MPI_Allreduce</a>()</span></code> directly in the code.</p></li>
<li><p>Never use a local variable counter such as <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInt.html">PetscInt</a></span> <span class="pre">flops</span> <span class="pre">=</span> <span class="pre">0;</span></code> to
accumulate flops and then call <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogFlops.html">PetscLogFlops</a>();</span></code> <em>always</em> just
call <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Profiling/PetscLogFlops.html">PetscLogFlops</a>()</span></code> directly when needed.</p></li>
<li><p>Library symbols meant to be directly usable by the user should be declared
<code class="docutils literal notranslate"><span class="pre">PETSC_EXTERN</span></code> in their respective public header-file. Symbols intended to be for
internal use only should instead be declared <code class="docutils literal notranslate"><span class="pre">PETSC_INTERN</span></code>. Note that doing so is
not necessary in the case of symbols local to a single translation unit, these should
be declared <code class="docutils literal notranslate"><span class="pre">static</span></code>. Note that PETSc can be configured to build a separate shared
library for each top-level class (<code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/Mat.html">Mat</a></span></code>, <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Vec/Vec.html">Vec</a></span></code>, <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSP.html">KSP</a></span></code>, and so on) and that plugin
implementations of these classes can be included as separate shared libraries; thus,
otherwise private symbols may need to be marked <code class="docutils literal notranslate"><span class="pre">PETSC_SINGLE_LIBRARY_INTERN</span></code>. For
example</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MatStashCreate_Private()</span></code> is marked <code class="docutils literal notranslate"><span class="pre">PETSC_INTERN</span></code> as it is used
across compilation units, but only within the <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Mat/Mat.html">Mat</a></span></code> package;</p></li>
<li><p>all functions, such as <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPCreate.html">KSPCreate</a>()</span></code>, included in the public
headers (<code class="docutils literal notranslate"><span class="pre">include/petsc*.h</span></code>) should be marked <code class="docutils literal notranslate"><span class="pre">PETSC_EXTERN</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PetscDeviceInitializeDefaultDevice_Internal()</span></code> is marked
<code class="docutils literal notranslate"><span class="pre">PETSC_SINGLE_LIBRARY_INTERN</span></code> as it may be used across library boundaries, but is
not intended to be visible to users;</p></li>
</ul>
</li>
<li><p>Before removing or renaming an API function, type, or enumerator,
<code class="docutils literal notranslate"><span class="pre">PETSC_DEPRECATED_XXX()</span></code> should be used in the relevant header file
to indicate the new, correct usage and the version number where the
deprecation will first appear. The old function or type, with the
deprecation warning, should remain for at least one major release.
The function or type’s manual page should be updated (see <a class="reference internal" href="#manual-page-format"><span class="std std-ref">Manual Page Format</span></a>).
For example,</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="n">NewType</span><span class="w"> </span><span class="n">OldType</span><span class="w"> </span><span class="n">PETSC_DEPRECATED_TYPEDEF</span><span class="p">(</span><span class="s">&quot;Use NewType (since version 3.9)&quot;</span><span class="p">);</span>

<span class="n">PETSC_DEPRECATED_FUNCTION</span><span class="p">(</span><span class="s">&quot;Use NewFunction() (since version 3.9)&quot;</span><span class="p">)</span><span class="w"> </span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a></span><span class="w"> </span><span class="n">OldFunction</span><span class="p">();</span>

<span class="cp">#define OLD_ENUMERATOR_DEPRECATED  OLD_ENUMERATOR PETSC_DEPRECATED_ENUM(&quot;Use NEW_ENUMERATOR (since version 3.9)&quot;)</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">OLD_ENUMERATOR_DEPRECATED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">  </span><span class="n">NEW_ENUMERATOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
<span class="p">}</span><span class="w"> </span><span class="n">MyEnum</span><span class="p">;</span>
</pre></div>
</div>
<p>Note that after compiler preprocessing, the enum above would be transformed to something like</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">OLD_ENUMERATOR</span><span class="w"> </span><span class="nf">__attribute</span><span class="p">((</span><span class="n">deprecated</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">  </span><span class="n">NEW_ENUMERATOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
<span class="p">}</span><span class="w"> </span><span class="n">MyEnum</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>Before removing or renaming an options database key,
<code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscOptionsDeprecated.html">PetscOptionsDeprecated</a>()</span></code> should be used for at least one major
release.</p></li>
<li><p>The format strings in PETSc ASCII output routines, such as
<code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscPrintf.html">PetscPrintf</a></span></code>, take a <code class="docutils literal notranslate"><span class="pre">%&quot;</span> <span class="pre">PetscInt_FMT</span> <span class="pre">&quot;</span></code> for all PETSc variables of type <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscInt.html">PetscInt</a></span></code>,
not a <code class="docutils literal notranslate"><span class="pre">%d</span></code>.</p></li>
<li><p>All arguments of type <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscReal.html">PetscReal</a></span></code> to PETSc ASCII output routines,
such as <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscPrintf.html">PetscPrintf</a></span></code>, must be cast to <code class="docutils literal notranslate"><span class="pre">double</span></code>, for example,</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscPrintf.html">PetscPrintf</a></span><span class="p">(</span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PETSC_COMM_WORLD.html">PETSC_COMM_WORLD</a></span><span class="p">,</span><span class="s">&quot;Norm %g</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,(</span><span class="kt">double</span><span class="p">)</span><span class="n">norm</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="formatted-comments">
<h2>Formatted Comments<a class="headerlink" href="#formatted-comments" title="Permalink to this heading">#</a></h2>
<p>PETSc uses formatted comments and the Sowing packages
<span id="id3">[<a class="reference internal" href="#id1806" title="W Gropp. Users manual for bfort: producing Fortran interfaces to C source code. Technical Report ANL/MCS-TM-208, Argonne National Laboratory, 1995.">Gro95b</a>]</span> <span id="id4">[<a class="reference internal" href="#id1807" title="W Gropp. Users manual for doctext: producing documentation from source code. Technical Report ANL/MCS-TM-206, Argonne National Laboratory, 1995.">Gro95a</a>]</span>
to generate documentation (manual pages) and the Fortran interfaces. Documentation
for Sowing and the formatting may be found at
<a class="reference external" href="http://wgropp.cs.illinois.edu/projects/software/sowing/">http://wgropp.cs.illinois.edu/projects/software/sowing/</a>; in particular,
see the documentation for <code class="docutils literal notranslate"><span class="pre">doctext</span></code>. Currently doctext produces Markdown files ending in .md which
are later processed by Sphinx.</p>
<ul>
<li><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">/*&#64;</span></code></div>
<div class="line">a formatted comment of a function that will be used for both documentation and a Fortran interface.</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">/*&#64;C</span></code></div>
<div class="line">a formatted comment of a function that will be used only for documentation, not to generate a Fortran interface. In general, such labeled C functions should have a custom Fortran interface provided. Functions that take <code class="docutils literal notranslate"><span class="pre">char*</span></code> or function pointer arguments must have the <code class="docutils literal notranslate"><span class="pre">C</span></code> symbol and a custom Fortran interface provided.</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">/*E</span></code></div>
<div class="line">a formatted comment of an enum used for documentation only. Note that each of these needs to be listed in <code class="docutils literal notranslate"><span class="pre">lib/petsc/conf/bfort-petsc.txt</span></code> as a native and defined in the corresponding <code class="docutils literal notranslate"><span class="pre">include/petsc/finclude/petscxxx.h</span></code> Fortran include file and the values set as parameters in the file <code class="docutils literal notranslate"><span class="pre">src/SECTION/f90-mod/petscSUBSECTION.h</span></code>, for example, <code class="docutils literal notranslate"><span class="pre">src/vec/f90-mod/petscis.h</span></code>.</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">/*S</span></code></div>
<div class="line">a formatted comment for a data type such as <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSP.html">KSP</a></span></code>. Note that each of these needs to be listed in <code class="docutils literal notranslate"><span class="pre">lib/petsc/conf/bfort-petsc.txt</span></code> as a <code class="docutils literal notranslate"><span class="pre">nativeptr</span></code>.</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">/*J</span></code></div>
<div class="line">a formatted comment for a string type such as <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/KSP/KSPType.html">KSPType</a></span></code>.</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">/*MC</span></code></div>
<div class="line">a formatted comment of a CPP macro or enum value for documentation.</div>
</div>
</li>
</ul>
<p>The Fortran interface files supplied manually by developer go into the two
directories <code class="docutils literal notranslate"><span class="pre">ftn-custom</span></code> and <code class="docutils literal notranslate"><span class="pre">f90-custom</span></code>, while those generated by
Sowing go into <code class="docutils literal notranslate"><span class="pre">ftn-auto</span></code>.</p>
<p>Each include file that contains formatted comments needs to have a line of the form</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* SUBMANSEC = submansec (for example Sys) */</span>
</pre></div>
</div>
</div></blockquote>
<p>preceded by and followed by a blank line. For source code this information is found in the makefile in that source code’s directory in the format</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">MANSEC</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/DM/DM.html">DM</a></span>
<span class="n">SUBMANSEC</span><span class="o">=</span><span class="w"> </span><span class="n">DMPlex</span>
</pre></div>
</div>
</div></blockquote>
<section id="manual-page-format">
<span id="id5"></span><h3>Manual Page Format<a class="headerlink" href="#manual-page-format" title="Permalink to this heading">#</a></h3>
<p>Each function, typedef, class, macro, enum, and so on in the public API
should include the following data, correctly formatted (see codes
section) to generate complete manual pages and Fortran interfaces with
Sowing. All entries below should be separated by blank lines. Except
where noted, add a newline after the section headings.</p>
<ol class="arabic">
<li><p>The item’s name, followed by a dash and brief (one-sentence)
description.</p></li>
<li><p>If documenting a function implemented with a preprocessor macro
(e.g., <code class="docutils literal notranslate"><span class="pre"><a href="PETSC_DOC_OUT_ROOT_PLACEHOLDER/manualpages/Sys/PetscOptionsBegin.html">PetscOptionsBegin</a>()</span></code>), an explicit <code class="docutils literal notranslate"><span class="pre">Synopsis:</span></code> section
noting the required header and the function signature.</p></li>
<li><p>If documenting a function, a description of the function’s
“collectivity”.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Not</span> <span class="pre">Collective</span></code> if the function need not be called on multiple (or possibly all) MPI
ranks</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Collective</span> <span class="pre">[on</span> <span class="pre">xxx]</span></code> if the function is a collective operation.
If it is not with respect to the first argument then it is with respect
to the argument with the variable name xxx. Note that xxx is the variable name, not the variable type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Logically</span> <span class="pre">Collective</span> <span class="pre">[on</span> <span class="pre">xxx][;</span> <span class="pre">yyy</span> <span class="pre">must</span> <span class="pre">contain</span> <span class="pre">common</span> <span class="pre">value]</span></code>
if the function is collective but does not require any actual
synchronization (e.g. setting class parameters uniformly). Any
argument yyy which must have the same value on all ranks of the
MPI communicator should be noted here.</p></li>
</ul>
</li>
<li><p>If the function is not supported in Fortran then after the collective information, on the same line,
one should provide <code class="docutils literal notranslate"><span class="pre">;</span> <span class="pre">No</span> <span class="pre">Fortran</span> <span class="pre">support</span></code>.</p></li>
<li><p>If documenting a function with input parameters, a list of input
parameter descriptions in an <code class="docutils literal notranslate"><span class="pre">Input</span> <span class="pre">Parameter(s):</span></code> section.</p></li>
<li><p>If documenting a function with output parameters, a list of output
parameter descriptions in an <code class="docutils literal notranslate"><span class="pre">Output</span> <span class="pre">Parameter(s):</span></code> section.</p></li>
<li><p>If any input or output parameters are function pointers they should be documented in the style</p>
<p>:: code-block:: sh</p>
<blockquote>
<div><p>Calling sequence of <cite>func()</cite>:
$ PetscErrorCode func(PetscInt arg);
. arg - the integer argument</p>
</div></blockquote>
</li>
<li><p>If documenting a function that interacts with the options database, a
list of options database keys in an <code class="docutils literal notranslate"><span class="pre">Options</span> <span class="pre">Database</span> <span class="pre">Key(s):</span></code>
section.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Level:</span></code> (no newline) followed by <code class="docutils literal notranslate"><span class="pre">beginner</span></code>,
<code class="docutils literal notranslate"><span class="pre">intermediate</span></code>, <code class="docutils literal notranslate"><span class="pre">advanced</span></code>, <code class="docutils literal notranslate"><span class="pre">developer</span></code>, or <code class="docutils literal notranslate"><span class="pre">deprecated</span></code>. This
should be listed before the various <code class="docutils literal notranslate"><span class="pre">Note(s):</span></code> sections.</p></li>
<li><p>(Optional) a <code class="docutils literal notranslate"><span class="pre">Note(s):</span></code> section containing in-depth discussion,
technical caveats, special cases, and so on. If it is ambiguous
whether returned pointers/objects need to be freed/destroyed by the
user or not, this information should be mentioned here.</p></li>
<li><p>(If applicable) a <code class="docutils literal notranslate"><span class="pre">Fortran</span> <span class="pre">Note(s):</span></code> section detailing any relevant
differences in calling or using the item from Fortran.</p></li>
<li><p>(If applicable) a <code class="docutils literal notranslate"><span class="pre">Developer</span> <span class="pre">Note(s):</span></code> section detailing any relevant
information about the code for developers, for example, why a
particular algorithm was implemented.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.seealso:</span></code> (no newline, no spaces to the left of this text), followed by a list of related manual
pages. These manual pages should usually also point back to this
manual page in their <code class="docutils literal notranslate"><span class="pre">seealso:</span></code> sections. This is the final entry in the
comment. There should be no blank line  after the <code class="docutils literal notranslate"><span class="pre">.seealso</span></code> items.</p></li>
<li><p>All PETSc functions that appear in a manual page (except the one in the header at the top) should end with a <code class="docutils literal notranslate"><span class="pre">()</span></code> and be enclosed
in single back tick marks. All PETSc enum types and macros etc should also be enclosed in single back tick marks.
This includes each item listed in the .seealso lines.</p></li>
</ol>
<dl class="footnote brackets">
<dt class="label" id="id6"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Type also refers to the string name of the subclass.</p>
</dd>
</dl>
</section>
<section id="spelling-and-capitalization">
<h3>Spelling and Capitalization<a class="headerlink" href="#spelling-and-capitalization" title="Permalink to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Proper nouns, including Unix, Linux, X Windows, and Microsoft Windows should be fully written out and capitalized. This includes all operating systems.</p></li>
<li><p>Company names and product names should be capitalized.</p></li>
<li><p>Company names and terms that are traditionally all capitalized, for example, NVIDIA and CUDA should be all capitalized.</p></li>
<li><p>Unix should not be all capitalized.</p></li>
<li><p>Microsoft Windows should always be written out with two words. That is it should not be shortened to Windows.</p></li>
<li><p>CMake should be capitalized as shown.</p></li>
<li><p>BLAS and LAPACK are written in full capitalization</p></li>
</ol>
</section>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<div class="docutils container" id="id7">
<dl class="citation">
<dt class="label" id="id1807"><span class="brackets"><a class="fn-backref" href="#id4">Gro95a</a></span></dt>
<dd><p>W Gropp. Users manual for doctext: producing documentation from source code. Technical Report ANL/MCS-TM-206, Argonne National Laboratory, 1995.</p>
</dd>
<dt class="label" id="id1806"><span class="brackets"><a class="fn-backref" href="#id3">Gro95b</a></span></dt>
<dd><p>W Gropp. Users manual for bfort: producing Fortran interfaces to C source code. Technical Report ANL/MCS-TM-208, Argonne National Laboratory, 1995.</p>
</dd>
</dl>
</div>
</section>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="contributing.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Contributing to PETSc</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="integration.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Getting your code and documentation into PETSc</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#names">
   Names
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#coding-conventions-and-style">
   Coding Conventions and Style
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#c-formatting">
     C Formatting
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#c-usage">
     C Usage
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#usage-of-petsc-functions-and-macros">
     Usage of PETSc Functions and Macros
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#formatted-comments">
   Formatted Comments
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#manual-page-format">
     Manual Page Format
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spelling-and-capitalization">
     Spelling and Capitalization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  

<div class="tocsection editthispage">
    <a href="https://gitlab.com/petsc/petsc/edit/release/doc/developers/style.rst">
        <i class="fa-solid fa-pencil"></i> Edit this page
    </a>
</div>

</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../_sources/developers/style.rst.txt">
        <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 1991-2023, UChicago Argonne, LLC and the PETSc Development Team.<br>

</p>

  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br>
</p>

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
Last updated on 2023-04-30T09:17:39-0500 (v3.19.1).<br>
</p>
  </div>
  
</div>
  </footer>
  </body>
</html>